!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.rexfirebase=t():e.rexfirebase=t()}(window,function(){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=338)}({0:function(e,t){e.exports=function(e,t,r){if(e&&"number"!=typeof e){if(e.hasOwnProperty(t))return e[t];if(-1!==t.indexOf(".")){for(var i=t.split("."),n=e,s=r,o=0;o<i.length;o++){if(!n.hasOwnProperty(i[o])){s=r;break}s=n[i[o]],n=n[i[o]]}return s}return r}return r}},1:function(e,t,r){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n=function(e){return null==e||""===e||0===e.length};t.a=function(e,t,r){if("object"===i(e))if(n(t)){if(null==r)return;"object"===i(r)&&(e=r)}else{"string"==typeof t&&(t=t.split("."));var s=t.pop();((function(e,t,r){void 0===r&&(r={});var s=e;if(n(t));else{var o;"string"==typeof t&&(t=t.split("."));for(var a=0,u=t.length;a<u;a++){var c;null!=s[o=t[a]]&&"object"===i(s[o])||(c=a===u-1?r:{},s[o]=c),s=s[o]}}return s})(e,t))[s]=r}}},10:function(e,t,r){"use strict";var i=r(6);t.a=function(e,t){var r=Array.isArray(e);for(var n in void 0===t?t=r?[]:{}:Object(i.a)(t),r&&(t.length=e.length),e)t[n]=e[n];return t}},131:function(e,t){e.exports=function(e,t){if(!(t>=e.length)){for(var r=e.length-1,i=e[t],n=t;n<r;n++)e[n]=e[n+1];return e.length=r,i}}},132:function(e,t,r){"use strict";var i=r(10);t.a=function(e,t){var r=Object(i.a)(e);for(var n in t)r.hasOwnProperty(n)&&(r[n]=t[n]);return r}},133:function(e,t,r){"use strict";t.a=function(e){return void 0===e&&(e=0),new Promise(function(t,r){setTimeout(t,e)})}},2:function(e,t,r){"use strict";t.a={setEventEmitter:function(e,t){return void 0===t&&(t=Phaser.Events.EventEmitter),this._privateEE=void 0===e,this._eventEmitter=this._privateEE?new t:e,this},destroyEventEmitter:function(){this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown()},getEventEmitter:function(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(){return this._eventEmitter&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]}}},252:function(e,t,r){"use strict";var i={app:"https://www.gstatic.com/firebasejs/".concat("7.5.2","/firebase-app.js"),database:"https://www.gstatic.com/firebasejs/".concat("7.5.2","/firebase-database.js"),firestore:"https://www.gstatic.com/firebasejs/".concat("7.5.2","/firebase-firestore.js")},n=r(132),s=r(51),o=r(133),a=function(e){var t;for(var r in e)if(e[r]&&(t=u[r])&&!t())return!1;return!0},u={database:function(){return void 0!==firebase.database},firestore:function(){return void 0!==firebase.firestore}},c=function e(t){return a(t)?Promise.resolve():Object(o.a)(10).then(function(){return e(t)})},h=function(e){return new Promise(function(t,r){Object(s.a)(e,t)})};t.a=function(e,t){return e=Object(n.a)(i,e),h(e.app).then(function(){var t,r=0;for(var i in e)"app"!==i&&(t=e[i])&&(r++,Object(s.a)(t,function(){if(0==--r)return Promise.resolve()}));if(0===r)return Promise.resolve()}).then(function(){return c(e)}).then(function(){return void 0!==t&&firebase.initializeApp(t),Promise.resolve()})}},261:function(e,t,r){"use strict";var i=r(95),n=r(27),s=r(1);n.a.register("onlineUserList",function(e){return new i.a(e)}),Object(s.a)(window,"RexPlugins.Fire.OnlineUserList",i.a);i.a},262:function(e,t,r){"use strict";var i=r(2),n=r(0),s=r.n(n),o=r(95),a=r(132),u=function(e){return this.getRoomAliveRef(e).transaction(function(e){return null===e||void 0})},c=function(e){var t=(e=Object(a.a)(h,e)).roomID,r=e.roomName,i=e.roomType,n=e.doorState,s=e.join,o=this.getRoomRef(t),u=this.getRoomFilterRef(t),c=this.getRoomMetadataRef(t);this.isRemoveRoomWhenLeft=!e.presisted,this.isRemoveRoomWhenLeft&&(o.onDisconnect().remove(),u.onDisconnect().remove(),c.onDisconnect().remove());var f=function(e,t){return"".concat(e,"|").concat(t)}(n,i);s&&(this.userList.setRootPath(this.getUserListPath(t)).setMaxUsers(0).join(),this.userList.setMaxUsers(e.maxUsers));var l={filter:f,name:r},m={name:r,filter:f,maxUsers:e.maxUsers,moderators:{}};m.moderators[this.userInfo.userID]=this.userInfo.userName;var v={};v["rooms/".concat(t)]={alive:!0},v["room-filter/".concat(t)]=l,v["room-metadata/".concat(t)]=m,this.isRoomCreator=!0;var d=this;return this.getRootRef().update(v).then(function(){return d.roomID=t,d.roomName=r,d.roomType=i,d.emit("create",d),s&&d.onJoinRoom(e),Promise.resolve()}).catch(function(e){return d.isRoomCreator=!1,d.emit("create-fail",d),Promise.reject(e)})},h={roomID:"",roomName:"",roomType:"",maxUsers:0,presisted:!1,door:"open",join:!0},f=function(e){var t=this;return l.call(t,e).then(function(r){return t.userList.setRootPath(this.getUserListPath(e.roomID)).setMaxUsers(r.maxUsers).join()}).then(function(){return t.onJoinRoom(e),Promise.resolve()}).catch(function(){return t.emit("join-fail",e),Promise.reject()})},l=function(e){var t=this;return this.getRoomMetadataRef(e.roomID).once("value").then(function(r){var i=r.val();return e.roomName=i.name,e.roomType=i.filter.split("|")[1],t.isRoomOpened(i)?Promise.resolve(i):Promise.reject()})},m={getRootRef:function(e){var t=this.database.ref(this.rootPath);return e&&(t=t.child(e)),t},getRoomRef:function(e,t){var r=this.getRootRef("rooms");return void 0!==e&&(r=r.child(e),void 0!==t&&(r=r.child(t))),r},getRoomAliveRef:function(e){return this.getRoomRef(e,"alive")},getUserListRef:function(e){return this.getRoomRef(e,"users")},getRoomFilterRef:function(e){var t=this.getRootRef("room-filter");return void 0!==e&&(t=t.child(e)),t},getRoomMetadataRef:function(e){var t=this.getRootRef("room-metadata");return void 0!==e&&(t=t.child(e)),t},getUserMetadataRef:function(e){var t=this.getRootRef("user-metadata");return void 0!==e&&(t=t.child(e)),t},getUserListPath:function(e){return"".concat(this.rootPath,"/rooms/").concat(e,"/users")}},v={createRoom:function(e){void 0===e&&(e={}),null==e.roomID&&(e.roomID=this.getRoomRef().push().key);var t=this;return u.call(t,e.roomID).then(function(){return c.call(t,e)})},joinRoom:function(e){var t=this;return GetValue(e,"leftThenJoin",!0)?this.leaveRoom().then(function(){return f.call(t,e)}):f.call(t,e)},joinRandomRoom:function(e){if(this.lockAction)return this;this.lockAction=!0;GetValue(e,"retry",10)},leaveRoom:function(){return this.isInRoom()?(this.leftRoomFlag=!0,this.isRemoveRoomWhenLeft?this.removeRoom():this.userList.leave()):Promise.resolve()},removeRoom:function(e){if(void 0===e&&(e=this.roomID),void 0===e)return Promise.resolve();var t={};return t["room-filter/".concat(e)]=null,t["room-metadata/".concat(e)]=null,t["rooms/".concat(e)]=null,this.getRootRef().update(t)},getUserList:function(e){},kickUser:function(e){},onJoinRoom:function(e){this.roomID=e.roomID,this.roomName=e.roomName,this.roomType=e.roomType,this.userList.startUpdate(),this.emit("join",this)},onLeftRoom:function(){var e={roomID:this.roomID,roomName:this.roomName};this.roomID=void 0,this.roomName=void 0,this.doorState=void 0,this.monitorMyStateOff(),this.userList.stopUpdate().clear(),this.emit("leave",e),this.leftRoomFlag||this.emit("kicked",e),this.leftRoomFlag=!1},isRoomOpened:function(e){if(null==e)return!1;if("closed"===e.filter.split("|")[0])return!1;var t=this.userInfo.userID;if(e.moderators.hasOwnProperty(t))return!0;switch(e.permission){case"black-list":var r=e["black-list"];return!(r&&r.hasOwnProperty(t));case"white-list":var i=e["white-list"];return i&&i.hasOwnProperty(t);default:return!0}}};Object.assign(v,m);var d=v;function I(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=s()(t,"eventEmitter",void 0),i=s()(t,"EventEmitterClass",void 0);this.setEventEmitter(r,i),this.database=firebase.database(),this.rootPath=s()(t,"root",""),this.userInfo={userID:"",userName:""},this.setUser(s()(t,"userID",""),s()(t,"userName","")),this.isRoomCreator=!1,this.roomID=void 0,this.roomName=void 0,this.roomType=void 0,this.doorState=void 0,this.leftRoomFlag=!1,this.isRemoveRoomWhenLeft=void 0,this.userList=new o.a({eventEmitter:this.getEventEmitter(),eventNames:{join:s()(t,"eventNames.join","user.join"),leave:s()(t,"eventNames.leave","user.leave"),update:s()(t,"eventNames.update","userlist.update"),init:s()(t,"eventNames.init","userlist.init")}}),this.userList.on("user.leave",function(e){e.userID===this.userInfo.userID&&this.onLeftRoom()},this).setUser(this.userInfo),this.monitorRefPaths=[]}var t,r,i;return t=e,(r=[{key:"shutdown",value:function(){this.destroyEventEmitter().leaveRoom()}},{key:"destroy",value:function(){this.shutdown()}},{key:"setUser",value:function(e,t){return"string"==typeof e?(this.userInfo.userID=e,this.userInfo.userName=t):this.userInfo=e,this}},{key:"isInRoom",value:function(e){return void 0===e?void 0!==this.roomID:this.roomID===e}},{key:"maxUsers",get:function(){return this.userList.maxUsers}}])&&I(t.prototype,r),i&&I(t,i),e}();Object.assign(p.prototype,i.a,d);var y=p,g=r(27),D=r(1);g.a.register("room",function(e){return new y(e)}),Object(D.a)(window,"RexPlugins.Fire.Room",y)},263:function(e,t,r){"use strict";var i=r(0),n=r.n(i),s=function(e,t){var r=this;return this.database.runTransaction(function(i){var n=r.getAliasRef(t);return i.get(n).then(function(r){return r.exists?Promise.reject({id:e,alias:t}):(i.set(n,{id:e}),Promise.resolve({id:e,alias:t}))})})},o=function(e,t){var r=this;return this.getAlias(e).then(function(i){return i.alias?i.alias===t?Promise.resolve({id:e,alias:t}):Promise.reject({id:e,alias:t}):s.call(r,e,t)})},a=r(41),u=r.n(a),c=r(49),h=r.n(c),f=function(e,t,r){void 0===r&&(r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789");for(var i=void 0===t?e:u()(e,t),n="",s=0;s<i;s++)n+=h()(r);return n},l=function e(t,r,i,n){var o=f(r,r,i);if(n<=0)return Promise.reject({id:t,alias:o});n--;var a=this;return s.call(a,t,o).catch(function(){setTimeout(function(){return e.call(a,t,r,i,n)},0)})},m=function(e,t){var r=n()(t,"digits",10),i=n()(t,"candidates","0123456789"),s=n()(t,"retry",1e3),o=this;return this.getAlias(e).then(function(t){if(t.alias){var n=f(r,r,i);return t.alias===n?Promise.resolve({id:e,alias:n}):Promise.reject({id:e,alias:n})}return l.call(o,e,r,i,s)})},v=function(e){return this.getAliasRef(e).get().then(function(t){var r;return t.exists&&(r=t.data().id),Promise.resolve({id:r,alias:e})})},d=function(e){return this.rootRef.where("id","==",e).limit(1).get().then(function(t){var r;return t.forEach(function(e){r=e.id}),Promise.resolve({id:e,alias:r})})},I=function(e,t){var r=n()(t,"digits",10),i=n()(t,"candidates","0123456789"),s=n()(t,"retry",1e3),o=this;return this.getAlias(e).then(function(t){return t.alias?Promise.resolve(t):l.call(o,e,r,i,s)})},p=function(e){var t=this;return this.getAlias(e).then(function(e){return t.getAliasRef(e).delete()})};function y(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var g=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.database=firebase.firestore(),this.setRootPath(n()(t,"root",""))}var t,r,i;return t=e,(r=[{key:"shutdown",value:function(){}},{key:"destroy",value:function(){this.shutdown()}},{key:"setRootPath",value:function(e){return this.rootPath=e,this.rootRef=this.database.collection(e),this}},{key:"getAliasRef",value:function(e){return this.rootRef.doc(e)}}])&&y(t.prototype,r),i&&y(t,i),e}(),D={add:o,addRandom:m,getId:v,getAlias:d,getRandomAlias:I,remove:p};Object.assign(g.prototype,D);var b=g,R=r(27),P=r(1);R.a.register("idAlias",function(e){return new b(e)}),Object(P.a)(window,"RexPlugins.Fire.IdAlias",b)},264:function(e,t,r){"use strict";var i=r(0),n=r.n(i),s=function(e){var t=e.data();return t.headerDocID=e.id,t},o=function(e){var t=this.userInfo.userID,r=this.cacheHeaders[e];if(r&&r.userID===t)return Promise.resolve(r);var i=this;return this.getFileQuery(t,e,"header").limit(1).get().then(function(t){var r=void 0;return t.forEach(function(t){r=s(t),i.cacheHeaders[e]=r}),Promise.resolve(r)})},a=function(e,t,r,i){"boolean"==typeof r&&(i=r,r=void 0),void 0===i&&(i=!1);var n=this.userInfo.userID;void 0===t&&(t={}),t.userID=n,t.fileID=e,t.type="header",r&&(r.userID=n,r.fileID=e,r.type="content");var s=i?"update":"set",a=this;return o.call(this,e).then(function(e){var i,n;e?(i=a.rootRef.doc(e.headerDocID),r&&(n=e.contentDocID?a.rootRef.doc(e.contentDocID):a.rootRef.doc())):(i=a.rootRef.doc(),r&&(n=a.rootRef.doc())),t.hasOwnProperty("headerDocID")&&delete t.headerDocID,n&&(t.contentDocID=n.id);var o=a.database.batch();return o[s](i,t),r&&o[s](n,r),o.commit()}).then(function(){return Promise.resolve({userID:n,fileID:e})}).catch(function(t){return Promise.reject({error:t,userID:n,fileID:e})})},u=function(e){var t=this.userInfo.userID;return this.getFileQuery(t,e).get().then(function(r){var i,n;return r.forEach(function(e){switch(docData.type){case"header":i=s(e);break;case"content":n=e.data()}}),Promise.resolve({userID:t,fileID:e,header:i,content:n})}).catch(function(){return Promise.reject({error:error,userID:t,fileID:e})})},c=r(6),h=function(){var e=this.userInfo.userID,t=this;return this.getFileQuery(e,void 0,"header").get().then(function(r){var i;return Object(c.a)(t.cacheHeaders),r.forEach(function(e){i=s(e),t.cacheHeaders[i.fileID]=i}),Promise.resolve({userID:e,headers:t.cacheHeaders})}).catch(function(){return Promise.reject({error:error,userID:e})})},f=function(e){var t=this.userInfo.userID,r=this;return LoadHeader.call(this,e).then(function(i){if(!i)return Promise.resolve({userID:t,fileID:e});var n=r.database.batch();return n.delete(r.rootRef.doc(i.headerDocID)),i.contentDocID&&n.delete(r.rootRef.doc(i.contentDocID)),n.commit()}).then(function(){return r.cacheHeaders.hasOwnProperty(e)&&delete r.cacheHeaders[e],Promise.resolve({userID:t,fileID:e})}).catch(function(r){return Promise.reject({error:r,userID:t,fileID:e})})},l=function(){var e=this.userInfo.userID,t=this;return this.getFileQuery(e,void 0,"header").get().then(function(e){var r,i=t.database.batch();return e.forEach(function(e){r=DocToHeader(e),i.delete(t.rootRef.doc(r.headerDocID)),r.contentDocID&&i.delete(t.rootRef.doc(r.contentDocID))}),i.commit()}).then(function(){return t.clearCache(),Promise.resolve({userID:e})}).catch(function(t){return Promise.reject({error:t,userID:e})})};function m(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var v=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.database=firebase.firestore(),this.setRootPath(n()(t,"root","")),this.cacheHeaders={},this.userInfo={userID:""},this.setOwner(n()(t,"userID",""))}var t,r,i;return t=e,(r=[{key:"shutdown",value:function(){}},{key:"destroy",value:function(){this.shutdown()}},{key:"setRootPath",value:function(e){return this.rootPath=e,this.rootRef=this.database.collection(e),this}},{key:"setOwner",value:function(e){var t=this.userInfo.userID;return"string"==typeof e?this.userInfo.userID=e:this.userInfo=e,t!==this.userInfo.userID&&this.clearCache(),this}},{key:"clearCache",value:function(){return Object(c.a)(this.cacheHeaders),this}},{key:"getFileQuery",value:function(e,t,r){var i=this.rootRef;return i=e?i.where("userID","==",e):i,i=t?i.where("fileID","==",t):i,i=r?i.where("type","==",r):i}}])&&m(t.prototype,r),i&&m(t,i),e}(),d={save:a,load:u,loadHeaders:h,delete:f,clear:l};Object.assign(v.prototype,d);var I=v,p=r(27),y=r(1);p.a.register("files",function(e){return new I(e)}),Object(y.a)(window,"RexPlugins.Fire.Files",I)},265:function(e,t,r){"use strict";var i=r(0),n=r.n(i),s=function(){var e=this;return this.nextQuery.limit(this.itemCount).get().then(function(t){var r=t.size;return e.pageIndex=0,e.startItemIndex=0,e.endItemIndex=e.startItemIndex+r-1,e.startDocRef=t.docs[0],e.endDocRef=t.docs[r-1],Promise.resolve(t.docs)})},o=function(){if(void 0===this.pageIndex)return this.loadFirstPage();var e=this;return this.nextQuery.startAfter(this.endDocRef).limit(this.itemCount).get().then(function(t){var r=t.size;return e.pageIndex+=1,e.startItemIndex=e.endItemIndex+1,e.endItemIndex=e.startItemIndex+r-1,e.startDocRef=t.docs[0],e.endDocRef=t.docs[r-1],Promise.resolve(t.docs)})},a=function(){if(void 0===this.pageIndex)return this.loadFirstPage();var e=this;return this.prevQuery.startAfter(this.startDocRef).limit(this.itemCount).get().then(function(t){var r=t.size;return e.pageIndex-=1,e.endItemIndex=e.startItemIndex-1,e.startItemIndex=e.endItemIndex-r+1,e.startDocRed=t.docs[r-1],e.endDocRef=t.docs[0],Promise.resolve(t.docs.reverse())})};function u(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.setItemCount(n()(t,"itemCount",10)),this.setQuery(n()(t,"query.next",void 0),n()(t,"query.previous",void 0)),this.pageIndex=void 0,this.startItemIndex=void 0,this.endItemIndex=void 0,this.startDocRef=void 0,this.endDocRef=void 0}var t,r,i;return t=e,(r=[{key:"setItemCount",value:function(e){return this.itemCount=e,this}},{key:"setQuery",value:function(e,t){return this.nextQuery=e,this.prevQuery=t,this.pageIndex=void 0,this}}])&&u(t.prototype,r),i&&u(t,i),e}(),h={loadFirstPage:s,loadNextPage:o,loadPreviousPage:a};Object.assign(c.prototype,h);var f=c,l=r(27),m=r(1);l.a.register("pageQuery",function(e){return new f(e)}),Object(m.a)(window,"RexPlugins.Fire.PageQuery",f)},266:function(e,t,r){"use strict";var i=r(2),n=r(0),s=r.n(n),o=function(e,t){if(this.sendToRef&&this.sendToRef.key===e||(this.sendToRef=this.database.ref(this.rootPath).child(e)),void 0===t)return this.sendToRef.remove();var r={message:t,senderID:this.senderInfo.userID,senderName:this.senderInfo.userName,stamp:this.stamp};this.skipFirst=!1,this.stamp=!this.stamp;var i=this;return this.sendToRef.set(r).then(function(){return i.emit("send",r),Promise.resolve()}).catch(function(e){return i.emit("send-fail",r),Promise.reject(e)})},a={startReceiving:function(e){return void 0===e&&(e=this.senderInfo.userID),this.isReceiving&&this.receiverRef.key===e?this:(this.stopReceiving(),this.isReceiving=!0,this.skipFirst=!0,this.receiverRef=this.database.ref(this.rootPath).child(e),this.receiverRef.on("value",u,this),this.receiverRef.onDisconnect().remove(),this)},stopReceiving:function(){return this.isReceiving?(this.isReceiving=!1,this.receiverRef.off("value",u,this),this.receiverRef.remove(),this.receiverRef.onDisconnect().cancel(),this):this}},u=function(e){if(this.skipFirst)this.skipFirst=!1;else{var t=e.val();null!=t&&this.emit("receive",t)}},c=a;function h(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var f=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=s()(t,"eventEmitter",void 0),i=s()(t,"EventEmitterClass",void 0);this.setEventEmitter(r,i),this.database=firebase.database(),this.setRootPath(s()(t,"root","")),this.skipFirst=!0,this.stamp=!1,this.senderInfo={userID:"",userName:""},this.setSender(s()(t,"senderID",""),s()(t,"senderName","")),this.isReceiving=!1}var t,r,i;return t=e,(r=[{key:"shutdown",value:function(){this.stopReceiving().destroyEventEmitter()}},{key:"destroy",value:function(){this.shutdown()}},{key:"setRootPath",value:function(e){return this.rootPath=e,this.sendToRef=void 0,this.receiverRef=void 0,this}},{key:"setSender",value:function(e,t){return"string"==typeof e?(this.senderInfo.userID=e,this.senderInfo.userName=t):this.senderInfo=e,this}}])&&h(t.prototype,r),i&&h(t,i),e}(),l={send:o};Object.assign(f.prototype,i.a,c,l);var m=f,v=r(27),d=r(1);v.a.register("broadcast",function(e){return new m(e)}),Object(d.a)(window,"RexPlugins.Fire.Broadcast",m)},267:function(e,t,r){"use strict";var i=r(0),n=r.n(i),s=function(e){var t=e?new Date(e):new Date,r=new Date(t.getFullYear(),0,1),i=Math.ceil(((t-r)/864e5+r.getDay()+1)/7);return{d:t.getDate(),w:i,m:t.getMonth()+1,y:t.getFullYear()}},o=function(e,t){var r={userID:this.userInfo.userID,boardID:this.boardID,userName:this.userInfo.userName},i=s();for(var n in this.timeFilter)if(this.timeFilter[n]){var o=n.toUpperCase();r["tag".concat(o)]=i[n],r["score".concat(o)]=e}this.tag&&(r.tag=this.tag),t&&Object.assign(r,t);i=s();var a=this;return this.getRecordQuery(this.boardID,this.tag,this.userInfo.userID,void 0).limit(1).get().then(function(e){var t,i;if(e.forEach(function(e){t=e.data(),i=e.id}),t)for(var n in a.timeFilter)if(a.timeFilter[n]){var s=n.toUpperCase(),o="tag".concat(s);if(t[o]===r[o]){var u="score".concat(s);r[u]=Math.max(t[u],r[u])}}return void 0===i&&(i=a.rootRef.doc().id),a.rootRef.doc(i).set(r)})};function a(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.database=firebase.firestore(),this.setRootPath(n()(t,"root","")),this.userInfo={userID:"",userName:""},this.setUser(n()(t,"userID",""),n()(t,"userName","")),this.setBoardID(n()(t,"boardID","")),this.setTag(n()(t,"tag",void 0)),this.timeFilter={d:n()(t,"timeFilter.day",!0),w:n()(t,"timeFilter.week",!0),m:n()(t,"timeFilter.month",!0),y:n()(t,"timeFilter.year",!0)}}var t,r,i;return t=e,(r=[{key:"shutdown",value:function(){}},{key:"destroy",value:function(){this.shutdown()}},{key:"setRootPath",value:function(e){return this.rootPath=e,this.rootRef=this.database.collection(e),this}},{key:"setUser",value:function(e,t){return"string"==typeof e?(this.userInfo.userID=e,this.userInfo.userName=t):this.userInfo=e,this}},{key:"setBoardID",value:function(e){return this.boardID=e,this}},{key:"setTag",value:function(e){return this.tag=e,this}},{key:"getRecordQuery",value:function(e,t,r,i){var n=this.rootRef;return n=e?n.where("boardID","==",e):n,n=t?n.where("tag","==",t):n,n=r?n.where("userID","==",r):n,void 0!==i&&(i=i.split(":"),n=n.where(i[0],"==",i[1])),n}}])&&a(t.prototype,r),i&&a(t,i),e}(),c={post:o};Object.assign(u.prototype,c);var h=u,f=r(27),l=r(1);f.a.register("leaderBoard",function(e){return new h(e)}),Object(l.a)(window,"RexPlugins.Fire.LeaderBoard",h)},27:function(e,t,r){"use strict";function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"register",value:function(t,r){e.prototype[t]=r}}],(r=[{key:"initializeApp",value:function(e){return firebase.initializeApp(e),this}}])&&i(t.prototype,r),n&&i(t,n),e}();t.a=n},338:function(e,t,r){"use strict";r.r(t);var i=r(252),n=r(27);r(266),r(261),r(262),r(264),r(263),r(265),r(267);function s(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.add=new n.a}var t,r,o;return t=e,(r=[{key:"initializeApp",value:function(e){return this.add.initializeApp(e),this}},{key:"preload",value:function(e,t){return Object(i.a)(e,t)}}])&&s(t.prototype,r),o&&s(t,o),e}();t.default=o},41:function(e,t){e.exports=function(e,t){return Math.floor(Math.random()*(t-e+1)+e)}},49:function(e,t){e.exports=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length);var i=t+Math.floor(Math.random()*r);return void 0===e[i]?null:e[i]}},51:function(e,t,r){"use strict";t.a=function(e,t){for(var r=document.getElementsByTagName("script"),i=0,n=r.length;i<n;i++)if(-1!=r[i].src.indexOf(e))return void(t&&t());var s=document.createElement("script");s.setAttribute("src",e),t&&(s.onload=t),document.head.appendChild(s)}},6:function(e,t,r){"use strict";t.a=function(e){if(Array.isArray(e))e.length=0;else for(var t in e)delete e[t]}},95:function(e,t,r){"use strict";var i=r(2),n=r(0),s=r.n(n),o=r(6),a=r(131),u=r.n(a),c={clear:function(){return this.items.length=0,Object(o.a)(this.itemID2Index),this},getItems:function(){return this.items},hasItem:function(e){return this.itemID2Index.hasOwnProperty(e)},getItemIndexFromItemID:function(e){return null==e?null:this.itemID2Index[e]},getItemFromItemID:function(e){if(null==e)return null;var t=this.getItemIndexFromItemID(e);return null==t?null:this.items[t]},forEach:function(e,t){return this.items.forEach(e,t),this},addItem:function(e,t,r){var i,n=this.getItemCallback,s=this.getItemCallbackScope;if(i=s?n.call(s,e):n(e),r)return this.items.push(i),i;if(null==t)this.items.unshift(i);else{var o=this.itemID2Index[t];o===this.items.length-1?this.items.push(i):this.items.splice(o+1,0,i)}return i},removeItem:function(e){var t=this.itemID2Index[e.key];return u()(this.items,t)},updateItemID2Index:function(){var e;Object(o.a)(this.itemID2Index);for(var t=0,r=this.items.length;t<r;t++)e=this.items[t][this.keyItemID],this.itemID2Index[e]=t;return this}},h=function(e,t){var r=this.addItem(e,t);this.updateItemID2Index(),this.emit(this.eventNames.add,r),this.emit(this.eventNames.update,this.items)},f=function(e,t){var r=this.removeItem(e);this.updateItemID2Index(),this.addItem(e,t),this.updateItemID2Index(),this.emit(this.eventNames.change,r),this.emit(this.eventNames.update,this.items)},l=function(e){var t=this.removeItem(e);this.updateItemID2Index(),this.emit(this.eventNames.remove,t),this.emit(this.eventNames.update,this.items)},m=function(e){this.clear(),e.forEach(function(e){this.addItem(e,null,!0)}.bind(this)),this.updateItemID2Index(),this.emit(this.eventNames.update,this.items)},v={start:function(e){return this.isUpdating=!1,e.once("value",m,this),this},stop:function(){return this}},d={start:function(e){return e.on("child_added",h,this),e.on("child_removed",l,this),e.on("child_moved",f,this),e.on("child_changed",f,this),this},stop:function(){return this.query.off("child_added",h,this),this.query.off("child_removed",l,this),this.query.off("child_moved",f,this),this.query.off("child_changed",f,this),this}},I={start:function(e){return e.on("value",m,this),this},stop:function(){return this.query.off("value",m,this),this}};function p(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var y=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=s()(t,"eventEmitter",void 0),i=s()(t,"EventEmitterClass",void 0);this.setEventEmitter(r,i),this.isUpdating=!1,this.items=[],this.itemID2Index={},this.eventNames={update:s()(t,"eventNames.update","update"),add:s()(t,"eventNames.add","add"),remove:s()(t,"eventNames.remove","remove"),change:s()(t,"eventNames.change","change")},this.setItemIDKey(s()(t,"itemIDKey","__itemID__")),this.setMode(s()(t,"mode",1)),this.setGetitemCallback(s()(t,"getItemCallback",g),s()(t,"getItemCallbackScope",this)),this.setQuery(s()(t,"query",void 0))}var t,r,i;return t=e,(r=[{key:"shutdown",value:function(){this.stopUpdate().clear()}},{key:"destroy",value:function(){this.shutdown()}},{key:"setItemIDKey",value:function(e){return this.keyItemID=e,this}},{key:"setMode",value:function(e){return"string"==typeof e&&(e=b[e]),this.mode=e,this.updater=D[e],this}},{key:"setGetitemCallback",value:function(e,t){return this.getItemCallback=e,this.getItemCallbackScope=t,this}},{key:"setQuery",value:function(e){return this.query=e,this}},{key:"startUpdate",value:function(e){if(e)this.setQuery(e);else{if(!this.query)return this;e=this.query}return this.stopUpdate().clear(),this.isUpdating=!0,this.updater.start.call(this,e),this}},{key:"stopUpdate",value:function(){return this.query&&this.isUpdating?(this.isUpdating=!1,this.updater.stop.call(this),this):this}}])&&p(t.prototype,r),i&&p(t,i),e}(),g=function(e){var t=e.val();return t[this.keyItemID]=e.key,t};Object.assign(y.prototype,i.a,c);var D={0:v,1:d,2:I},b={once:0,child:1,all:2},R=y,P=r(133),w=function(e,t){var r=!1;return e.forEach(function(e){if(e.val().userID===t)return r=!0,!0}),r},E=function(){var e=this.userInfo.userID,t=this.userInfo.userName;if(this.contains(e))return Promise.resolve();var r=this,i={userID:e,userName:t},n=this.database.ref(this.rootPath),s=n.push();return s.onDisconnect().remove(),0===this.maxUsers?s.set(i).catch(function(e){return r.emit("join-fail",i),Promise.reject()}):s.set(i).then(function(){return Object(P.a)(0)}).then(function(){return n.limitToFirst(r.maxUsers).once("value")}).then(function(t){return w(t,e)?Promise.resolve():(s.remove().then(function(){s.onDisconnect().cancel()}),Promise.reject())}).catch(function(e){return r.emit("join-fail",i),Promise.reject()})},k=function(){var e=this.userInfo.userID;if(!this.contains(e))return Promise.resolve();var t=this.userID2ItemID[e];return this.database.ref(this.rootPath).child(t).remove()};function j(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var x=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=s()(t,"eventEmitter",void 0),i=s()(t,"EventEmitterClass",void 0);this.setEventEmitter(r,i),this.database=firebase.database(),this.setRootPath(s()(t,"root","")),this.userInfo={userID:"",userName:""},this.setUser(s()(t,"userID",""),s()(t,"userName","")),this.setMaxUsers(s()(t,"maxUsers",0)),this.userList=new R({eventEmitter:this.getEventEmitter(),itemIDKey:"joinAt",eventNames:{add:s()(t,"eventNames.join","join"),remove:s()(t,"eventNames.leave","leave"),update:s()(t,"eventNames.update","update")}}),this.userID2ItemID={},this.userList.on(this.userList.eventNames.add,function(e){this.userID2ItemID[e.userID]=e.joinAt,e.userID===this.userInfo.userID&&this.emit("init",this.getUsers())},this).on(this.userList.eventNames.remove,function(e){delete this.userID2ItemID[e.userID]},this)}var t,r,i;return t=e,(r=[{key:"shutdown",value:function(){this.stopUpdate().destroyEventEmitter().leave(),this.userList.shutdown()}},{key:"destroy",value:function(){this.shutdown()}},{key:"setRootPath",value:function(e){return this.rootPath=e,this}},{key:"setUser",value:function(e,t){return"string"==typeof e?(this.userInfo.userID=e,this.userInfo.userName=t):this.userInfo=e,this}},{key:"setMaxUsers",value:function(e){return this.maxUsers=e,this}},{key:"clear",value:function(){return this.userList.clear(),this}},{key:"forEach",value:function(e,t){return this.userList.forEach(e,t),this}},{key:"isFull",value:function(){return 0!==this.maxUsers&&this.userList.getItems().length>=this.maxUsers}},{key:"isFirstUser",value:function(e){var t=this.usersList.getItems()[0];return t&&t.userID===e}},{key:"getUser",value:function(e){if(!this.contains(e))return null;var t=this.userID2ItemID[e];return this.userList.getItemFromItemID(t)}},{key:"getUsers",value:function(){return this.userList.getItems()}},{key:"getUserRef",value:function(e){if(!this.contains(e))return null;var t=this.userID2ItemID[e];return this.database.ref(this.rootPath).child(t)}},{key:"contains",value:function(e){return this.userID2ItemID.hasOwnProperty(e)}},{key:"startUpdate",value:function(){var e=this.database.ref(this.rootPath);return this.maxUsers>0&&(e=e.limitToFirst(this.maxUsers)),this.userList.startUpdate(e),this}},{key:"stopUpdate",value:function(){return this.userList.stopUpdate(),this}}])&&j(t.prototype,r),i&&j(t,i),e}(),O={join:E,leave:k};Object.assign(x.prototype,i.a,O);t.a=x}}).default});