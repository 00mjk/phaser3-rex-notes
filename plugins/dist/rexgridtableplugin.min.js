!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.rexgridtableplugin=e():t.rexgridtableplugin=e()}(window,function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var l=e[s]={i:s,l:!1,exports:{}};return t[s].call(l.exports,l,l.exports,i),l.l=!0,l.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var l in t)i.d(s,l,function(e){return t[e]}.bind(null,l));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=52)}({1:function(t,e,i){"use strict";e.a=function(t){return"[object Array]"===Object.prototype.toString.call(t)}},14:function(t,e,i){"use strict";const s=Phaser.GameObjects.Zone,l=Phaser.GameObjects.Components,h=Phaser.Math.RotateAround;class r extends s{constructor(t,e,i,s,l){super(t,e,i,s,l),this.setOrigin(.5,.5),this.type="rexContainerLite",this.syncPositionEnable=!0,this._flipX=!1,this._flipY=!1,this._alpha=1,this.children=t.add.group()}add(t){return this.children.add(t),this.resetChildState(t),this}addMultiple(t){return t.forEach(this.add,this),this}remove(t){return this.children.remove(t),this}clear(){return this.children.clear(),this}getChildren(){return this.children.getChildren()}contains(t){return this.children.contains(t)}worldToLocal(t){return t.x-=this.x,t.y-=this.y,h(t,0,0,-this.rotation),t.x/=this.scaleX,t.y/=this.scaleY,t.x*=this.flipX?-1:1,t.y*=this.flipY?-1:1,t}localToWorld(t){return t.x*=this.flipX?-1:1,t.y*=this.flipY?-1:1,t.x*=this.scaleX,t.y*=this.scaleY,h(t,0,0,this.rotation),t.x+=this.x,t.y+=this.y,t}updateChildPosition(t){var e=t.type===this.type;e&&(t.syncPositionEnable=!1);var i=this.getLocalState(t);t.x=i.x,t.y=i.y,this.localToWorld(t),t.scaleX=i.scaleX*this.scaleX,t.scaleY=i.scaleY*this.scaleY,void 0!==t.flipX&&(t.flipX=this.flipX?!i.flipX:i.flipX,t.flipY=this.flipY?!i.flipY:i.flipY),t.rotation=i.face+this.rotation,e&&(t.syncPositionEnable=!0,t.syncPosition())}updateChildVisible(t){t.visible=this.visible}updateChildAlpha(t){var e=this.getLocalState(t);t.alpha=e.alpha*this.alpha}syncPosition(){return this.children&&this.syncPositionEnable&&this.getChildren().forEach(this.updateChildPosition,this),this}destroy(){this.children.destroy(!0),this.children=void 0,super.destroy()}getLocalState(t){return t.hasOwnProperty("rexContainer")||(t.rexContainer={}),t.rexContainer}resetChildState(t){var e=this.getLocalState(t);e.x=t.x,e.y=t.y,this.worldToLocal(e),e.scaleX=t.scaleX/this.scaleX,e.scaleY=t.scaleY/this.scaleY,void 0!==t.flipX&&(e.flipX=t.flipX,e.flipY=t.flipY),e.face=t.rotation-this.rotation,e.alpha=t.alpha/this.alpha}setChildLocalPosition(t,e,i){var s=this.getLocalState(t);return s.x=e,s.y=i,this.updateChildPosition(t),this}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.syncPosition())}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.syncPosition())}get rotation(){return super.rotation}set rotation(t){this.rotation!==t&&(super.rotation=t,this.syncPosition())}get scaleX(){return super.scaleX}set scaleX(t){this.scaleX!==t&&(super.scaleX=t,this.syncPosition())}get scaleY(){return super.scaleY}set scaleY(t){this.scaleY!==t&&(super.scaleY=t,this.syncPosition())}get flipX(){return this._flipX}set flipX(t){this._flipX!==t&&(this._flipX=t,this.syncPosition())}get flipY(){return this._flipY}set flipY(t){this._flipY!==t&&(this._flipY=t,this.syncPosition())}get visible(){return super.visible}set visible(t){this.visible!==t&&(super.visible=t,this.children&&this.getChildren().forEach(this.updateChildVisible,this))}get alpha(){return this._alpha}set alpha(t){this._alpha!==t&&(this._alpha=t,this.children&&this.getChildren().forEach(this.updateChildAlpha,this))}}Object.assign(r.prototype,l.Alpha,l.Flip),e.a=r},4:function(t,e,i){"use strict";var s=i(1);e.a=function(t){if(Object(s.a)(t))t.length=0;else for(var e in t)delete t[e]}},5:function(t,e,i){"use strict";e.a=class{constructor(){this.items=[]}pop(){return this.items.length>0?this.items.pop():null}push(t){this.items.push(t)}pushMultiple(t){for(var e=0,i=t.length;e<i;e++)this.items.push(t[e]);t.length=0}}},52:function(t,e,i){"use strict";i.r(e);var s=i(14),l=i(4);var h=class{constructor(t,e){this.container=null,this.data=null,this.setParent(t)}setParent(t){this.parent=t,this.parentContainer=t.getParentContainer()}get colIndx(){return this.parent.cellIndxeToColIndex(this.index)}get rowIndx(){return this.parent.cellIndxeToRowIndex(this.index)}getContainer(){return this.container}setContainer(t){return this.container&&this.container.destroy(),this.container=t,this.parentContainer.add(t),this}destroyContainer(){this.container&&(this.container.destroy(),this.container=null)}popContainer(){if(this.container){var t=this.container;return this.container=null,this.parentContainer.remove(t),t}return null}setXY(t,e){this.container&&this.parentContainer.setChildLocalPosition(this.container,t,e)}setData(t,e){return this.data||(this.data={}),this.data[t]=e,this}getData(t,e){this.data||(this.data={});var i=this.data;return i.hasOwnProperty(t)?i[t]:e}cleanData(){this.data&&Object(l.a)(this.data)}destroy(){this.cleanData(),this.destroyContainer(),this.parent=void 0,this.parentContainer=void 0}},r=i(5).a;const a=Phaser.Utils.Objects.GetValue,n=Phaser.Utils.Array.SpliceOne;var o=new r;var d=class{constructor(t,e){this.parent=t,this.cells=[],this.resetFromJSON(e)}resetFromJSON(t){return this.colCount=void 0,this.defaultCellHeightMode=!0,this.resetTotalRowsHeight(),this.setDefaultCellHeight(a(t,"cellHeight",30)),this.setDefaultCellWidth(a(t,"cellWidth",30)),this.initCells(a(t,"cellsCount",0)),this.setColumnCount(a(t,"columns",1)),this}setDefaultCellHeight(t){return this.defaultCellHeight=t,this}setDefaultCellWidth(t){return this.defaultCellWidth=t,this}initCells(t){var e=this.cells;e.length=t;for(var i=0;i<t;i++)e[i]=null;return this}insertNewCell(t,e){var i=this.cells;if(t===i.length){var s=t+e;i.legth=s;for(var l=t;l<s;l++)i[l]=null}else{var h=[];for(h.length=e,l=0;l<e;l++)h[l]=null;this.cells.splice(t,0,...h)}return this.resetTotalRowsHeight(),this}removeCell(t,e){for(var i=t+e,s=t;s<i;s++)this.freeCell(s);return i===this.cells.length?this.cells.length=t:(1===e?n(this.cells,t):this.cells.splice(t,e),this.buildCellIndex(t)),this.resetTotalRowsHeight(),this}setColumnCount(t){return this.colCount=t,this.resetTotalRowsHeight(),this}get rowCount(){return Math.ceil(this.cells.length/this.colCount)}get cellCount(){return this.cells.length}isValidCellIdx(t){return t>=0&&t<this.cells.length}heightToRowIndex(t,e){if(this.defaultCellHeightMode){var i=t/this.defaultCellHeight;return i=e?Math.ceil(i):Math.floor(i)}var s,l=this.rowCount,h=t;for(i=0;;){if(h-=this.getRowHeight(i),s=i>=0&&i<l,!(h>0&&s)){if(0===h)return i;if(e){var r=i;(s=(i+=1)>=0&&i<l)||(i=r)}return i}i+=1}}widthToColIndex(t,e){var i=t/this.defaultCellWidth;return i=e?Math.ceil(i):Math.floor(i)}colRowToCellIndex(t,e){return e*this.colCount+t}rowIndexToHeight(t,e){if(this.defaultCellHeightMode)return(e-t+1)*this.defaultCellHeight;for(var i,s=0,l=!0,h=t;h<=e;h++)s+=i=this.getRowHeight(h),i!==this.defaultCellHeight&&(l=!1);return l&&0===t&&e>=this.rowCount-1&&(this.defaultCellHeightMode=!0),s}colIndexToWidth(t,e){return(e-t+1)*this.defaultCellWidth}getRowHeight(t){var e=this.colCount;if(e<=1)return this.getCellHeight(this.colRowToCellIndex(0,t));for(var i,s=0,l=0;l<e;l++)s<(i=this.getCellHeight(this.colRowToCellIndex(l,t)))&&(s=i);return s}getColWidth(t){return this.defaultCellWidth}getCellHeight(t){if(!this.isValidCellIdx(t))return 0;var e;if(this.defaultCellHeightMode)e=this.defaultCellHeight;else{var i=this.getCell(t,!1),s=i&&i.hasOwnProperty("deltaHeight")?i.deltaHeight:0;e=this.defaultCellHeight+s}return e}resetTotalRowsHeight(){this._totalRowsHeight=null}get totalRowsHeight(){return null===this._totalRowsHeight&&(this._totalRowsHeight=this.rowIndexToHeight(0,this.rowCount-1)),this._totalRowsHeight}get totalColumnWidth(){return this.colCount*this.defaultCellWidth}cellIndxeToColIndex(t){return t%this.colCount}cellIndxeToRowIndex(t){return Math.floor(t/this.colCount)}getCell(t,e){if(!this.isValidCellIdx(t))return null;if(void 0===e&&(e=!0),null===this.cells[t]&&e){var i=this.newCell(t);this.cells[t]=i}return this.cells[t]}newCell(t){var e=o.pop();return null===e?e=new h(this):(e.setParent(this),e.hasOwnProperty("deltaHeight")&&delete e.deltaHeight),e.index=t,e}buildCellIndex(t){void 0===t&&(t=0);for(var e,i=this.cells,s=t,l=i.length;s<l;s++)(e=i[s])&&(e.index=s);return this}getParentContainer(){return this.parent}freeCell(t){return"number"==typeof t&&(t=this.cells[t]),t?(t.destroy(),o.push(t),this):this}destroy(){this.parent=void 0}};const u=s.a,c=Phaser.GameObjects.Components,b=Phaser.Structs.Set,p=Phaser.Utils.Objects.GetValue,C=Phaser.Math.Clamp;class g extends u{constructor(t,e,i,s,l,h){super(t,e,i,s,l),this.type="rexGridTable",this.updateFlag=!0,this._tableOX=0,this._tableOY=0,this.visibleCells=new b,this.preVisibleCells=new b,this.visibleStartX=null,this.visibleEndX=null,this.visibleStartY=null,this.visibleEndY=null,this.lastVisibleCellIdx=null,this.execeedTopState=!1,this.execeedBottomState=!1,this.execeedLeftState=!1,this.execeedRightState=!1,this.setScrollMode(p(h,"scrollMode",0)),this.setClampMode(p(h,"clamplTableOXY",!0));var r=p(h,"cellVisibleCallback",null);if(null!==r){var a=p(h,"cellVisibleCallbackScope",void 0);this.on("cellvisible",r,a)}if(null!==(r=p(h,"cellInvisibleCallback",null))){a=p(h,"cellInvisibleCallbackScope",void 0);this.on("cellinvisible",r,a)}this.table=new d(this,h),this.updateTable()}setScrollMode(t){"string"==typeof t&&(t=f[t.toLowerCase()]),this.scrollMode=t}setClampMode(t){return this.clampTableOXYMode=t,this}setCellsCount(t){var e=this.table.cellCount;return e===t?this:(e>t?this.removeCell(t,e-t):this.insertNewCell(e,t-e),this)}setColumnCount(t){return this.table.colCount===t?this:(this.table.setColumnCount(t),this.updateFlag=!0,this)}setGridSize(t,e){return this.setCellsCount(t*e),this.table.setColumnCount(t),this}insertNewCell(t,e){return"object"==typeof t&&(t=t.index),void 0===e&&(e=1),e<=0?this:(t=C(t,0,this.table.cellCount),this.table.insertNewCell(t,e),t<=this.lastVisibleCellIdx&&(this.updateFlag=!0),this)}removeCell(t,e){if("object"==typeof t&&(t=t.index),void 0===e&&(e=1),t<0&&(e+=t,t=0),e<=0)return this;if(t>this.table.cellCount)return this;if(t<=this.lastVisibleCellIdx)for(var i,s=this.preVisibleCells,l=this.visibleCells,h=t,r=t+e;h<r;h++)(i=this.getCell(h,!1))&&(l.contains(i)&&(this.hideCell(i),this.updateFlag=!0,l.delete(i)),s.delete(i));return this.table.removeCell(t,e),this}get tableOY(){return this._tableOY}get tableOX(){return this._tableOX}set tableOY(t){var e=this.table,i=this.topTableOY,s=this.bottomTableOY,l=this.tableOYExceedTop(t),h=this.tableOYExeceedBottom(t);if(this.clampTableOXYMode)if(e.rowCount<e.heightToRowIndex(this.instHeight,!0))t=0;else if(l)t=i;else{this.tableVisibleHeight;h&&(t=s)}this._tableOY!==t&&(this.updateFlag=!0,this._tableOY=t),l&&(this.execeedTopState||this.emit("execeedtop",this,t,i)),this.execeedTopState=l,h&&(this.execeedBottomState||this.emit("execeedbottom",this,t,s)),this.execeedBottomState=h}set tableOX(t){var e=this.table,i=this.leftTableOX,s=this.rightTableOX,l=this.tableOXExeceedLeft(t),h=this.tableOXExeceedRight(t);if(this.clampTableOXYMode)if(e.colCount<e.widthToColIndex(this.instWidth,!0))t=0;else if(l)t=i;else{this.tableVisibleWidth;h&&(t=s)}this._tableOX!==t&&(this.updateFlag=!0,this._tableOX=t),l&&(this.execeedLeftState||this.emit("execeedleft",this,t,i)),this.execeedLeftState=l,h&&(this.execeedRightState||this.emit("execeedright",this,t,s)),this.execeedRightState=h}setTableOY(t){return this.tableOY=t,this}setTableOX(t){return this.tableOX=t,this}setTableOXY(t,e){return this.tableOX=t,this.tableOY=e,this}addTableOX(t){return this.tableOX+=t,this}addTableOY(t){return this.tableOY+=t,this}addTableOXY(t,e){return this.tableOX+=t,this.tableOY+=e,this}setTableOYByPercentage(t){return t=C(t,0,1),this.setTableOY(-this.tableVisibleHeight*t),this}updateTable(t){return t&&(this.updateFlag=!0),this.updateFlag?(this.updateFlag=!1,t&&(this.cleanVisibleCellIndexes(),this.hideCells()),this.cleanVisibleCellIndexes(),this.showCells(),this.hideCells(),this):this}getCell(t){return this.table.getCell(t,!0)}eachVisibleCell(t,e){return this.visibleCells.each(t,e),this}iterateVisibleCell(t,e){return this.visibleCells.iterate(t,e),this}cleanVisibleCellIndexes(){var t=this.preVisibleCells;this.preVisibleCells=this.visibleCells,this.visibleCells=t,this.visibleCells.clear()}showCells(){var t=this.table,e=t.heightToRowIndex(-this.tableOY);e<0&&(e=0);var i=t.widthToColIndex(-this.tableOX);i<0&&(i=0);var s=t.colRowToCellIndex(i,e),l=this.bottomBound,h=this.rightBound,r=t.cellCount-1,a=t.colCount-1,n=this.getTLX(i),o=n,d=this.getTLY(e);for(this.visibleStartY=null,this.visibleEndY=null,this.visibleStartX=null,this.visibleEndX=null,this.lastVisibleCellIdx=null;d<l&&s<=r;){if(this.table.isValidCellIdx(s)){null===this.visibleStartY&&(this.visibleStartY=e,this.visibleEndY=e),null===this.visibleStartX&&(this.visibleStartX=i,this.visibleEndX=i),null===this.lastVisibleCellIdx&&(this.lastVisibleCellIdx=s),this.visibleEndY<e&&(this.visibleEndY=e),this.visibleEndX<i&&(this.visibleEndX=i),this.lastVisibleCellIdx<s&&(this.lastVisibleCellIdx=s);var u=t.getCell(s,!0);this.visibleCells.set(u),this.preVisibleCells.contains(u)||this.showCell(u),u.setXY(o,d)}o<h&&i<a?(o+=t.getColWidth(i),i+=1):(o=n,d+=t.getRowHeight(e),i=this.visibleStartX,e+=1),s=t.colRowToCellIndex(i,e)}}showCell(t){this.emit("cellvisible",t)}hideCells(){var t=this.preVisibleCells,e=this.visibleCells;t.iterate(function(t){e.contains(t)||this.hideCell(t)},this)}hideCell(t){this.emit("cellinvisible",t),t.destroyContainer()}get instHeight(){return 0===this.scrollMode?this.height:this.width}get instWidth(){return 0===this.scrollMode?this.width:this.height}get topTableOY(){return 0}get bottomTableOY(){return-this.tableVisibleHeight}get leftTableOX(){return 0}get rightTableOX(){return-this.tableVisibleWidth}tableOYExceedTop(t){return void 0===t&&(t=this.tableOY),t>this.topTableOY}tableOYExeceedBottom(t){return void 0===t&&(t=this.tableOY),t<this.bottomTableOY}tableOXExeceedLeft(t){return void 0===t&&(t=this.tableOX),t>this.leftTableOX}tableOXExeceedRight(t){return void 0===t&&(t=this.tableOX),t<this.rightTableOX}get tableVisibleHeight(){var t=this.table.totalRowsHeight,e=this.instHeight;return t>e?t-e:0}get tableVisibleWidth(){var t=this.table.totalColumnWidth,e=this.instWidth;return t>e?t-e:t}get bottomLeftY(){return-this.displayHeight*this.originY+this.displayHeight}get topRightX(){return-this.displayWidth*this.originX+this.displayWidth}get topLeftX(){return-this.displayWidth*this.originX}get topLeftY(){return-this.displayHeight*this.originY}get bottomBound(){return 0===this.scrollMode?this.bottomLeftY:this.topRightX}get rightBound(){return 0===this.scrollMode?this.topRightX:this.bottomLeftY}getTLX(t){var e=0===this.scrollMode?this.topLeftX:this.topLeftY;return this.tableOX+this.table.colIndexToWidth(0,t-1)+e}getTLY(t){var e=0===this.scrollMode?this.topLeftY:this.topLeftX;return this.tableOY+this.table.rowIndexToHeight(0,t-1)+e}destroy(){this.setCellsCount(0),this.table.destroy(),super.destroy()}}Object.assign(g.prototype,c.GetBounds);const f={v:0,vertical:0,h:1,horizontal:1};var v=g;const x=Phaser.Utils.Objects.GetValue,O=Phaser.GameObjects.BuildGameObject;e.default=class extends Phaser.Plugins.BasePlugin{constructor(t){super(t),t.registerGameObject("rexGridTable",this.addGridTable,this.makeGridTable)}start(){this.game.events.once("destroy",this.destroy,this)}addGridTable(t,e,i,s,l){return this.displayList.add(new v(this.scene,t,e,i,s,l))}makeGridTable(t){var e=x(t,"width",256),i=x(t,"height",256),s=new v(this.scene,0,0,e,i,t);return O(this.scene,s,t),s}}}}).default});