!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.rexcsvscenarioplugin=e():t.rexcsvscenarioplugin=e()}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function s(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=t,s.c=e,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=85)}({0:function(t,e,s){"use strict";e.a=function(t){return"[object Array]"===Object.prototype.toString.call(t)}},11:function(t,e,s){"use strict";e.a=function(t,e,s,n){e=e||",";for(var r=new RegExp("(\\"+e+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+e+"\\r\\n]*))","gi"),i=[],a=[i],o=null;o=r.exec(t);){var h=o[1];if(h.length&&h!=e&&(i=[],a.push(i)),o[2])var u=o[2].replace(new RegExp('""',"g"),'"');else u=o[3];s&&(u=n?s.call(n,u):s(u)),i.push(u)}return a}},12:function(t,e,s){"use strict";var n=s(13);e.a=n.a},13:function(t,e,s){"use strict";var n=s(5),r=s(4);const i=Phaser.Utils.Objects.GetValue;var a=function(t,e,s){var n,r=i(s,"reverse",!1);if("string"==typeof t[0])n=o(t,e,s);else if(r)for(h=(u=t.length)-1;h>=0;h--)n=a(t[h],e,s);else for(var h=0,u=t.length;h<u;h++)n=a(t[h],e,s);return n},o=function(t,e,s){var a=i(s,"argsConvert",void 0),o=i(s,"argsConvertScope",void 0),u=t[0];if(h=Object(n.a)(h,t,1),a){!0===a&&(a=r.a,o=void 0);for(var c=0,l=h.length;c<l;c++)h[c]=o?a.call(o,h[c],t):a(h[c],t)}var d=e[u];return null==d&&(d=i(e,u,null)),e?d.apply(e,h):d(h)},h=[];e.a=a},2:function(t,e,s){"use strict";var n=s(0);e.a=function(t){if(Object(n.a)(t))t.length=0;else for(var e in t)delete t[e]}},4:function(t,e,s){"use strict";var n=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i;e.a=function(t){return"string"!=typeof t?t:(""===t?t=null:n.test(t)?t=parseFloat(t):"false"===screen?t=!1:"true"===t&&(t=!0),t)}},5:function(t,e,s){"use strict";e.a=function(t,e,s,n){void 0===s&&(s=0),void 0===n&&(n=e.length),t.length=n-s;for(var r=0,i=t.length;r<i;r++)t[r]=e[r+s];return t}},8:function(t,e,s){"use strict";var n=Object.prototype.hasOwnProperty,r="~";function i(){}function a(t,e,s,n,i){if("function"!=typeof s)throw new TypeError("The listener must be a function");var a=new function(t,e,s){this.fn=t,this.context=e,this.once=s||!1}(s,n||t,i),o=r?r+e:e;return t._events[o]?t._events[o].fn?t._events[o]=[t._events[o],a]:t._events[o].push(a):(t._events[o]=a,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function h(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),h.prototype.eventNames=function(){var t,e,s=[];if(0===this._eventsCount)return s;for(e in t=this._events)n.call(t,e)&&s.push(r?e.slice(1):e);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(t)):s},h.prototype.listeners=function(t){var e=r?r+t:t,s=this._events[e];if(!s)return[];if(s.fn)return[s.fn];for(var n=0,i=s.length,a=new Array(i);n<i;n++)a[n]=s[n].fn;return a},h.prototype.listenerCount=function(t){var e=r?r+t:t,s=this._events[e];return s?s.fn?1:s.length:0},h.prototype.emit=function(t,e,s,n,i,a){var o=r?r+t:t;if(!this._events[o])return!1;var h,u,c=this._events[o],l=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,s),!0;case 4:return c.fn.call(c.context,e,s,n),!0;case 5:return c.fn.call(c.context,e,s,n,i),!0;case 6:return c.fn.call(c.context,e,s,n,i,a),!0}for(u=1,h=new Array(l-1);u<l;u++)h[u-1]=arguments[u];c.fn.apply(c.context,h)}else{var d,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(t,c[u].fn,void 0,!0),l){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,e);break;case 3:c[u].fn.call(c[u].context,e,s);break;case 4:c[u].fn.call(c[u].context,e,s,n);break;default:if(!h)for(d=1,h=new Array(l-1);d<l;d++)h[d-1]=arguments[d];c[u].fn.apply(c[u].context,h)}}return!0},h.prototype.on=function(t,e,s){return a(this,t,e,s,!1)},h.prototype.once=function(t,e,s){return a(this,t,e,s,!0)},h.prototype.removeListener=function(t,e,s,n){var i=r?r+t:t;if(!this._events[i])return this;if(!e)return o(this,i),this;var a=this._events[i];if(a.fn)a.fn!==e||n&&!a.once||s&&a.context!==s||o(this,i);else{for(var h=0,u=[],c=a.length;h<c;h++)(a[h].fn!==e||n&&!a[h].once||s&&a[h].context!==s)&&u.push(a[h]);u.length?this._events[i]=1===u.length?u[0]:u:o(this,i)}return this},h.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&o(this,e)):(this._events=new i,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=r,h.EventEmitter=h,t.exports=h},85:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=s(86);e.default=class extends Phaser.Plugins.BasePlugin{constructor(t){super(t)}start(){this.game.events.once("destroy",this.destroy,this)}add(t,e){return new n.a(t,e)}}},86:function(t,e,s){"use strict";var n=s(87);e.a=n.a},87:function(t,e,s){"use strict";var n=s(8),r=s.n(n),i=s(11),a=(s(0),s(88)),o=s(89);const h=Phaser.Utils.Objects.GetValue;const u={ms:0,s:1,sec:1},c=/^#([a-zA-Z]+)/;e.a=class extends r.a{constructor(t,e){super(),this.scene=t,this.timer=void 0,this.instMem=new a.a(this),this.cmdHandlers=new o.a(this),this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this._inRunCmdLoop=!1,this.isRunning=h(t,"state",!1),this.isPaused=h(t,"pause",!1),this.waitEvent=h(t,"wait",void 0),this.cmdHandlers.resetFromJSON(t),this.instMem.resetFromJSON(t),this.scope=h(t,"scope",void 0),this.timeUnit=h(t,"timeUnit",0),this.cmdPrefix=h(t,"prefix",c),this.argsConvert=h(t,"argsConvert",!0),this.argsConvertScope=h(t,"argsConvertScope",void 0),this}toJSON(){return{}}boot(){}shutdown(){this.clean(),this.parent=void 0}destroy(){this.shutdown()}load(t,e,s){return this.clean(),this.timeUnit=h(s,"timeUnit",this.timeUnit),"string"==typeof this.timeUnit&&(this.timeUnit=u[this.timeUnit]),this.cmdPrefix=h(s,"prefix",this.cmdPrefix),"string"==typeof this.cmdPrefix&&(this.cmdPrefix=new RegExp(this.cmdPrefix)),this.argsConvert=h(s,"argsConvert",this.argsConvert),this.argsConvertScope=h(s,"argsConvertScope",this.argsConvertScope),this.scope=e,this.append(t),this}clean(){this.stop(),this.instMem.resetFromJSON(),this.cmdHandlers.resetFromJSON()}start(t){this.stop();var e=h(t,"label","");return this.offset=h(t,"offset",0),this.isDebugMode&&this.log("Start at Label: "+e),!!this.goto(e)&&(this.isRunning=!0,this.runNextCmd(),!0)}getIndex(t){var e=this.getCmdHandler("label").getIndex(t);return null==e&&this.error("Label: "+t+" is not found"),e}goto(t){var e;return null!=(e="string"==typeof t?this.getIndex(t):t)&&(this.instMem.setNextIndex(e),!0)}wait(t){if(this.waitEvent=t,"number"==typeof t){var e=t;1===this.timeUnit&&(e*=1e3),this.timer=this.scene.time.delayedCall(e,this.continue,[t],this)}return this}stop(){return this.isRunning?(this.isRunning=!1,this.isPaused=!1,this.waitEvent=void 0,this.timer&&(this.timer.remove(),this.timer=void 0),this):this}complete(){return this.emit("complete",this),this.stop(),this}append(t){return this.parse(Object(i.a)(t)),this}pause(){return this.isRunning?this.isPaused?this:(this.isPaused=!0,this.timer&&(this.timer.paused=!0),this):this}resume(){return this.isRunning&&this.isPaused?(this.isPaused=!1,this.timer&&(this.timer.paused=!1),this):this}continue(t){return!this.isRunning||this.isPaused||void 0===this.waitEvent?this:(t===this.waitEvent&&(this.timer=void 0,this.waitEvent=void 0,this.runNextCmd()),this)}get lastLabel(){return this.cmdHandlers.labelCmd.lastLabel}get previousLabel(){return this.cmdHandlers.labelCmd.preLabel}getCmdHandler(t){return"string"!=typeof t&&(t=t[0]),this.cmdHandlers.get(t)}parse(t){for(var e,s,n=this.cmdPrefix,r=0,i=t.length;r<i;r++)if("-"===(s=(e=t[r])[0]))this.appendCommand(e);else if(isNaN(s))if(n.test(s)){var a=s.match(n);e[0]=a[1].toLowerCase(),this.appendCommand(e)||this.error("Line "+r+": "+JSON.stringify(e)+" is not a valid command")}else this.appendCommand(["wait",s]),e[0]="-",this.appendCommand(e);else{var o=parseFloat(s);o>0&&this.appendCommand(["wait",o]),e[0]="-",this.appendCommand(e)}return this}appendCommand(t){var e=this.getCmdHandler(t);return null!=e&&((t=e.parse(t,this.instMem.length))&&this.instMem.append(t),!0)}runNextCmd(){if(!this._inRunCmdLoop){this.threadId;var t,e=this.instMem;for(this._inRunCmdLoop=!0;this.isRunning&&!this.isPaused&&void 0===this.waitEvent;){if(t=e.get(),e.setNextIndex(),null==t){this.complete();break}this.getCmdHandler(t).run(t)}return this._inRunCmdLoop=!1,this}}log(t){return this.emit("log",t,this),this}get isDebugMode(){return this.listenerCount("log")>0}error(t){return this.emit("error",t,this),this}}},88:function(t,e,s){"use strict";var n=s(2);e.a=class{constructor(t){this.scenario=t,this.queue=[],this.customData={},this.resetFromJSON()}resetFromJSON(t){return this.clean(),this}clean(){return this.queue.length=0,this.currentIdx=-1,this.nextIdx=0,Object(n.a)(this.customData),this}append(t){return this.queue.push(t),this}setNextIndex(t){return void 0===t&&(t=this.currentIdx+1),this.nextIdx=t,this}get(t){return void 0===t&&(t=this.nextIdx),this.currentIdx=t,this.queue[t]}get length(){return this.queue.length}}},89:function(t,e,s){"use strict";var n=s(90),r=s(91),i=s(92),a=s(93),o=s(94),h=s(95);e.a=class{constructor(t){this.cmds={"-":new n.a(t),wait:new r.a(t),label:new i.a(t),exit:new a.a(t),goto:new o.a(t),if:new h.a(t)}}resetFromJSON(t){for(var e in this.cmds)this.cmds[e].resetFromJSON(t);return this}get(t){return this.cmds[t]}isValidCmdName(t){return this.cmds.hasOwnProperty(t)}}},9:function(t,e,s){"use strict";e.a=class{constructor(t,e){this.scenario=t,this.type=e}resetFromJSON(t){}parse(t,e){return t}run(t){}}},90:function(t,e,s){"use strict";var n=s(9),r=(s(5),s(12)),i=s(4);const a=Phaser.Utils.Array.SpliceOne;e.a=class extends n.a{constructor(t){super(t,"-"),this.task=void 0}resetFromJSON(t){this.task&&(this.task.off("complete",this.resume,this),this.task=void 0)}parse(t,e){var s=a(t,0),n=this.scenario,r=n.argsConvert,o=n.argsConvertScope;if(r){!0===r&&(r=i.a,o=void 0);for(var h=1,u=t.length;h<u;h++)t[h]=o?r.call(o,t[h],t):r(t[h],t)}return t=[s,t]}run(t){var e=this.scenario,s=Object(r.a)(t[1],e.scope);s&&"function"==typeof s.once?(s.once("complete",this.resume,this),this.pause(),this.task=s):this.task=void 0}pause(){this.scenario.pause()}resume(){this.task=void 0;var t=this.scenario;t.resume(),t.runNextCmd()}}},91:function(t,e,s){"use strict";var n=s(9);e.a=class extends n.a{constructor(t){super(t,"wait")}parse(t,e){t.length=2;var s=this.getEventName(t);return isNaN(s)||(t[1]=parseFloat(s)),t}run(t){var e=this.getEventName(t);"number"==typeof e?this.waitTime(e):this.waitEvent(e)}waitTime(t){t>this.scenario.offset?(t-=this.scenario.offset,this.scenario.offset=0,this.scenario.isDebugMode&&this.scenario.log("#WAIT: "+t),this.scenario.wait(t)):this.scenario.offset-=t}waitEvent(t){this.scenario.isDebugMode&&this.scenario.log("#WAIT: "+t),this.scenario.wait(t)}getEventName(t){var e=t[1];return null==e&&(e="",t[1]=e),e}}},92:function(t,e,s){"use strict";var n=s(9),r=s(2);e.a=class extends n.a{constructor(t){super(t,"label"),this.labels={},this.labels={},this.prevLabel="",this.lastLabel=""}resetFromJSON(t){Object(r.a)(this.labels),this.prevLabel="",this.lastLabel="",this.scenario.instMem.customData.labels=this.labels}parse(t,e){t.length=2;var s=this.getLabel(t);return this.addLabel(s,e),t}run(t){var e=this.getLabel(t);this.scenario.isDebugMode&&this.scenario.log("#LABEL: "+e),this.prevLabel=this.lastLabel,this.lastLabel=e;var s=this.scenario;s.emit("labelchange",this.lastLabel,this.prevLabel,s)}getLabel(t){var e=t[1];return null==e&&(e="",t[1]=e),e}addLabel(t,e){this.labels[t]=e}getIndex(t){return""!==t&&this.hasLabel(t)?this.labels[t]:0}hasLabel(t){return this.labels.hasOwnProperty(t)}}},93:function(t,e,s){"use strict";var n=s(9);e.a=class extends n.a{constructor(t){super(t,"exit")}parse(t,e){return t.length=1,t}run(t){this.scenario.log("#EXIT"),this.scenario.complete()}}},94:function(t,e,s){"use strict";var n=s(9);e.a=class extends n.a{constructor(t){super(t,"goto")}parse(t,e){return t.length=2,t}run(t){var e=this.getLabel(t);this.scenario.isDebugMode&&this.scenario.log("#GOTO label: "+e),this.scenario.goto(e)}getLabel(t){var e=t[1];return null==e&&(e="",t[1]=e),e}}},95:function(t,e,s){"use strict";var n=s(9);e.a=class extends n.a{constructor(t){super(t,"if")}parse(t,e){t.length=4;var s="("+this.getCond(t)+")";return t[1]=new Function("return "+s),t}run(t){var e=this.getCond(t).call(this.scenario.scope),s=e?this.getTrueLabel(t):this.getFalseLabel(t);""!==s&&(this.scenario.isDebugMode&&this.scenario.log("#IF "+e+"- GOTO label: "+s),this.scenario.goto(s))}getCond(t){var e=t[1];return null!=e&&""!==e||(e="true",t[1]=e),e}getTrueLabel(t){var e=t[2];return null==e&&(e="",t[2]=e),e}getFalseLabel(t){var e=t[3];return null==e&&(e="",t[3]=e),e}}}}).default});