!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.rexcsvscenarioplugin=e():t.rexcsvscenarioplugin=e()}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function s(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=t,s.c=e,s.d=function(t,e,r){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=85)}({0:function(t,e,s){"use strict";e.a=function(t){return"[object Array]"===Object.prototype.toString.call(t)}},11:function(t,e,s){"use strict";e.a=function(t,e,s,r){e=e||",";for(var n=new RegExp("(\\"+e+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+e+"\\r\\n]*))","gi"),i=[],a=[i],o=null;o=n.exec(t);){var u=o[1];if(u.length&&u!=e&&(i=[],a.push(i)),o[2])var h=o[2].replace(new RegExp('""',"g"),'"');else h=o[3];s&&(h=r?s.call(r,h):s(h)),i.push(h)}return a}},12:function(t,e,s){"use strict";var r=s(13);e.a=r.a},13:function(t,e,s){"use strict";var r=s(5),n=s(4);const i=Phaser.Utils.Objects.GetValue;var a=function(t,e,s){var r,n=i(s,"reverse",!1);if("string"==typeof t[0])r=o(t,e,s);else if(n)for(u=(h=t.length)-1;u>=0;u--)r=a(t[u],e,s);else for(var u=0,h=t.length;u<h;u++)r=a(t[u],e,s);return r},o=function(t,e,s){var a=i(s,"argsConvert",void 0),o=i(s,"argsConvertScope",void 0),h=t[0];if(u=Object(r.a)(u,t,1),a){!0===a&&(a=n.a,o=void 0);for(var c=0,l=u.length;c<l;c++)u[c]=o?a.call(o,u[c],t):a(u[c],t)}var d=e[h];return null==d&&(d=i(e,h,null)),e?d.apply(e,u):d(u)},u=[];e.a=a},2:function(t,e,s){"use strict";var r=s(0);e.a=function(t){if(Object(r.a)(t))t.length=0;else for(var e in t)delete t[e]}},4:function(t,e,s){"use strict";var r=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i;e.a=function(t){return"string"!=typeof t?t:(""===t?t=null:r.test(t)?t=parseFloat(t):"false"===screen?t=!1:"true"===t&&(t=!0),t)}},5:function(t,e,s){"use strict";e.a=function(t,e,s,r){void 0===s&&(s=0),void 0===r&&(r=e.length),t.length=r-s;for(var n=0,i=t.length;n<i;n++)t[n]=e[n+s];return t}},8:function(t,e,s){"use strict";var r=Object.prototype.hasOwnProperty,n="~";function i(){}function a(t,e,s,r,i){if("function"!=typeof s)throw new TypeError("The listener must be a function");var a=new function(t,e,s){this.fn=t,this.context=e,this.once=s||!1}(s,r||t,i),o=n?n+e:e;return t._events[o]?t._events[o].fn?t._events[o]=[t._events[o],a]:t._events[o].push(a):(t._events[o]=a,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function u(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),u.prototype.eventNames=function(){var t,e,s=[];if(0===this._eventsCount)return s;for(e in t=this._events)r.call(t,e)&&s.push(n?e.slice(1):e);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(t)):s},u.prototype.listeners=function(t){var e=n?n+t:t,s=this._events[e];if(!s)return[];if(s.fn)return[s.fn];for(var r=0,i=s.length,a=new Array(i);r<i;r++)a[r]=s[r].fn;return a},u.prototype.listenerCount=function(t){var e=n?n+t:t,s=this._events[e];return s?s.fn?1:s.length:0},u.prototype.emit=function(t,e,s,r,i,a){var o=n?n+t:t;if(!this._events[o])return!1;var u,h,c=this._events[o],l=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,s),!0;case 4:return c.fn.call(c.context,e,s,r),!0;case 5:return c.fn.call(c.context,e,s,r,i),!0;case 6:return c.fn.call(c.context,e,s,r,i,a),!0}for(h=1,u=new Array(l-1);h<l;h++)u[h-1]=arguments[h];c.fn.apply(c.context,u)}else{var d,p=c.length;for(h=0;h<p;h++)switch(c[h].once&&this.removeListener(t,c[h].fn,void 0,!0),l){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,e);break;case 3:c[h].fn.call(c[h].context,e,s);break;case 4:c[h].fn.call(c[h].context,e,s,r);break;default:if(!u)for(d=1,u=new Array(l-1);d<l;d++)u[d-1]=arguments[d];c[h].fn.apply(c[h].context,u)}}return!0},u.prototype.on=function(t,e,s){return a(this,t,e,s,!1)},u.prototype.once=function(t,e,s){return a(this,t,e,s,!0)},u.prototype.removeListener=function(t,e,s,r){var i=n?n+t:t;if(!this._events[i])return this;if(!e)return o(this,i),this;var a=this._events[i];if(a.fn)a.fn!==e||r&&!a.once||s&&a.context!==s||o(this,i);else{for(var u=0,h=[],c=a.length;u<c;u++)(a[u].fn!==e||r&&!a[u].once||s&&a[u].context!==s)&&h.push(a[u]);h.length?this._events[i]=1===h.length?h[0]:h:o(this,i)}return this},u.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&o(this,e)):(this._events=new i,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=n,u.EventEmitter=u,t.exports=u},85:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=s(86);e.default=class extends Phaser.Plugins.BasePlugin{constructor(t){super(t)}start(){this.game.events.once("destroy",this.destroy,this)}add(t,e){return new r.a(t,e)}}},86:function(t,e,s){"use strict";var r=s(87);e.a=r.a},87:function(t,e,s){"use strict";var r=s(8),n=s.n(r),i=s(11),a=(s(0),s(88)),o=s(89);const u=Phaser.Utils.Objects.GetValue;const h={ms:0,s:1,sec:1},c=/^#([a-zA-Z]+)/;e.a=class extends n.a{constructor(t,e){super(),this.scene=t,this.timer=void 0,this.cmdQueue=new a.a(this),this.cmdHandlers=new o.a(this),this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this._inRunCmdLoop=!1,this.isRunning=u(t,"state",!1),this.isPaused=u(t,"pause",!1),this.waitEvent=u(t,"wait",void 0),this.cmdHandlers.resetFromJSON(t),this.cmdQueue.resetFromJSON(t),this.scope=u(t,"scope",void 0),this.timeUnit=u(t,"timeUnit",0),this.argsConvert=u(t,"argsConvert",!0),this.argsConvertScope=u(t,"argsConvertScope",void 0),this}toJSON(){return{}}boot(){}shutdown(){this.parent=void 0}destroy(){this.shutdown()}load(t,e,s){return this.stop(),this.timeUnit=u(s,"timeUnit",this.timeUnit),"string"==typeof this.timeUnit&&(this.timeUnit=h[this.timeUnit]),this.argsConvert=u(s,"argsConvert",this.argsConvert),this.argsConvertScope=u(s,"argsConvertScope",this.argsConvertScope),this.scope=e,this.cmdQueue.resetFromJSON(),this.cmdHandlers.resetFromJSON(),this.parse(Object(i.a)(t),s),this}start(t){this.stop();var e=u(t,"label","");return this.offset=u(t,"offset",0),this.isDebugMode&&this.log("Start at Label: "+e),!!this.goto(e)&&(this.isRunning=!0,this.runNextCmd(),!0)}getIndex(t){var e=this.getCmdHandler("label").getIndex(t);return null==e&&this.error("Label: "+t+" is not found"),e}goto(t){var e;return null!=(e="string"==typeof t?this.getIndex(t):t)&&(this.cmdQueue.setNextIndex(e),!0)}wait(t){if(this.waitEvent=t,"number"==typeof t){var e=t;1===this.timeUnit&&(e*=1e3),this.timer=this.scene.time.delayedCall(e,this.continue,[t],this)}return this}stop(){return this.isRunning?(this.isRunning=!1,this.isPaused=!1,this.waitEvent=void 0,this.timer&&(this.timer.remove(),this.timer=void 0),this):this}complete(){return this.emit("complete",this),this.stop(),this}append(t){}clean(){}pause(){return this.isRunning?this.isPaused?this:(this.isPaused=!0,this.timer&&(this.timer.paused=!0),this):this}resume(){return this.isRunning&&this.isPaused?(this.isPaused=!1,this.timer&&(this.timer.paused=!1),this):this}continue(t){return!this.isRunning||this.isPaused||void 0===this.waitEvent?this:(t===this.waitEvent&&(this.timer=void 0,this.waitEvent=void 0,this.runNextCmd()),this)}get lastLabel(){return this.cmdHandlers.labelCmd.lastLabel}get previousLabel(){return this.cmdHandlers.labelCmd.preLabel}getCmdHandler(t){return"string"!=typeof t&&(t=t[0]),this.cmdHandlers.get(t)}parse(t,e){var s,r,n=u(e,"prefix",c);"string"==typeof n&&(n=new RegExp(n));for(var i=0,a=t.length;i<a;i++)if("-"===(r=(s=t[i])[0]))this.appendCommand(s);else if(isNaN(r))if(n.test(r)){var o=r.match(n);s[0]=o[1].toLowerCase(),this.appendCommand(s)||this.error("Line "+i+": "+JSON.stringify(s)+" is not a valid command")}else this.appendCommand(["waitevent",r]),s[0]="-",this.appendCommand(s);else{var h=parseFloat(r);h>0&&this.appendCommand(["waittime",h]),s[0]="-",this.appendCommand(s)}return this}appendCommand(t){var e=this.getCmdHandler(t);return null!=e&&((t=e.parse(t,this.cmdQueue.length))&&this.cmdQueue.append(t),!0)}runNextCmd(){if(!this._inRunCmdLoop){this.threadId;var t,e=this.cmdQueue;for(this._inRunCmdLoop=!0;this.isRunning&&!this.isPaused&&void 0===this.waitEvent;){if(t=e.get(),e.setNextIndex(),null==t){this.complete();break}this.getCmdHandler(t).run(t)}return this._inRunCmdLoop=!1,this}}log(t){return this.emit("log",t,this),this}get isDebugMode(){return this.listenerCount("log")>0}error(t){return this.emit("error",t,this),this}}},88:function(t,e,s){"use strict";var r=s(2);e.a=class{constructor(t){this.scenario=t,this.queue=[],this.customData={},this.resetFromJSON()}resetFromJSON(t){return this.clean(),this}clean(){return this.queue.length=0,this.currentIdx=-1,this.nextIdx=0,Object(r.a)(this.customData),this}append(t){return this.queue.push(t),this}appendMultiple(t){for(var e=0,s=t.length;e<s;e++)this.append(t[e]);return this}setNextIndex(t){return void 0===t&&(t=this.currentIdx+1),this.nextIdx=t,this}get(t){return void 0===t&&(t=this.nextIdx),this.currentIdx=t,this.queue[t]}get length(){return this.queue.length}}},89:function(t,e,s){"use strict";var r=s(90),n=s(91),i=s(92),a=s(93),o=s(94),u=s(95),h=s(96),c=s(97);e.a=class{constructor(t){this.cmds={"-":new r.a(t),wait:new n.a(t),waittime:new i.a(t),waitevent:new a.a(t),label:new o.a(t),exit:new u.a(t),goto:new h.a(t),if:new c.a(t)}}resetFromJSON(t){for(var e in this.cmds)this.cmds[e].resetFromJSON(t);return this}get(t){return this.cmds[t]}isValidCmdName(t){return this.cmds.hasOwnProperty(t)}}},9:function(t,e,s){"use strict";e.a=class{constructor(t,e){this.scenario=t,this.type=e}resetFromJSON(t){}parse(t,e){return t}run(t){}}},90:function(t,e,s){"use strict";var r=s(9),n=(s(5),s(12)),i=s(4);const a=Phaser.Utils.Array.SpliceOne;e.a=class extends r.a{constructor(t){super(t,"-"),this.task=void 0}resetFromJSON(t){this.task&&(this.task.off("complete",this.resume,this),this.task=void 0)}parse(t,e){var s=a(t,0),r=this.scenario,n=r.argsConvert,o=r.argsConvertScope;if(n){!0===n&&(n=i.a,o=void 0);for(var u=1,h=t.length;u<h;u++)t[u]=o?n.call(o,t[u],t):n(t[u],t)}return t=[s,t]}run(t){var e=this.scenario,s=Object(n.a)(t[1],e.scope);s&&"function"==typeof s.once?(s.once("complete",this.resume,this),this.pause(),this.task=s):this.task=void 0}pause(){this.scenario.pause()}resume(){this.task=void 0;var t=this.scenario;t.resume(),t.runNextCmd()}}},91:function(t,e,s){"use strict";var r=s(9);e.a=class extends r.a{constructor(t){super(t,"wait")}parse(t,e){return isNaN(t[1])?t[0]="waitevent":t[0]="waittime",this.scenario.getCmdHandler(t).parse(t,e)}}},92:function(t,e,s){"use strict";var r=s(9);e.a=class extends r.a{constructor(t){super(t,"waittime")}parse(t,e){var s=parseFloat(this.getDelayTime(t));if(!(s<=0))return t[1]=s,t.length=2,t}run(t){var e=this.getDelayTime(t);e>this.scenario.offset?(e-=this.scenario.offset,this.scenario.offset=0,this.scenario.isDebugMode&&this.scenario.log("#WAIT TIME: "+e),this.scenario.wait(e)):this.scenario.offset-=e}getDelayTime(t){var e=t[1];return null==e&&(e=0,t[1]=e),e}}},93:function(t,e,s){"use strict";var r=s(9);e.a=class extends r.a{constructor(t){super(t,"waitevent")}parse(t,e){return t.length=2,t}run(t){var e=this.getEventName(t);this.scenario.isDebugMode&&this.scenario.log("#WAIT EVENT: "+e),this.scenario.wait(e)}getEventName(t){var e=t[1];return null==e&&(e="",t[1]=e),e}}},94:function(t,e,s){"use strict";var r=s(9),n=s(2);e.a=class extends r.a{constructor(t){super(t,"label"),this.labels={},this.labels={},this.prevLabel="",this.lastLabel=""}resetFromJSON(t){Object(n.a)(this.labels),this.prevLabel="",this.lastLabel="",this.scenario.cmdQueue.customData.labels=this.labels}parse(t,e){t.length=2;var s=this.getLabel(t);return this.addLabel(s,e),t}run(t){var e=this.getLabel(t);this.scenario.isDebugMode&&this.scenario.log("#LABEL: "+e),this.prevLabel=this.lastLabel,this.lastLabel=e;var s=this.scenario;s.emit("labelchange",s,this.prevLabel,this.lastLabel)}getLabel(t){var e=t[1];return null==e&&(e="",t[1]=e),e}addLabel(t,e){this.labels[t]=e}getIndex(t){return""!==t&&this.hasLabel(t)?this.labels[t]:0}hasLabel(t){return this.labels.hasOwnProperty(t)}}},95:function(t,e,s){"use strict";var r=s(9);e.a=class extends r.a{constructor(t){super(t,"exit")}parse(t,e){return t.length=1,t}run(t){this.scenario.log("#EXIT"),this.scenario.complete()}}},96:function(t,e,s){"use strict";var r=s(9);e.a=class extends r.a{constructor(t){super(t,"goto")}parse(t,e){return t.length=2,t}run(t){var e=this.getLabel(t);this.scenario.isDebugMode&&this.scenario.log("#GOTO label: "+e),this.scenario.goto(e)}getLabel(t){var e=t[1];return null==e&&(e="",t[1]=e),e}}},97:function(t,e,s){"use strict";var r=s(9);e.a=class extends r.a{constructor(t){super(t,"if")}parse(t,e){t.length=4;var s="("+this.getCond(t)+")";return t[1]=new Function("return "+s),t}run(t){var e=this.getCond(t).call(this.scenario.scope),s=e?this.getTrueLabel(t):this.getFalseLabel(t);""!==s&&(this.scenario.isDebugMode&&this.scenario.log("#IF "+e+"- GOTO label: "+s),this.scenario.goto(s))}getCond(t){var e=t[1];return null!=e&&""!==e||(e="true",t[1]=e),e}getTrueLabel(t){var e=t[2];return null==e&&(e="",t[2]=e),e}getFalseLabel(t){var e=t[3];return null==e&&(e="",t[3]=e),e}}}}).default});