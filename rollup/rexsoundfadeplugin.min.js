!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).rexsoundfadeplugin=t()}(this,function(){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}var t=Phaser.Utils.Objects.GetValue,r=Phaser.Utils.Objects.GetAdvancedValue,a=function(){function n(e,t,o){s(this,n),this.sound=t,this.scene=e,this.volume={},this.tween=void 0,this.resetFromJSON(o),this.boot()}return e(n,[{key:"resetFromJSON",value:function(e){return this.setMode(t(e,"mode",0)),this.setVolumeRange(r(e,"volume.start",this.sound.volume),r(e,"volume.end",0)),this.setDelay(r(e,"delay",0)),this.setFadeOutTime(r(e,"duration",1e3)),this}},{key:"toJSON",value:function(){return{mode:this.mode,volume:this.volume,delay:this.delay,duration:this.duration}}},{key:"boot",value:function(){this.scene.events.once("shutdown",this.destroy,this),this.sound.once("destroy",this.destroy,this)}},{key:"shutdown",value:function(){this.stop(),this.scene.events.off("destroy",this.destroy,this),this.sound.off("destroy",this.destroy,this),this.sound=void 0,this.scene=void 0}},{key:"destroy",value:function(){this.shutdown()}},{key:"setMode",value:function(e){return"string"==typeof e&&(e=d[e]),this.mode=e,this}},{key:"setVolumeRange",value:function(e,t){return this.volume.start=e,this.volume.end=t,this}},{key:"setDelay",value:function(e){return this.delay=e,this}},{key:"setFadeOutTime",value:function(e){return this.duration=e,this}},{key:"start",value:function(){if(!this.tween)return 0===this.duration?(this.sound.setVolume(this.volume.end),this.complete()):(this.sound.setVolume(this.volume.start),this.tween=this.scene.tweens.add({targets:this.sound,volume:this.volume.end,delay:this.delay,duration:this.duration,ease:"Linear",onComplete:this.complete,onCompleteScope:this})),this}},{key:"stop",value:function(){if(this.tween)return this.tween.remove(),this.tween=void 0,this}},{key:"complete",value:function(){switch(this.stop(),this.mode){case 1:this.sound.stop();break;case 2:this.sound.destroy()}}}]),n}(),d={stop:1,destroy:2},h={volume:{}},l={volume:{}},f=function(e,t,o,n,s){var i;return void 0===n&&(n=1),void 0===s&&(s=0),h.mode=0,h.volume.start=s,h.volume.end=n,h.duration=o,"string"==typeof t&&(t=e.sound.add(t)),t.hasOwnProperty("_fade")?(i=t._fade).stop().resetFromJSON(h):(i=new a(e,t,h),t._fade=i),i.start(),t.isPlaying||t.setVolume(s).play(),t},c=function(e,t,o,n){var s;return void 0===n&&(n=!0),l.mode=n?2:1,l.volume.start=t.volume,l.volume.end=0,l.duration=o,t.hasOwnProperty("_fade")?(s=t._fade).stop().resetFromJSON(l):(s=new a(e,t,l),t._fade=s),s.start(),t.isPlaying||t.play(),t};return function(){function t(e){return s(this,t),u(this,o(t).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(t,Phaser.Plugins.BasePlugin),e(t,[{key:"start",value:function(){this.game.events.once("destroy",this.destroy,this)}},{key:"fadeIn",value:function(e,t,o,n,s){return f(e,t,o,n,s)}},{key:"fadeOut",value:function(e,t,o,n){return c(e,t,o,n)}}]),t}()});
