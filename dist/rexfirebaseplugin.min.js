!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.rexfirebaseplugin=t():e.rexfirebaseplugin=t()}(window,function(){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=326)}({0:function(e,t){e.exports=function(e,t,r){if(e&&"number"!=typeof e){if(e.hasOwnProperty(t))return e[t];if(-1!==t.indexOf(".")){for(var i=t.split("."),n=e,s=r,o=0;o<i.length;o++){if(!n.hasOwnProperty(i[o])){s=r;break}s=n[i[o]],n=n[i[o]]}return s}return r}return r}},1:function(e,t,r){"use strict";t.a={setEventEmitter:function(e,t){return void 0===t&&(t=Phaser.Events.EventEmitter),this._privateEE=void 0===e,this._eventEmitter=this._privateEE?new t:e,this},destroyEventEmitter:function(){this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown()},getEventEmitter:function(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(){return this._eventEmitter&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]}}},113:function(e,t,r){"use strict";var i=r(74);t.a=function(e){return new Promise(function(t,r){Object(i.a)(e,t)})}},114:function(e,t,r){"use strict";var i=r(89),n=r.n(i),s=r(90),o=r.n(s);t.a=function(e,t,r){void 0===r&&(r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789");for(var i=void 0===t?e:n()(e,t),s="",a=0;a<i;a++)s+=o()(r);return s}},115:function(e,t,r){"use strict";var i=r(1),n=r(0),s=r.n(n),o=r(146),a=r(9),u={clear:function(){return this.items.length=0,Object(a.a)(this.itemID2Index),this},getItems:function(){return this.items},hasItem:function(e){return this.itemID2Index.hasOwnProperty(e)},getItemIndexFromItemID:function(e){return null==e?null:this.itemID2Index[e]},getItemFromItemID:function(e){if(null==e)return null;var t=this.getItemIndexFromItemID(e);return null==t?null:this.items[t]},forEach:function(e,t){return this.items.forEach(e,t),this},updateItemID2Index:function(){var e;Object(a.a)(this.itemID2Index);for(var t=0,r=this.items.length;t<r;t++)e=this.items[t][this.keyItemID],this.itemID2Index[e]=t;return this}},c=r(140),h=r.n(c),f=function(e,t){var r=d.call(this,e,t);this.updateItemID2Index(),this.emit(this.eventNames.add,r),this.emit(this.eventNames.update,this.items)},l=function(e,t){var r=g.call(this,e);this.updateItemID2Index();var i=d.call(this,e,t);this.updateItemID2Index(),this.emit(this.eventNames.change,i,r),this.emit(this.eventNames.update,this.items)},v=function(e){var t=g.call(this,e);this.updateItemID2Index(),this.emit(this.eventNames.remove,t),this.emit(this.eventNames.update,this.items)},m=function(e){this.clear(),e.forEach(function(e){d.call(this,e,null,!0)}.bind(this)),this.updateItemID2Index(),this.emit(this.eventNames.update,this.items)},d=function(e,t,r){var i,n=this.getItemCallback,s=this.getItemCallbackScope;if(i=s?n.call(s,e):n(e),r)return this.items.push(i),i;if(null==t)this.items.unshift(i);else{var o=this.itemID2Index[t];o===this.items.length-1?this.items.push(i):this.items.splice(o+1,0,i)}return i},g=function(e){var t=this.itemID2Index[e.key];return h()(this.items,t)},y={start:function(e){return this.isUpdating=!1,e.once("value",m,this),this},stop:function(){return this}},I={start:function(e){return e.on("child_added",f,this),e.on("child_removed",v,this),e.on("child_moved",l,this),e.on("child_changed",l,this),this},stop:function(){return this.query.off("child_added",f,this),this.query.off("child_removed",v,this),this.query.off("child_moved",l,this),this.query.off("child_changed",l,this),this}},p={start:function(e){return e.on("value",m,this),this},stop:function(){return this.query.off("value",m,this),this}};function b(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var D=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=s()(t,"eventEmitter",void 0),i=s()(t,"EventEmitterClass",void 0);this.setEventEmitter(r,i),this.eventNames=Object(o.a)(s()(t,"eventNames",{}),R),this.isUpdating=!1,this.items=[],this.itemID2Index={},this.setItemIDKey(s()(t,"itemIDKey","__itemID__")),this.setMode(s()(t,"mode",1)),this.setGetitemCallback(s()(t,"getItemCallback",P),s()(t,"getItemCallbackScope",this)),this.setQuery(s()(t,"query",void 0))}var t,r,i;return t=e,(r=[{key:"shutdown",value:function(){this.stopUpdate().clear()}},{key:"destroy",value:function(){this.shutdown()}},{key:"setItemIDKey",value:function(e){return this.keyItemID=e,this}},{key:"setMode",value:function(e){return"string"==typeof e&&(e=k[e]),this.mode=e,this.updater=w[e],this}},{key:"setGetitemCallback",value:function(e,t){return this.getItemCallback=e,this.getItemCallbackScope=t,this}},{key:"setQuery",value:function(e){return this.query=e,this}},{key:"startUpdate",value:function(e){if(e)this.setQuery(e);else{if(!this.query)return this;e=this.query}return this.stopUpdate().clear(),this.isUpdating=!0,this.updater.start.call(this,e),this}},{key:"stopUpdate",value:function(){return this.query&&this.isUpdating?(this.isUpdating=!1,this.updater.stop.call(this),this):this}}])&&b(t.prototype,r),i&&b(t,i),e}(),P=function(e){var t=e.val();return t[this.keyItemID]=e.key,t};Object.assign(D.prototype,i.a,u);var R={update:"update",add:"add",remove:"remove",change:"change"},w={0:y,1:I,2:p},k={once:0,child:1,all:2};t.a=D},126:function(e,t,r){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=Phaser.Loader.FILE_POPULATED,c=function(e){function t(e,r){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r.hasOwnProperty("type")||(r.type="await"),r.hasOwnProperty("url")||(r.url=""),r.hasOwnProperty("key")||(r.key=(new Date).getTime().toString()),s(this,o(t).call(this,e,r))}var r,i,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(t,Phaser.Loader.File),r=t,(i=[{key:"load",value:function(){if(this.state===u)this.loader.nextFile(this,!0);else{var e=this.config,t=e.callback,r=e.scope,i=this.onLoad.bind(this),n=this.onError.bind(this);t?r?t.call(r,i,n):t(i,n):this.onLoad()}}},{key:"onLoad",value:function(){this.loader.nextFile(this,!0)}},{key:"onError",value:function(){this.loader.nextFile(this,!1)}}])&&n(r.prototype,i),c&&n(r,c),t}();t.a=c},140:function(e,t){e.exports=function(e,t){if(!(t>=e.length)){for(var r=e.length-1,i=e[t],n=t;n<r;n++)e[n]=e[n+1];return e.length=r,i}}},144:function(e,t,r){"use strict";var i=r(21);t.a=function(e,t){var r=Object(i.a)(e);for(var n in t)r.hasOwnProperty(n)&&(r[n]=t[n]);return r}},145:function(e,t,r){"use strict";t.a=function(e,t){return void 0===e&&(e=0),new Promise(function(r,i){setTimeout(function(){r(t)},e)})}},146:function(e,t,r){"use strict";var i=r(21);t.a=function(e,t){var r=Object(i.a)(e);for(var n in t)r.hasOwnProperty(n)||(r[n]=t[n]);return r}},147:function(e,t,r){"use strict";var i=function e(t){var r=t.query;t.startDocRef&&(r=r[t.startMode](t.startDocRef));var i=Math.min(t.remainderLines,t.linesPerPage);return t.remainderLines-=i,r.limit(i).get().then(function(r){var n,s=0===t.remainderLines||r.size<i;return t.forEachPageCallback&&(s|=!!t.forEachPageCallback(r)),s?(t.resolveCallback&&(n=t.resolveCallback()),Promise.resolve(n)):(t.startDocRef=r.docs[r.size-1],t.startMode="startAfter",e(t))})};t.a=function(e){return void 0===e.totalLines&&(e.totalLines=1/0),void 0===e.linesPerPage&&(e.linesPerPage=1e3),e.remainderLines=e.totalLines,i(e)}},20:function(e,t){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.exports=function(e){if("object"!==r(e)||e.nodeType||e===e.window)return!1;try{if(e.constructor&&!{}.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}return!0}},21:function(e,t,r){"use strict";var i=r(9);t.a=function(e,t){var r=Array.isArray(e);for(var n in void 0===t?t=r?[]:{}:Object(i.a)(t),r&&(t.length=e.length),e)t[n]=e[n];return t}},215:function(e,t,r){"use strict";var i={app:"https://www.gstatic.com/firebasejs/".concat("7.6.1","/firebase-app.js"),database:"https://www.gstatic.com/firebasejs/".concat("7.6.1","/firebase-database.js"),firestore:"https://www.gstatic.com/firebasejs/".concat("7.6.1","/firebase-firestore.js")},n=r(144),s=r(113),o=r(145),a=function(e){var t;for(var r in e)if(e[r]&&(t=u[r])&&!t())return!1;return!0},u={database:function(){return void 0!==firebase.database},firestore:function(){return void 0!==firebase.firestore}},c=function e(t){return a(t)?Promise.resolve():Object(o.a)(10).then(function(){return e(t)})};t.a=function(e,t){return e=Object(n.a)(i,e),Object(s.a)(e.app).then(function(){var t,r=[];for(var i in e)"app"!==i&&(t=e[i])&&r.push(Object(s.a)(t));return 0===r.length?Promise.resolve():Promise.all(r)}).then(function(){return c(e)}).then(function(){return void 0!==t&&firebase.initializeApp(t),Promise.resolve()})}},227:function(e,t,r){"use strict";var i=r(93),n=r(51),s=r(4);n.a.register("broadcast",function(e){return new i.a(e)}),Object(s.a)(window,"RexPlugins.Fire.Broadcast",i.a);i.a},228:function(e,t,r){"use strict";var i=r(94),n=r(51),s=r(4);n.a.register("onlineUserList",function(e){return new i.a(e)}),Object(s.a)(window,"RexPlugins.Fire.OnlineUserList",i.a);i.a},229:function(e,t,r){"use strict";var i=r(92),n=r(51),s=r(4);n.a.register("pageLoader",function(e){return new i.a(e)}),Object(s.a)(window,"RexPlugins.Fire.PageLoader",i.a);i.a},230:function(e,t,r){"use strict";var i=r(1),n=r(0),s=r.n(n),o=r(94),a=function(){this.emit("room.leave");var e=this;setTimeout(function(){e.roomID=void 0,e.roomName=void 0,e.doorState=void 0,e.leftRoomFlag=!1},0)},u=function(e){var t=new o.a({eventEmitter:this.getEventEmitter(),eventNames:{join:"userlist.join",leave:"userlist.leave",update:"userlist.update",change:"userlist.change",init:"userlist.init",changename:"userlist.changename"},userID:this.userInfo});return t.on("userlist.leave",function(e){e.userID===this.userID&&a.call(this)},this),this.on("room.join",function(){t.startUpdate()}).on("room.leave",function(){t.stopUpdate().clear()}),t},c=r(115),h=function(e){return new c.a({eventEmitter:this.getEventEmitter(),root:this.getRoomFilterRef(),itemIDKey:"roomID",eventNames:{update:"roomlist.update",add:"roomlist.add",remove:"roomlist.remove",change:"roomlist.change"},mode:"once"})},f=r(93),l=function(e){var t=new f.a({eventEmitter:this.getEventEmitter(),eventNames:{receive:"broadcast.receive"},receiverID:"boradcast",senderID:this.userInfo,history:s()(e,"boradcast.history",!1)});return this.on("room.join",function(e){t.setRootPath(this.getRoomDataPath(e.roomID)).startReceiving()},this).on("room.leave",function(){t.stopReceiving()},this).on("userlist.changename",function(e,r){t.changeUserName(e,r)},this),t},v=r(20),m=r.n(v),d=r(144),g=function(e,t){return void 0===t&&(t=""),"".concat(e,"|").concat(t)},y=function(e){this.roomID=e.roomID,this.roomName=e.roomName,this.roomType=e.roomType,this.emit("room.join",e)},I=function(e){return this.getRoomAliveRef(e).transaction(function(e){return null===e||void 0})},p=function(e){var t=(e=Object(d.a)(b,e)).roomID,r=e.roomName,i=e.roomType,n=e.door,s=e.join,o=e.filterData,a=this.getRoomRef(t),u=this.getRoomFilterRef(t),c=this.getRoomDataRef(t);this.isRemoveRoomWhenLeft=!e.presisted,this.isRemoveRoomWhenLeft&&(a.onDisconnect().remove(),u.onDisconnect().remove(),c.onDisconnect().remove());var h=g(n,i),f={},l={filter:h,name:r};o&&(l.data=o),f["room-filters/".concat(t)]=l;var v={name:r,filter:h,maxUsers:e.maxUsers,moderators:{}};v.moderators[this.userID]=this.userName,f["room-data/".concat(t)]=v;var m=this;return new Promise(function(r,i){if(s){var n=m.userList.setRootPath(m.getUserListPath(t)).setMaxUsers(0).join();return m.userList.setMaxUsers(e.maxUsers),n.then(r,i)}return r()}).then(function(){return m.getRootRef().update(f)}).then(function(){return m.isRoomCreator=!0,s&&y.call(m,e),Promise.resolve(e)})},b={roomID:"",roomName:"",roomType:"",maxUsers:0,presisted:!1,door:"open",join:!0,filterData:void 0},D=function(e){void 0===e&&(e={}),null==e.roomID&&(e.roomID=this.getRoomRef().push().key);var t=this;return I.call(t,e.roomID).then(function(){return p.call(t,e)})},P=r(114),R=function e(t,r,i,n){if(n.roomID=Object(P.a)(t,t,r),i<=0)return Promise.reject(n);i--;var s=this;return this.createRoom(n).catch(function(){return e.call(s,t,r,i,n)})},w=function(e){void 0===e&&(e={});var t=s()(e,"digits",10),r=s()(e,"candidates","0123456789"),i=s()(e,"retry",1e3);return R.call(this,t,r,i,e)},k=function(e){if(void 0===s()(e,"roomID",void 0))return Promise.reject();this.isRemoveRoomWhenLeft=!1;var t=this;return x.call(t,e).then(function(r){return t.userList.setRootPath(t.getUserListPath(e.roomID)).setMaxUsers(r.maxUsers).join()}).then(function(){return y.call(t,e),Promise.resolve(e)})},x=function(e){var t=this;return this.getRoomDataRef(e.roomID).once("value").then(function(r){var i=r.val();return null===i?Promise.reject():(e.roomName=i.name,e.roomType=i.filter.split("|")[1],t.isRoomOpened(i)?Promise.resolve(i):Promise.reject())})},E=function(e){var t=this;return s()(e,"leftThenJoin",!0)?this.leaveRoom().then(function(){return k.call(t,e)}):k.call(t,e)},j=r(65),O=r.n(j),F=function e(t,r,i){if(i===r.length)return Promise.reject();t.roomID=r[i].roomID,i++;var n=this;return this.joinRoom(t).catch(function(){return e.call(n,t,r,i)})},N={getRootRef:function(e){var t=this.database.ref(this.rootPath);return e&&(t=t.child(e)),t},getRoomRef:function(e,t){var r=this.getRootRef("rooms");return void 0!==e&&(r=r.child(e),void 0!==t&&(r=r.child(t))),r},getRoomAliveRef:function(e){return this.getRoomRef(e,"alive")},getUserListRef:function(e){return this.getRoomRef(e,"users")},getRoomFilterRef:function(e){var t=this.getRootRef("room-filters");return void 0!==e&&(t=t.child(e)),t},getRoomDataRef:function(e){var t=this.getRootRef("room-data");return void 0!==e&&(t=t.child(e)),t},getUserDataRef:function(e){var t=this.getRootRef("user-data");return void 0!==e&&(t=t.child(e)),t},getRoomDataPath:function(e,t){var r="".concat(this.rootPath,"/rooms/").concat(e);return t&&(r+="/".concat(t)),r},getUserListPath:function(e){return this.getRoomDataPath(e,"users")},getRoomListQuery:function(e,t){void 0===t&&(t="open");var r=this.getRoomFilterRef();return r=r.orderByChild("filter"),r=void 0===e?r.startAt(t).endAt("".concat(t,"~")):r.equalTo(g(t,e))}},L={createRoom:D,createRandomRoom:w,joinRoom:E,joinRandomRoom:function(e){void 0===e&&(e={});var t=s()(e,"roomType",""),r=s()(e,"door","open"),i=this;return this.getRoomList(t,r).then(function(t){return O()(t),F.call(i,e,t,0)})},leaveRoom:function(){if(!this.isInRoom())return Promise.resolve();if(this.leftRoomFlag=!0,this.isRemoveRoomWhenLeft)return this.removeRoom();var e=this.getRoomInfo();return this.userList.leave().then(function(){return Promise.resolve(e)})},removeRoom:function(e){if(void 0===e&&(e=this.roomID),void 0===e)return Promise.resolve();var t={};t["room-filter/".concat(e)]=null,t["room-data/".concat(e)]=null,t["rooms/".concat(e)]=null;var r=this.getRoomInfo();return this.getRootRef().update(t).then(function(){return Promise.resolve(r)})},kickUser:function(e){return this.userList.contains(e)?e===this.userID?this.leaveRoom():this.userList.leave(e):Promise.resolve()},isRoomOpened:function(e){if(null==e)return!1;if("closed"===e.filter.split("|")[0])return!1;var t=this.userID;if(e.moderators.hasOwnProperty(t))return!0;switch(e.permission){case"black-list":var r=e["black-list"];return!(r&&r.hasOwnProperty(t));case"white-list":var i=e["white-list"];return i&&i.hasOwnProperty(t);default:return!0}},changeRoomState:function(e,t){1===arguments.length&&(t=e,e=void 0),void 0===e&&(e=this.roomID);var r=this;return this.hasRoom(e).then(function(i){if(!i)return Promise.resolve();var n=g(t,r.roomType),s={};return s["room-filters/".concat(e,"/filter")]=n,s["room-data/".concat(e,"/filter")]=n,r.getRootRef().update(s)})},changeFilterData:function(e,t){1===arguments.length&&(t=e,e=void 0),void 0===e&&(e=this.roomID);var r=this;return this.hasRoom(e).then(function(i){return i?r.getRoomFilterRef(e).child("data").update(t):Promise.resolve()})},changeUserName:function(e){return this.userList.changeUserName(e)},changeRoomName:function(e,t){1===arguments.length&&(t=e,e=void 0),void 0===e&&(e=this.roomID);var r=this;return this.hasRoom(e).then(function(i){if(!i)return Promise.resolve();var n={};return n["room-filters/".concat(e,"/name")]=t,n["room-data/".concat(e,"/name")]=t,r.getRootRef().update(n)})},openRoom:function(e){return this.setRoomState(e,"open")},closeRoom:function(e){return this.setRoomState(e,"closed")},getUserList:function(e){if(void 0===e)return this.userList.getUsers();var t=this;return new Promise(function(r,i){new c.a({itemIDKey:"joinAt",mode:"once"}).once("update",function(e){r(e)}).startUpdate(t.getUserListRef(e))})},getRoomList:function(e,t){var r=this;return new Promise(function(i,n){r.roomList.once("roomlist.update",function(e){i(e)}).startUpdate(r.getRoomListQuery(e,t))})},hasRoom:function(e){return e===this.roomID?Promise.resolve(!0):this.getRoomDataRef(e).once("value").then(function(e){var t=null!==e.val();return Promise.resolve(t)})}};Object.assign(L,N);var U=L;function C(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var _=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=s()(t,"eventEmitter",void 0),i=s()(t,"EventEmitterClass",void 0);this.setEventEmitter(r,i),this.database=firebase.database(),this.rootPath=s()(t,"root",""),this.userInfo={userID:"",userName:""},this.setUser(s()(t,"userID",""),s()(t,"userName","")),this.isRoomCreator=!1,this.roomID=void 0,this.roomName=void 0,this.roomType=void 0,this.doorState=void 0,this.leftRoomFlag=!1,this.isRemoveRoomWhenLeft=void 0,this.userList=u.call(this,t),this.roomList=h.call(this,t),this.broadcast=l.call(this,t)}var t,r,i;return t=e,(r=[{key:"shutdown",value:function(){var e=this;this.destroyEventEmitter().leaveRoom().then(function(){e.userList.destroy(),e.userList=void 0,e.roomList.destroy(),e.roomList=void 0,e.broadcast.destroy(),e.broadcast=void 0})}},{key:"destroy",value:function(){this.shutdown()}},{key:"getRoomInfo",value:function(e,t){return void 0===e&&(e=this.roomID),void 0===t&&(t=this.roomName),{roomID:e,roomName:t}}},{key:"setUser",value:function(e,t){return m()(e)?this.userInfo=e:(this.userID=e,this.userName=t),this}},{key:"isInRoom",value:function(e){return void 0===e?void 0!==this.roomID:this.roomID===e}},{key:"send",value:function(e){return this.broadcast.send(e)}},{key:"getBroadcastHistory",value:function(){return this.broadcast.getHistory()}},{key:"userID",get:function(){return this.userInfo.userID},set:function(e){this.userInfo.userID=e}},{key:"userName",get:function(){return this.userInfo.userName},set:function(e){this.userInfo.userName=e}},{key:"maxUsers",get:function(){return this.userList.maxUsers}}])&&C(t.prototype,r),i&&C(t,i),e}();Object.assign(_.prototype,i.a,U);var Q=_,T=r(51),M=r(4);T.a.register("room",function(e){return new Q(e)}),Object(M.a)(window,"RexPlugins.Fire.Room",Q)},231:function(e,t,r){"use strict";var i=r(0),n=r.n(i),s=r(20),o=r.n(s),a=function(e){var t=e?new Date(e):new Date,r=t.getFullYear(),i=t.getMonth()+1,n=t.getDate(),s=new Date(t.getFullYear(),0,1),o=Math.ceil(((t-s)/864e5+s.getDay()+1)/7);return{d:"".concat(r,"-").concat(i,"-").concat(n),w:"".concat(r,"-").concat(o),m:"".concat(r,"-").concat(i),y:"".concat(r)}},u={d:"tagD",w:"tagW",m:"tagM",y:"tagY"},c={d:"scoreD",w:"scoreW",m:"scoreM",y:"scoreY"},h={d:"day",w:"week",m:"month",y:"year"},f=function(e,t){var r={userID:this.userID};void 0!==this.boardID&&(r.boardID=this.boardID),this.userName&&(r.userName=this.userName);var i=a();if(!1!==this.timeFilters)for(var n in this.timeFilters)this.timeFilters[n]&&(r[u[n]]=i[n],r[c[n]]=e);else r.score=e;this.tag&&(r.tag=this.tag),t&&Object.assign(r,t);i=a();var s=this;return this.getMyRecordQuery().get().then(function(e){var t,i;if(e.size>0){var n=e.docs[0];t=n.data(),i=n.id}if(t)if(!1!==s.timeFilters){for(var o in s.timeFilters)if(s.timeFilters[o]){var a=u[o];if(t[a]===r[a]){var h=c[o];r[h]=Math.max(t[h],r[h])}}}else r.score=Math.max(t.score,r.score);return void 0===i&&(i=s.rootRef.doc().id),s.rootRef.doc(i).set(r)})},l={loadFirstPage:function(){this.resetPageQuery();var e=this;return this.page.loadFirstPage().then(function(t){return Promise.resolve(v.call(e,t))})},loadNextPage:function(){this.resetPageQuery();var e=this;return this.page.loadNextPage().then(function(t){return Promise.resolve(v.call(e,t))})},loadPreviousPage:function(){this.resetPageQuery();var e=this;return this.page.loadPreviousPage().then(function(t){return Promise.resolve(v.call(e,t))})},loadCurrentPage:function(){this.resetPageQuery();var e=this;return this.page.loadCurrentPage().then(function(t){return Promise.resolve(v.call(e,t))})},load:function(e,t){this.resetPageQuery();var r=this;return this.page.load(e,t).then(function(e){return Promise.resolve(v.call(r,e))})},resetPageQuery:function(){return this.resetQueryFlag?(this.resetQueryFlag=!1,this.page.setQuery(this.getPageQuery()),this):this}},v=function(e){for(var t,r=[],i=c[this.timeFilterType[0]],n=0,s=e.length;n<s;n++){if(t=e[n].data(),!1!==this.timeFilters)for(var o in t.score=t[i],this.timeFilters)delete t[u[o]],delete t[c[o]];r.push(t)}return r},m=l,d=function(e){var t=this;return this.getMyRecordQuery(e).get().then(function(e){var r;if(e.size>0&&(r=e.docs[0].data(),!1!==t.timeFilters)){var i={};for(var n in t.timeFilters)i[h[n]]=[r[c[n]],r[u[n]]],delete r[u[n]],delete r[c[n]];r.scores=i}return Promise.resolve(r)})},g=r(147),y=function(e,t){var r={doc:void 0,index:void 0},i=0;return Object(g.a)({query:e,forEachPageCallback:function(e){for(var n,s=e.docs,o=0,a=s.length;o<a;o++)if(n=s[o],t(n))return r.doc=n,r.index=i+o,!0;i+=e.size},resolveCallback:function(){return r}})},I=function(e){void 0===e&&(e=this.userID);var t=this.getPageQuery().next;return y(t,function(t){return t.data().userID===e}).then(function(t){return Promise.resolve({userID:e,rank:t.index})})},p=r(66),b=function(e){return Object(p.a)(e).then(function(e){if(0===e.length)return Promise.resolve();for(var t,r,i=[],n=0,s=e.length;n<s;n++)void 0===t&&(t=firebase.firestore().batch(),r=0),t.delete(e[n].ref),++r>=500&&(i.push(t.commit()),t=void 0);return t&&i.push(t.commit()),Promise.all(i)})},D={deleteUserScore:function(e){void 0===e&&(e=this.userID);var t=this.getRecordQuery(void 0,void 0,e,void 0);return b(t)},deleteBoard:function(e,t){void 0===e&&(e=this.boardID),void 0===t&&(t=this.tag);var r=this.getRecordQuery(e,t,void 0,void 0);return b(r)}},P={getRecordQuery:function(e,t,r,i){var n=this.rootRef;return n=void 0!==e?n.where("boardID","==",e):n,n=void 0!==t?n.where("tag","==",t):n,n=void 0!==r?n.where("userID","==",r):n,void 0!==i&&(n=n.where(i[0],"==",i[1])),n},getMyRecordQuery:function(e){return void 0===e&&(e=this.userID),this.getRecordQuery(this.boardID,this.tag,e,void 0).limit(1)},getPageQuery:function(){var e,t;if(!1!==this.timeFilters){var r=this.timeFilterType[0];e=[u[r],a()[r]],t=c[r]}else e=void 0,t="score";var i=this.getRecordQuery(this.boardID,this.tag,void 0,e);return{next:i.orderBy(t,"desc"),previous:i.orderBy(t)}}},R=r(92);function w(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var k=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.database=firebase.firestore(),this.setRootPath(n()(t,"root","")),this.userInfo={userID:void 0,userName:void 0},this.setUser(n()(t,"userID",""),n()(t,"userName",void 0)),this.setBoardID(n()(t,"boardID",void 0)),this.setTag(n()(t,"tag",void 0)),this.setTimeFilters(n()(t,"timeFilters",!1)),this.setTimeFilterType(n()(t,"timeFilterType","year")),this.page=new R.a({dataMode:"dynamic",itemCount:n()(t,"pageItemCount",10)}),this.resetQueryFlag=!0}var t,r,i;return t=e,(r=[{key:"shutdown",value:function(){}},{key:"destroy",value:function(){this.shutdown()}},{key:"setRootPath",value:function(e){return this.resetQueryFlag|=this.rootPath!==e,this.rootPath=e,this.rootRef=this.database.collection(e),this}},{key:"setUser",value:function(e,t){return o()(e)?this.userInfo=e:(this.userID=e,this.userName=t),this}},{key:"setBoardID",value:function(e){return this.resetQueryFlag|=this.boardID!==e,this.boardID=e,this}},{key:"setTag",value:function(e){return this.resetQueryFlag|=this.tag!==e,this.tag=e,this}},{key:"setTimeFilters",value:function(e){return this.timeFilters=!1!==e&&{d:n()(e,"day",!0),w:n()(e,"week",!0),m:n()(e,"month",!0),y:n()(e,"year",!0)},this}},{key:"setTimeFilterType",value:function(e){return this.resetQueryFlag|=this.timeFilterType!==e,this.timeFilterType=e,this}},{key:"setPageItemCount",value:function(e){return this.page.setItemCount(e),this}},{key:"isFirstPage",value:function(){return 0===this.page.pageIndex}},{key:"isLastPage",value:function(){return!1===this.page.isFullPage}},{key:"userID",get:function(){return this.userInfo.userID},set:function(e){this.userInfo.userID=e}},{key:"userName",get:function(){return this.userInfo.userName},set:function(e){this.userInfo.userName=e}}])&&w(t.prototype,r),i&&w(t,i),e}(),x={post:f,getScore:d,getRank:I};Object.assign(k.prototype,x,P,m,D);var E=k,j=r(51),O=r(4);j.a.register("leaderBoard",function(e){return new E(e)}),Object(O.a)(window,"RexPlugins.Fire.LeaderBoard",E)},233:function(e,t,r){"use strict";var i=r(1),n=r(0),s=r.n(n),o=r(94),a=function(){this.emit("room.leave");var e=this;setTimeout(function(){e.leftRoomFlag=!1},0)},u=function(e){var t=new o.a({eventEmitter:this.getEventEmitter(),eventNames:{join:"userlist.join",leave:"userlist.leave",update:"userlist.update",change:"userlist.change",init:"userlist.init",changename:"userlist.changename"},root:this.getUserListPath(),userID:this.userInfo,maxUsers:s()(e,"maxUsers",0)});return t.on("userlist.leave",function(e){e.userID===this.userID&&a.call(this)},this),this.on("room.join",function(){t.startUpdate()}).on("room.leave",function(){t.stopUpdate().clear()}),t},c=r(93),h=function(e){var t=new c.a({eventEmitter:this.getEventEmitter(),eventNames:{receive:"broadcast.receive"},root:this.rootPath,receiverID:"broadcast",senderID:this.userInfo,history:s()(e,"broadcast.history",!1)});return this.on("room.join",function(){t.startReceiving()}).on("room.leave",function(){t.stopReceiving()}).on("userlist.changename",function(e,r){t.changeUserName(e,r)},this),t},f=r(20),l=r.n(f),v={getRoomRef:function(e){var t=this.database.ref(this.rootPath);return e&&(t=t.child(e)),t},getUserListRef:function(){return this.getRoomRef("users")},getRoomDataPath:function(e){var t=this.rootPath;return e&&(t+="/".concat(e)),t},getUserListPath:function(){return this.getRoomDataPath("users")}},m={joinRoom:function(){var e=this;return this.userList.join().then(function(){return e.emit("room.join"),Promise.resolve()})},leaveRoom:function(){return this.isInRoom()?(this.leftRoomFlag=!0,this.userList.leave()):Promise.resolve()},kickUser:function(e){return this.userList.contains(e)?e===this.userID?this.leaveRoom():this.userList.leave(e):Promise.resolve()},changeUserName:function(e){return this.userList.changeUserName(e)},getUserList:function(){return this.userList.getUsers()}};Object.assign(m,v);var d=m;function g(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var y=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=s()(t,"eventEmitter",void 0),i=s()(t,"EventEmitterClass",void 0);this.setEventEmitter(r,i),this.database=firebase.database(),this.rootPath=s()(t,"root",""),this.userInfo={userID:"",userName:""},this.setUser(s()(t,"userID",""),s()(t,"userName","")),this.leftRoomFlag=!1,this.userList=u.call(this,t),this.broadcast=h.call(this,t)}var t,r,i;return t=e,(r=[{key:"shutdown",value:function(){}},{key:"destroy",value:function(){this.shutdown()}},{key:"setUser",value:function(e,t){return l()(e)?this.userInfo=e:(this.userID=e,this.userName=t),this}},{key:"isInRoom",value:function(){return this.userList.isInList}},{key:"send",value:function(e){return this.broadcast.send(e)}},{key:"getBroadcastHistory",value:function(){return this.broadcast.getHistory()}},{key:"userID",get:function(){return this.userInfo.userID},set:function(e){this.userInfo.userID=e}},{key:"userName",get:function(){return this.userInfo.userName},set:function(e){this.userInfo.userName=e}},{key:"maxUsers",get:function(){return this.userList.maxUsers}}])&&g(t.prototype,r),i&&g(t,i),e}();Object.assign(y.prototype,i.a,d);var I=y,p=r(51),b=r(4);p.a.register("singleRoom",function(e){return new I(e)}),Object(b.a)(window,"RexPlugins.Fire.SingleRoom",I)},235:function(e,t,r){"use strict";var i=r(0),n=r.n(i),s=function(e,t){var r=this;return this.database.runTransaction(function(i){var n=r.getAliasRef(t);return i.get(n).then(function(r){return r.exists?Promise.reject({id:e,alias:t}):(i.set(n,{id:e}),Promise.resolve({id:e,alias:t}))})})},o=function(e,t){var r=this;return this.getAlias(e).then(function(i){return i.alias?i.alias===t?Promise.resolve({id:e,alias:t}):Promise.reject({id:e,alias:t}):s.call(r,e,t)})},a=r(114),u=function e(t,r,i,n){var o=Object(a.a)(r,r,i);if(n<=0)return Promise.reject({id:t,alias:o});n--;var u=this;return s.call(u,t,o).catch(function(){setTimeout(function(){return e.call(u,t,r,i,n)},0)})},c=function(e,t){var r=n()(t,"digits",10),i=n()(t,"candidates","0123456789"),s=n()(t,"retry",1e3),o=this;return this.getAlias(e).then(function(t){if(t.alias){var n=Object(a.a)(r,r,i);return t.alias===n?Promise.resolve({id:e,alias:n}):Promise.reject({id:e,alias:n})}return u.call(o,e,r,i,s)})},h=function(e){return this.getAliasRef(e).get().then(function(t){var r;return t.exists&&(r=t.data().id),Promise.resolve({id:r,alias:e})})},f=function(e){return this.rootRef.where("id","==",e).limit(1).get().then(function(t){var r;return t.size>0&&(r=t.docs[0].id),Promise.resolve({id:e,alias:r})})},l=function(e,t){var r=n()(t,"digits",10),i=n()(t,"candidates","0123456789"),s=n()(t,"retry",1e3),o=this;return this.getAlias(e).then(function(t){return t.alias?Promise.resolve(t):u.call(o,e,r,i,s)})},v=function(e){var t=this;return this.getAlias(e).then(function(e){return t.getAliasRef(e).delete()})};function m(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.database=firebase.firestore(),this.setRootPath(n()(t,"root",""))}var t,r,i;return t=e,(r=[{key:"shutdown",value:function(){}},{key:"destroy",value:function(){this.shutdown()}},{key:"setRootPath",value:function(e){return this.rootPath=e,this.rootRef=this.database.collection(e),this}},{key:"getAliasRef",value:function(e){return this.rootRef.doc(e)}}])&&m(t.prototype,r),i&&m(t,i),e}(),g={add:o,addRandom:c,getId:h,getAlias:f,getRandomAlias:l,remove:v};Object.assign(d.prototype,g);var y=d,I=r(51),p=r(4);I.a.register("idAlias",function(e){return new y(e)}),Object(p.a)(window,"RexPlugins.Fire.IdAlias",y)},236:function(e,t,r){"use strict";var i=r(0),n=r.n(i),s=r(20),o=r.n(s),a=function(e){var t=e.data();return t.headerDocID=e.id,t},u=function(e){var t=this.userID,r=this.cacheHeaders[e];if(r&&r.userID===t)return Promise.resolve(r);var i=this;return this.getFileQuery(t,e,"header").limit(1).get().then(function(t){var r=void 0;if(t.size>0){var n=t.docs[0];r=a(n),i.cacheHeaders[e]=r}return Promise.resolve(r)})},c=function(e,t,r,i){"boolean"==typeof r&&(i=r,r=void 0),void 0===i&&(i=!1);var n=this.userID;void 0===t&&(t={}),t.userID=n,t.fileID=e,t.type="header",r&&(r.userID=n,r.fileID=e,r.type="content");var s=i?"update":"set",o=this;return u.call(this,e).then(function(e){var i,n;e?(i=o.rootRef.doc(e.headerDocID),r&&(n=e.contentDocID?o.rootRef.doc(e.contentDocID):o.rootRef.doc())):(i=o.rootRef.doc(),r&&(n=o.rootRef.doc())),t.hasOwnProperty("headerDocID")&&delete t.headerDocID,n&&(t.contentDocID=n.id);var a=o.database.batch();return a[s](i,t),r&&a[s](n,r),a.commit()}).then(function(){return Promise.resolve({userID:n,fileID:e})}).catch(function(t){return Promise.reject({error:t,userID:n,fileID:e})})},h=function(e){var t=this.userID;return this.getFileQuery(t,e).get().then(function(r){var i,n;return r.forEach(function(e){switch(docData.type){case"header":i=a(e);break;case"content":n=e.data()}}),Promise.resolve({userID:t,fileID:e,header:i,content:n})}).catch(function(){return Promise.reject({error:error,userID:t,fileID:e})})},f=r(9),l=function(){var e=this.userID,t=this;return this.getFileQuery(e,void 0,"header").get().then(function(r){var i;return Object(f.a)(t.cacheHeaders),r.forEach(function(e){i=a(e),t.cacheHeaders[i.fileID]=i}),Promise.resolve({userID:e,headers:t.cacheHeaders})}).catch(function(){return Promise.reject({error:error,userID:e})})},v=function(e){var t=this.userID,r=this;return LoadHeader.call(this,e).then(function(i){if(!i)return Promise.resolve({userID:t,fileID:e});var n=r.database.batch();return n.delete(r.rootRef.doc(i.headerDocID)),i.contentDocID&&n.delete(r.rootRef.doc(i.contentDocID)),n.commit()}).then(function(){return r.cacheHeaders.hasOwnProperty(e)&&delete r.cacheHeaders[e],Promise.resolve({userID:t,fileID:e})}).catch(function(r){return Promise.reject({error:r,userID:t,fileID:e})})},m=function(){var e=this.userID,t=this;return this.getFileQuery(e,void 0,"header").get().then(function(e){var r,i=t.database.batch();return e.forEach(function(e){r=DocToHeader(e),i.delete(t.rootRef.doc(r.headerDocID)),r.contentDocID&&i.delete(t.rootRef.doc(r.contentDocID))}),i.commit()}).then(function(){return t.clearCache(),Promise.resolve({userID:e})}).catch(function(t){return Promise.reject({error:t,userID:e})})};function d(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var g=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.database=firebase.firestore(),this.setRootPath(n()(t,"root","")),this.cacheHeaders={},this.userInfo={userID:""},this.setOwner(n()(t,"userID",""))}var t,r,i;return t=e,(r=[{key:"shutdown",value:function(){}},{key:"destroy",value:function(){this.shutdown()}},{key:"setRootPath",value:function(e){return this.rootPath=e,this.rootRef=this.database.collection(e),this}},{key:"setOwner",value:function(e){var t=this.userID;return o()(e)?this.userInfo=e:this.userID=e,t!==this.userID&&this.clearCache(),this}},{key:"clearCache",value:function(){return Object(f.a)(this.cacheHeaders),this}},{key:"getFileQuery",value:function(e,t,r){var i=this.rootRef;return i=e?i.where("userID","==",e):i,i=t?i.where("fileID","==",t):i,i=r?i.where("type","==",r):i}},{key:"userID",get:function(){return this.userInfo.userID},set:function(e){this.userInfo.userID=e}}])&&d(t.prototype,r),i&&d(t,i),e}(),y={save:c,load:h,loadHeaders:l,delete:v,clear:m};Object.assign(g.prototype,y);var I=g,p=r(51),b=r(4);p.a.register("files",function(e){return new I(e)}),Object(b.a)(window,"RexPlugins.Fire.Files",I)},237:function(e,t,r){"use strict";var i=r(1),n=r(0),s=r.n(n),o=r(20),a=r.n(o),u=function(e){var t={senderID:this.userID,message:e,timestamp:firebase.firestore.FieldValue.serverTimestamp()};return void 0!==this.userName&&(t.senderName=this.userName),void 0!==this.receiverID&&(t.receiverID=this.receiverID),this.rootRef.add(t)},c={startReceiving:function(){var e=this.getReceiverQuery(this.receiverID).orderBy("timestamp","desc").limit(1),t=this;return this.unsubscribe=e.onSnapshot({includeMetadataChanges:!0},function(e){if(e.size>0){var r=e.docs[0];if(r.metadata.hasPendingWrites)return void(t.skipFirst&&(t.skipFirst=!1));if(t.resetPageQuery(t.receiverID,r),t.skipFirst)t.skipFirst=!1;else{var i=h(r);t.cacheMessages.push(i),t.emit("receive",i)}}else t.skipFirst&&(t.skipFirst=!1)},function(e){}),this},stopReceiving:function(){return this.unsubscribe&&this.unsubscribe(),this.resetQueryFlag=!0,this.cacheMessages.length=0,this},loadPreviousMessages:function(){this.resetPageQuery(this.receiverID);var e=this;return this.page.loadNextPage().then(function(t){for(var r,i=[],n=0,s=t.length;n<s;n++)i.push(h(t[n]));return(r=e.cacheMessages).splice.apply(r,[0,0].concat(i)),Promise.resolve(i)})},resetPageQuery:function(e,t){if(!this.resetQueryFlag)return this;this.resetQueryFlag=!1;var r=this.skipFirst?"startAt":"startAfter";return this.page.setBaselineDoc(t,r).setQuery(this.getPageQuery(e)),this}},h=function(e){var t=e.data();return t.timestamp=1e3*t.timestamp.seconds,t},f=c,l={getReceiverQuery:function(e){void 0===e&&(e=this.receiverID);var t=this.rootRef;return t=void 0!==e?t.where("receiverID","==",e):t},getPageQuery:function(e){var t=this.getReceiverQuery(e);return{next:t.orderBy("timestamp"),previous:t.orderBy("timestamp","desc")}}},v=r(92);function m(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=s()(t,"eventEmitter",void 0),i=s()(t,"EventEmitterClass",void 0);this.setEventEmitter(r,i),this.database=firebase.firestore(),this.setRootPath(s()(t,"root","")),this.userInfo={userID:"",userName:void 0},this.setSender(s()(t,"senderID",""),s()(t,"senderName","")),this.setReceiver(s()(t,"receiverID",void 0)),this.skipFirst=!0,this.unsubscribe=void 0,this.page=new v.a,this.setPageItemCount(s()(t,"pageItemCount",100)),this.resetQueryFlag=!0,this.cacheMessages=[]}var t,r,i;return t=e,(r=[{key:"shutdown",value:function(){this.stopReceiving().destroyEventEmitter()}},{key:"destroy",value:function(){this.shutdown()}},{key:"setRootPath",value:function(e){return this.resetQueryFlag|=this.rootPath!==e,this.rootPath=e,this.rootRef=this.database.collection(e),this}},{key:"setSender",value:function(e,t){return a()(e)?this.userInfo=e:(this.userID=e,this.userName=t),this}},{key:"setReceiver",value:function(e){return this.resetQueryFlag|=this.receiverID!==e,this.receiverID=e,this}},{key:"setPageItemCount",value:function(e){return this.page.setItemCount(e),this}},{key:"userID",get:function(){return this.userInfo.userID},set:function(e){this.userInfo.userID=e}},{key:"userName",get:function(){return this.userInfo.userName},set:function(e){this.userInfo.userName=e}},{key:"hasPreviousMessage",get:function(){return!1!==this.page.isFullPage}}])&&m(t.prototype,r),i&&m(t,i),e}(),g={send:u};Object.assign(d.prototype,i.a,g,f,l);var y=d,I=r(51),p=r(4);I.a.register("messages",function(e){return new y(e)}),Object(p.a)(window,"RexPlugins.Fire.Messages",y)},326:function(e,t,r){"use strict";r.r(t);var i=r(215),n=r(126),s=function(e,t){return this.addFile(new n.a(this,{config:{callback:function(r,n){return Object(i.a)(e,t).then(function(){setTimeout(r,0)}).catch(n)}}})),this},o=r(51);r(227),r(228),r(230),r(233),r(229),r(236),r(235),r(231),r(237);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=c(this,h(t).call(this,e))).add=new o.a,r}var r,i,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,Phaser.Plugins.BasePlugin),r=t,(i=[{key:"start",value:function(){this.game.events.once("destroy",this.destroy,this)}},{key:"initializeApp",value:function(e){return this.add.initializeApp(e),this}},{key:"preload",value:function(e,t,r){return s.call(e.sys.load,t,r),this}}])&&u(r.prototype,i),n&&u(r,n),t}();t.default=l},4:function(e,t,r){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n=function(e){return null==e||""===e||0===e.length};t.a=function(e,t,r){if("object"===i(e))if(n(t)){if(null==r)return;"object"===i(r)&&(e=r)}else{"string"==typeof t&&(t=t.split("."));var s=t.pop();((function(e,t,r){void 0===r&&(r={});var s=e;if(n(t));else{var o;"string"==typeof t&&(t=t.split("."));for(var a=0,u=t.length;a<u;a++){var c;null!=s[o=t[a]]&&"object"===i(s[o])||(c=a===u-1?r:{},s[o]=c),s=s[o]}}return s})(e,t))[s]=r}}},51:function(e,t,r){"use strict";function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"register",value:function(t,r){e.prototype[t]=r}}],(r=[{key:"initializeApp",value:function(e){return firebase.initializeApp(e),this}}])&&i(t.prototype,r),n&&i(t,n),e}();t.a=n},65:function(e,t){e.exports=function(e){for(var t=e.length-1;t>0;t--){var r=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[r],e[r]=i}return e}},66:function(e,t,r){"use strict";var i=r(147);function n(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}t.a=function(e,t,r,s,o){void 0===t&&(t=1/0),void 0===r&&(r=0);var a=[],u=0;return Object(i.a)({query:e,totalLines:r+t,startDocRef:s,startMode:o,forEachPageCallback:function(e){var t,i=e.size,s=r-u;s<=0?t=e.docs:s<i&&(t=e.docs.slice(s,i)),t&&a.push.apply(a,n(t)),u+=i},resolveCallback:function(){return a}})}},74:function(e,t,r){"use strict";t.a=function(e,t){for(var r=document.getElementsByTagName("script"),i=0,n=r.length;i<n;i++)if(-1!=r[i].src.indexOf(e))return void(t&&t());var s=document.createElement("script");s.setAttribute("src",e),t&&(s.onload=t),document.head.appendChild(s)}},89:function(e,t){e.exports=function(e,t){return Math.floor(Math.random()*(t-e+1)+e)}},9:function(e,t,r){"use strict";t.a=function(e){if(Array.isArray(e))e.length=0;else for(var t in e)delete e[t]}},90:function(e,t){e.exports=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length);var i=t+Math.floor(Math.random()*r);return void 0===e[i]?null:e[i]}},92:function(e,t,r){"use strict";var i=r(0),n=r.n(i),s=r(20),o=r.n(s),a=r(66),u=function(){var e=this;return Object(a.a)(this.nextQuery,this.itemCount,0,this.baselineDocRef,this.baselineMode).then(function(t){var r=t.length;return e.cacheItems=t,e.pageIndex=0,e.startItemIndex=0,e.endItemIndex=e.startItemIndex+r-1,e.isFullPage=r===e.itemCount,e.prevPageEndDocRef=void 0,e.currPageStartDocRef=t[0],e.currPageEndDocRef=t[r-1],Promise.resolve(e.cacheItems)})},c=function(){var e=this;return Object(a.a)(this.nextQuery,this.itemCount,0,this.baselineDocRef,this.baselineMode).then(function(t){var r=t.length;return e.cacheItems=t,e.pageIndex=0,e.startItemIndex=0,e.endItemIndex=e.startItemIndex+r-1,e.isFullPage=r===e.itemCount,Promise.resolve(e.cacheItems)})},h=function(){return(0===this.dataMode?u:c).call(this)},f=function(){var e=this;return Object(a.a)(this.nextQuery,this.itemCount,0,this.currPageEndDocRef,"startAfter").then(function(t){var r=t.length;return e.cacheItems=t,e.pageIndex+=1,e.startItemIndex=e.endItemIndex+1,e.endItemIndex=e.startItemIndex+r-1,e.isFullPage=r===e.itemCount,e.prevPageEndDocRef=e.currPageEndDocRef,e.currPageStartDocRef=t[0],e.currPageEndDocRef=t[r-1],Promise.resolve(e.cacheItems)})},l=function(){var e=(this.pageIndex+1)*this.itemCount,t=this;return Object(a.a)(this.nextQuery,this.itemCount,e,this.baselineDocRef,this.baselineMode).then(function(e){var r=e.length;return t.cacheItems=e,t.pageIndex+=1,t.startItemIndex=t.endItemIndex+1,t.endItemIndex=t.startItemIndex+r-1,t.isFullPage=r===t.itemCount,Promise.resolve(t.cacheItems)})},v=function(){return void 0===this.pageIndex?this.loadFirstPage():(0===this.dataMode?f:l).call(this)},m=function(){var e=this;return Object(a.a)(this.prevQuery,this.itemCount+1,0,this.currPageStartDocRef,"startAfter").then(function(t){var r=t.length-1;return e.cacheItems=t,e.cacheItems.pop(),e.cacheItems.reverse(),e.pageIndex-=1,e.endItemIndex=e.startItemIndex-1,e.startItemIndex=e.endItemIndex-r+1,e.isFullPage=r===e.itemCount,e.prevPageEndDocRef=t[r],e.currPageStartDocRef=t[r-1],e.currPageEndDocRef=t[0],Promise.resolve(e.cacheItems)})},d=function(){var e=(this.pageIndex-1)*this.itemCount,t=this;return Object(a.a)(this.nextQuery,this.itemCount,e,this.baselineDocRef,this.baselineMode).then(function(e){var r=e.length;return t.cacheItems=e,t.pageIndex-=1,t.endItemIndex=t.startItemIndex-1,t.startItemIndex=t.endItemIndex-r+1,t.isFullPage=r===t.itemCount,Promise.resolve(t.cacheItems)})},g=function(){return void 0===this.pageIndex||1===this.pageIndex?this.loadFirstPage():(0===this.dataMode?m:d).call(this)},y=function(){var e=this;return Object(a.a)(this.nextQuery,this.itemCount,0,this.prevPageEndDocRef,"startAfter").then(function(t){var r=t.length;return e.cacheItems=t,e.endItemIndex=e.startItemIndex+r-1,e.isFullPage=r===e.itemCount,e.currPageStartDocRef=t[0],e.currPageEndDocRef=t[r-1],Promise.resolve(e.cacheItems)})},I=function(){var e=this.pageIndex*this.itemCount,t=this;return Object(a.a)(this.nextQuery,this.itemCount,e,this.baselineDocRef,this.baselineMode).then(function(e){var r=e.length;return t.cacheItems=e,t.endItemIndex=t.startItemIndex+r-1,t.isFullPage=r===t.itemCount,Promise.resolve(t.cacheItems)})},p=function(){return void 0===this.pageIndex||0===this.pageIndex?this.loadFirstPage():(0===this.dataMode?y:I).call(this)},b=function(e,t){void 0===t&&(t=0);var r=this;return Object(a.a)(this.nextQuery,e,t,this.baselineDocRef,this.baselineMode).then(function(i){var n=i.length;return r.cacheItems=i,r.pageIndex=void 0,r.startItemIndex=t,r.endItemIndex=r.startItemIndex+n-1,r.isFullPage=void 0===e||n===e,Promise.resolve(r.cacheItems)})};function D(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var P=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.setItemCount(n()(t,"itemCount",100)),this.setQuery(n()(t,"query",void 0)),this.setDataMode(n()(t,"dataMode",0)),this.setBaselineDoc(n()(t,"baselineDoc",void 0),n()(t,"baselineMode",void 0)),this.pageIndex=void 0,this.baselineDocRef=void 0,this.baselineMode="startAt",this.startItemIndex=void 0,this.endItemIndex=void 0,this.cacheItems=void 0,this.isFullPage=void 0}var t,r,i;return t=e,(r=[{key:"setItemCount",value:function(e){return this.itemCount=e,this}},{key:"setQuery",value:function(e,t){if(o()(e)){var r=e;this.nextQuery=r.next,this.prevQuery=r.previous}else this.nextQuery=e,this.prevQuery=t;return this.pageIndex=void 0,this.isFullPage=void 0,this}},{key:"setDataMode",value:function(e){return"string"==typeof e&&(e=w[e]),this.dataMode=e,this}},{key:"setBaselineDoc",value:function(e,t){return e?(this.baselineDocRef=e.ref,this.baselineMode=t):this.baselineDocRef=void 0,this}}])&&D(t.prototype,r),i&&D(t,i),e}(),R={loadFirstPage:h,loadNextPage:v,loadPreviousPage:g,loadCurrentPage:p,load:b};Object.assign(P.prototype,R);var w={static:0,dynamic:1};t.a=P},93:function(e,t,r){"use strict";var i=r(1),n=r(0),s=r.n(n),o=r(146),a=r(20),u=r.n(a),c=function(e){if(this.sendToRef&&this.sendToRef.key===this.receiverID||(this.sendToRef=this.database.ref(this.rootPath).child(this.receiverID)),void 0===e)return this.sendToRef.remove();var t={message:e,senderID:this.userID,stamp:this.stamp};return void 0!==this.userName&&(t.senderName=this.userName),this.skipFirst=!1,this.stamp=!this.stamp,this.sendToRef.set(t)},h={startReceiving:function(){return this.isReceiving&&this.receiverRef.key===this.receiverID?this:(this.stopReceiving(),this.isReceiving=!0,this.skipFirst=!0,this.receiverRef=this.database.ref(this.rootPath).child(this.receiverID),this.receiverRef.on("value",f,this),this.receiverRef.onDisconnect().remove(),this)},stopReceiving:function(){return this.isReceiving?(this.isReceiving=!1,this.receiverRef.off("value",f,this),this.receiverRef.remove(),this.receiverRef.onDisconnect().cancel(),this):this}},f=function(e){if(this.skipFirst)this.skipFirst=!1;else{var t=e.val();null!=t&&(delete t.stamp,this.history.add(t),this.emit(this.eventNames.receive,t))}},l=h;function v(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var m=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.maxLength=s()(t,"maxLength",-1),this.records=[]}var t,r,i;return t=e,(r=[{key:"add",value:function(e){return 0===this.maxLength?this:(this.records.push(e),this.maxLength>0&&this.records.length>this.maxLength&&this.records.shift(),this)}},{key:"clear",value:function(){return this.records.length=0,this}},{key:"changeUserName",value:function(e,t){return 0===this.maxLength?this:(this.records.forEach(function(r){r.senderID===e&&(r.senderName=t)}),this)}}])&&v(t.prototype,r),i&&v(t,i),e}();function d(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var g=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=s()(t,"eventEmitter",void 0),i=s()(t,"EventEmitterClass",void 0);this.setEventEmitter(r,i),this.eventNames=Object(o.a)(s()(t,"eventNames",{}),I),this.database=firebase.database(),this.setRootPath(s()(t,"root","")),this.skipFirst=!0,this.stamp=!1,this.userInfo={userID:"",userName:void 0},this.setSender(s()(t,"senderID",""),s()(t,"senderName","")),this.setReceiver(s()(t,"receiverID","")),this.isReceiving=!1;var n=s()(t,"history",0);!0===n?n=-1:!1===n&&(n=0),this.history=new m({maxLength:n})}var t,r,i;return t=e,(r=[{key:"shutdown",value:function(){this.stopReceiving().destroyEventEmitter()}},{key:"destroy",value:function(){this.shutdown()}},{key:"setRootPath",value:function(e){return this.rootPath=e,this.sendToRef=void 0,this.receiverRef=void 0,this}},{key:"setSender",value:function(e,t){return u()(e)?this.userInfo=e:(this.userID=e,this.userName=t),this}},{key:"setReceiver",value:function(e){return this.receiverID=e,this}},{key:"changeUserName",value:function(e,t){return e===this.userID&&(this.userName=t),this.history.changeUserName(e,t),this}},{key:"getHistory",value:function(){return this.history.records}},{key:"clearHistory",value:function(){return this.history.clear(),this}},{key:"userID",get:function(){return this.userInfo.userID},set:function(e){this.userInfo.userID=e}},{key:"userName",get:function(){return this.userInfo.userName},set:function(e){this.userInfo.userName=e}}])&&d(t.prototype,r),i&&d(t,i),e}(),y={send:c};Object.assign(g.prototype,i.a,l,y);var I={receive:"receive"};t.a=g},94:function(e,t,r){"use strict";var i=r(1),n=r(0),s=r.n(n),o=r(20),a=r.n(o),u=r(115),c=r(145),h=function(e,t){var r=!1;return e.forEach(function(e){if(e.val().userID===t)return r=!0,!0}),r},f=function(e,t){if(void 0===e&&(e=this.userID,t=this.userName),this.contains(e))return Promise.resolve();var r={userID:e,userName:t},i=this.maxUsers,n=this.database.ref(this.rootPath),s=n.push();return s.onDisconnect().remove().then(function(){return s.set(r)}).then(function(){return Object(c.a)(0)}).then(function(){return 0===i?(self.isInList=!0,Promise.resolve()):n.limitToFirst(i).once("value").then(function(t){return h(t,e)?(self.isInList=!0,Promise.resolve()):(self.isInList=!1,s.remove().then(function(){return s.onDisconnect().cancel()}).then(function(){return Promise.reject()}))})})},l=function(e){if(void 0===e&&(e=this.userID),!this.contains(e))return Promise.resolve();var t=this.userID2ItemID[e];return this.database.ref(this.rootPath).child(t).remove()},v=function(e){var t=this;return new Promise(function(e,r){var i=t.getUserRef();i?e(i):t.getRootRef().orderByChild("userID").equalTo(t.userID).once("child_added").then(function(t){e(t.ref)})}).then(function(t){return t.child("userName").set(e)}).then(function(){return t.userName=e,Promise.resolve()})};function m(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=s()(t,"eventEmitter",void 0),i=s()(t,"EventEmitterClass",void 0);this.setEventEmitter(r,i),this.database=firebase.database(),this.setRootPath(s()(t,"root","")),this.userInfo={userID:"",userName:""},this.setUser(s()(t,"userID",""),s()(t,"userName","")),this.setMaxUsers(s()(t,"maxUsers",0)),this.userList=new u.a({eventEmitter:this.getEventEmitter(),itemIDKey:"joinAt",eventNames:{add:s()(t,"eventNames.join","join"),remove:s()(t,"eventNames.leave","leave"),update:s()(t,"eventNames.update","update"),change:s()(t,"eventNames.change","change"),init:s()(t,"eventNames.init","init"),changename:s()(t,"eventNames.changename","changename")}}),this.isInList=!1,this.userID2ItemID={},this.userList.on(this.userList.eventNames.add,function(e){this.userID2ItemID[e.userID]=e.joinAt,e.userID===this.userInfo.userID&&this.emit(this.userList.eventNames.init,this.getUsers())},this).on(this.userList.eventNames.remove,function(e){delete this.userID2ItemID[e.userID],e.userID===this.userID&&(this.isInList=!1)},this).on(this.userList.eventNames.change,function(e,t){var r=e.userID,i=e.userName,n=t.userName;i!==n&&this.emit(this.userList.eventNames.changename,r,i,n)},this)}var t,r,i;return t=e,(r=[{key:"shutdown",value:function(){this.stopUpdate().destroyEventEmitter().leave(),this.userList.shutdown()}},{key:"destroy",value:function(){this.shutdown()}},{key:"setRootPath",value:function(e){return this.rootPath=e,this}},{key:"setUser",value:function(e,t){return a()(e)?this.userInfo=e:(this.userID=e,this.userName=t),this}},{key:"setMaxUsers",value:function(e){return this.maxUsers=e,this}},{key:"clear",value:function(){return this.userList.clear(),this}},{key:"forEach",value:function(e,t){return this.userList.forEach(e,t),this}},{key:"isFull",value:function(){return 0!==this.maxUsers&&this.userList.getItems().length>=this.maxUsers}},{key:"isFirstUser",value:function(e){void 0===e&&(e=this.userID);var t=this.usersList.getItems()[0];return t&&t.userID===e}},{key:"getUser",value:function(e){if(void 0===e&&(e=this.userID),!this.contains(e))return null;var t=this.userID2ItemID[e];return this.userList.getItemFromItemID(t)}},{key:"getUsers",value:function(){return this.userList.getItems()}},{key:"getRootRef",value:function(){return this.database.ref(this.rootPath)}},{key:"getUserRef",value:function(e){if(void 0===e&&(e=this.userID),!this.contains(e))return null;var t=this.userID2ItemID[e];return this.getRootRef().child(t)}},{key:"contains",value:function(e){return void 0===e&&(e=this.userID),this.userID2ItemID.hasOwnProperty(e)}},{key:"startUpdate",value:function(){var e=this.database.ref(this.rootPath);return this.maxUsers>0&&(e=e.limitToFirst(this.maxUsers)),this.userList.startUpdate(e),this}},{key:"stopUpdate",value:function(){return this.userList.stopUpdate(),this}},{key:"userID",get:function(){return this.userInfo.userID},set:function(e){this.userInfo.userID=e}},{key:"userName",get:function(){return this.userInfo.userName},set:function(e){this.userInfo.userName=e}}])&&m(t.prototype,r),i&&m(t,i),e}(),g={join:f,leave:l,changeUserName:v};Object.assign(d.prototype,i.a,g);t.a=d}}).default});