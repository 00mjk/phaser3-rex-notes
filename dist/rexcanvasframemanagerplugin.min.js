!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).rexcanvasframemanagerplugin=t()}(this,function(){"use strict";function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function e(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function u(r){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=o(r);if(i){var n=o(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return s(this,e)}}var h=Phaser.Utils.Objects.IsPlainObject,l=Phaser.Utils.Objects.GetValue,a=function(){function c(e,t,n,r,i,o){if(f(this,c),h(t)){var s=t;t=l(s,"key"),n=l(s,"width"),r=l(s,"height"),i=l(s,"cellWidth"),o=l(s,"cellHeight")}void 0===n&&(n=4096),void 0===r&&(r=4096),void 0===i&&(i=64),void 0===o&&(o=64),this.texture=e.textures.createCanvas(t,n,r),this.canvas=this.texture.getCanvas(),this.cellWidth=i,this.cellHeight=o,this.columnCount=Math.floor(n/i),this.rowCount=Math.floor(r/o),this.freeIndexes=[];for(var u=0,a=this.columnCount*this.rowCount;u<a;u++)this.freeIndexes.push(u);this.frame2Index={}}return e(c,[{key:"isFull",get:function(){return 0===this.freeIndexes.length}},{key:"getFreeFrameIndex",value:function(){return this.freeIndexes.pop()}},{key:"getTopLeftPosition",value:function(e,t){void 0===t&&(t={});var n=e%this.columnCount,r=Math.floor(e/this.rowCount);return t.x=n*this.cellWidth,t.y=r*this.cellHeight,t}},{key:"draw",value:function(e,t,n){var r=this.getFreeFrameIndex();if(void 0===r)return console.warn("Does not have free space."),this;var i=this.getTopLeftPosition(r),o={width:this.cellWidth,height:this.cellHeight},s=this.canvas.getContext("2d");return s.save(),s.translate(i.x,i.y),s.clearRect(0,0,o.width,o.height),n?t.call(n,this.canvas,s,o):t(this.canvas,s,o),s.restore(),this.texture.add(e,0,i.x,i.y,o.width,o.height),this.frame2Index[e]=r,this}},{key:"paste",value:function(e,t){var r=t.canvas;if(!r)return console.warn("Can't get canvas of game object."),this;var i=r.width,o=r.height;return this.draw(e,function(e,t,n){t.drawImage(r,0,0,i,o),n.width=i,n.height=o}),this}},{key:"updateTexture",value:function(){return this.texture.refresh(),this}},{key:"remove",value:function(e){if(!this.frame2Index.hasOwnProperty(e))return this;var t=this.frame2Index[e];return this.freeIndexes.push(t),delete this.frame2Index[e],this.texture.remove(e),this}}]),c}();return function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(n,Phaser.Plugins.BasePlugin);var t=u(n);function n(e){return f(this,n),t.call(this,e)}return e(n,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}},{key:"add",value:function(e,t,n,r,i,o){return new a(e,t,n,r,i,o)}}]),n}()});
