!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).rexquadimageplugin=t()}(this,function(){"use strict";function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function t(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function i(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=o(n);if(i){var r=o(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return l(e)}(this,e)}}var p=function(){function i(e,t,r,n){f(this,i),this.parent=e,this.vertexDataIndex=t,this._x=r,this._y=n}return e(i,[{key:"vertexData",get:function(){return this.parent.vertices[this.vertexDataIndex]}},{key:"localX",get:function(){return this._x},set:function(e){if(this._x!==e){this._x=e;var t=this.parent,r=t.height,n=e/r-t.frame.cutWidth/r/2;this.vertexData.x=n,this.parent.forceUpdate()}}},{key:"localY",get:function(){return this._y},set:function(e){if(this._y!==e){this._y=e;var t=this.parent,r=t.height,n=e/r-t.frame.cutHeight/r/2,i=t.frame.source.isRenderTexture;this.vertexData.y=i?n:-n,this.parent.forceUpdate()}}},{key:"x",get:function(){var e=this.parent;return(this.localX-e.width/2)*e.scaleX+e.x},set:function(e){var t=this.parent;this.localX=(e-t.x)/t.scaleX+t.width/2}},{key:"y",get:function(){var e=this.parent;return(this.localY-e.height/2)*e.scaleY+e.y},set:function(e){var t=this.parent;this.localY=(e-t.y)/t.scaleY+t.height/2}}]),i}(),s=Phaser.GameObjects.Mesh,S=Phaser.Geom.Mesh.Vertex,C=Phaser.Geom.Mesh.Face,y=Phaser.Utils.Objects.IsPlainObject,v=Phaser.Utils.Objects.GetValue,a=Phaser.Math.DegToRad,d=1+1/Math.sin(a(45)),c=function(){t(h,s);var c=i(h);function h(e,t,r,n,i,o){var s;f(this,h),y(t)&&(t=v(o=t,"x",0),r=v(o,"y",0),n=v(o,"key",null),i=v(o,"frame",null)),(s=c.call(this,e,t,r,n,i)).type="rexQuadImage",s.setSizeToFrame(),s.resetPerspective(),s.panZ(d),s.hideCCW=v(o,"hideCCW",!0),s.resetVerts();var a=s.width,u=s.height;return s.topLeft=new p(l(s),0,0,0),s.topRight=new p(l(s),1,a,0),s.bottomLeft=new p(l(s),2,0,u),s.bottomRight=new p(l(s),3,a,u),s}return e(h,[{key:"resetPerspective",value:function(){return this.setPerspective(this.width,this.height,45),this}},{key:"resetVerts",value:function(){var e,t;this.clear(),this.dirtyCache[9]=-1;for(var r=this.height,n=this.width,i=[[0,0],[n,0],[0,r],[n,r]],o=[0,2,1,2,3,1],s=this.width,a=this.height,u=this.frame.cutWidth/a/2,c=this.frame.cutHeight/a/2,h=this.frame.source.isRenderTexture,f=this.frame.u0,l=this.frame.u1,p=h?this.frame.v1:this.frame.v0,y=l-f,v=(h?this.frame.v0:this.frame.v1)-p,d=0,m=i.length;d<m;d++){var g=i[d],b=g[0],x=g[1],w=b/a-u,P=x/a-c,j=f+b/s*y,O=p+x/a*v;i[d]=new S(w,-P,0,j,O)}var _=[];for(d=0,m=o.length;d<m;d+=3){var k=i[o[d+0]],R=i[o[d+1]],T=i[o[d+2]],G=new C(k,R,T);_.push(G)}return(e=this.vertices).push.apply(e,i),(t=this.faces).push.apply(t,_),this}},{key:"syncSize",value:function(){return this.setSizeToFrame(),this.resetPerspective(),this.resetVerts(),this}},{key:"forceUpdate",value:function(){return this.dirtyCache[10]=1,this}}]),h}();function h(e,t,r,n,i){var o=new c(this.scene,e,t,r,n,i);return this.scene.add.existing(o),o}var m=Phaser.Utils.Objects.GetAdvancedValue,g=Phaser.GameObjects.BuildGameObject;function b(e,t){void 0===e&&(e={}),void 0!==t&&(e.add=t);var r=m(e,"key",null),n=m(e,"frame",null),i=new c(this.scene,0,0,r,n,e);return g(this.scene,i,e),i}function x(e){return null==e||""===e||0===e.length}var w=function(){t(n,Phaser.Plugins.BasePlugin);var r=i(n);function n(e){var t;return f(this,n),t=r.call(this,e),e.registerGameObject("rexQuadImage",h,b),t}return e(n,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}}]),n}();return function(e,t,r){if("object"===u(e)){if(x(t)){if(null==r)return;"object"===u(r)&&(e=r)}else{"string"==typeof t&&(t=t.split("."));var n=t.pop();(function(e,t,r){var n=e;if(!x(t)){var i;"string"==typeof t&&(t=t.split("."));for(var o=0,s=t.length;o<s;o++){var a;if(null==n[i=t[o]]||"object"!==u(n[i]))a=o!==s-1||void 0===r?{}:r,n[i]=a;n=n[i]}}return n})(e,t)[n]=r}}}(window,"RexPlugins.GameObjects.QuadImage",c),w});
