!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexquadimageplugin=e()}(this,function(){"use strict";function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function t(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function r(t,e){return(r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function i(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=o(n);if(i){var r=o(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return c(t)}(this,t)}}function s(t,e,r){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=o(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(r):i.value}})(t,e,r||t)}function u(t,e,r){var n=t.width/2,i=t.height/2;return f.x=e-n,f.y=r-i,h(f,n,i,t.rotation),f.x*=t.scaleX,f.y*=t.scaleY,f.x+=t.x,f.y+=t.y,f}var h=Phaser.Math.RotateAround,f={x:0,y:0},y=function(){function r(t,e){l(this,r),this.parent=t,this.vertex=e,this._localX=void 0,this._localY=void 0}return t(r,[{key:"destroy",value:function(){this.parent=void 0,this.vertex=void 0}},{key:"updateVertexPosition",value:function(t,e){var r=this.parent,n=r.height,i=t/n-r.frame.cutWidth/n/2,o=e/n-r.frame.cutHeight/n/2,s=this.vertex;return s.x=i,s.y=-o,r.forceUpdate(),this}},{key:"localX",get:function(){return this._localX},set:function(t){this.setLocalXY(t,this._localY)}},{key:"localY",get:function(){return this._localY},set:function(t){this.setLocalXY(this._localX,t)}},{key:"setLocalXY",value:function(t,e,r){return this._localX===t&&this._localY===e||(this._localX=t,this._localY=e,r||this.updateVertexPosition(t,e)),this}},{key:"setWorldXY",value:function(t,e){if(this._worldX===t&&this._worldY===e)return this;var r,n,i,o,s,u=(r=this.parent,n=t,i=e,o=r.width/2,s=r.height/2,f.x=n-r.x,f.y=i-r.y,f.x/=r.scaleX,f.y/=r.scaleY,h(f,o,s,-r.rotation),f.x+=o,f.y+=s,f);return this.setLocalXY(u.x,u.y),this}},{key:"setPosition",value:function(t,e){return this.setWorldXY(t,e),this}},{key:"getWorldXY",value:function(){return u(this.parent,this._localX,this._localY)}},{key:"x",get:function(){return u(this.parent,this._localX,this._localY).x},set:function(t){this.setWorldXY(t,this.y)}},{key:"y",get:function(){return u(this.parent,this._localX,this._localY).y},set:function(t){this.setWorldXY(this.x,t)}}]),r}(),d=Phaser.Geom.Mesh.Vertex,p=Phaser.Geom.Mesh.Face,v=[0,2,3,0,3,1],b=[0,3,4,0,4,1,1,4,2,4,5,2,3,6,4,6,7,4,4,7,8,4,8,5],g=Phaser.GameObjects.Mesh,m=Phaser.Utils.Objects.IsPlainObject,P=Phaser.Utils.Objects.GetValue,x=Phaser.Math.DegToRad,O=1+1/Math.sin(x(45)),w=function(){e(a,g);var u=i(a);function a(t,e,r,n,i,o){var s;return l(this,a),m(e)&&(e=P(o=e,"x",0),r=P(o,"y",0),n=P(o,"key",null),i=P(o,"frame",null)),(s=u.call(this,t,e,r,n,i)).type="rexQuadImage",s.isNinePointMode=P(o,"ninePointMode",!1),s.controlPoints=[],function(t){for(var e=t.isNinePointMode,r=e?9:4,n=t.vertices,i=t.faces,o=t.controlPoints,s=0;s<r;s++){var u=new d;n.push(u),o.push(new y(t,u))}for(var a=e?b:v,c=(s=0,a.length);s<c;s+=3){var l=n[a[s+0]],h=n[a[s+1]],f=n[a[s+2]];i.push(new p(l,h,f))}e?(t.topLeft=o[0],t.topCenter=o[1],t.topRight=o[2],t.centerLeft=o[3],t.center=o[4],t.centerRight=o[5],t.bottomLeft=o[6],t.bottomCenter=o[7],t.bottomRight=o[8]):(t.topLeft=o[0],t.topRight=o[1],t.bottomLeft=o[2],t.bottomRight=o[3])}(c(s)),s.setSizeToFrame(),s.resetPerspective(),s.panZ(O),s.hideCCW=P(o,"hideCCW",!0),s.resetVerts(),s}return t(a,[{key:"preDestroy",value:function(){for(var t=0,e=this.controlPoints.length;t<e;t++)this.controlPoints[t].destroy();this.controlPoints=void 0,s(o(a.prototype),"preDestroy",this).call(this)}},{key:"resetPerspective",value:function(){return this.setPerspective(this.width,this.height,45),this}},{key:"resetVerts",value:function(){this.dirtyCache[9]=-1;for(var t=function(t){var e,r=t.height,n=t.width;if(t.isNinePointMode){var i=(0+n)/2,o=(0+r)/2;e=[0,0,i,0,n,0,0,o,i,o,n,o,0,r,i,r,n,r]}else e=[0,0,n,0,0,r,n,r];return e}(this),e=this.width,r=this.height,n=this.frame.cutWidth/r/2,i=this.frame.cutHeight/r/2,o=this.frame.source.isRenderTexture,s=this.frame.u0,u=this.frame.u1,a=o?this.frame.v1:this.frame.v0,c=u-s,l=(o?this.frame.v0:this.frame.v1)-a,h=this.controlPoints,f=0,y=t.length;f<y;f+=2){var d=t[f+0],p=t[f+1],v=f/2,b=d/r-n,g=p/r-i,m=s+d/e*c,P=a+p/r*l;this.vertices[v].set(b,-g,0).setUVs(m,P),h[v].setLocalXY(d,p,!0)}return this}},{key:"syncSize",value:function(){return this.setSizeToFrame(),this.resetPerspective(),this.resetVerts(),this}},{key:"forceUpdate",value:function(){return this.dirtyCache[10]=1,this}}]),a}();function j(t,e,r,n,i){var o=new w(this.scene,t,e,r,n,i);return this.scene.add.existing(o),o}var _=Phaser.Utils.Objects.GetAdvancedValue,R=Phaser.GameObjects.BuildGameObject;function X(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var r=_(t,"key",null),n=_(t,"frame",null),i=new w(this.scene,0,0,r,n,t);return R(this.scene,i,t),i}var Y=Phaser.GameObjects.RenderTexture,k=Phaser.Utils.Objects.IsPlainObject,G=Phaser.Utils.Objects.GetValue,T=function(){e(c,w);var a=i(c);function c(t,e,r,n,i,o){var s;l(this,c),k(e)&&(e=G(o=e,"x",0),r=G(o,"y",0),n=G(o,"width",32),i=G(o,"height",32));var u=new Y(t,e,r,n,i).setOrigin(.5);return(s=a.call(this,t,e,r,u.texture.key,null,o)).type="rexQuadRenderTexture",s.rt=u,s}return t(c,[{key:"destroy",value:function(t){s(o(c.prototype),"destroy",this).call(this,t),this.rt.destroy(),this.rt=null}}]),c}();function V(t,e,r,n,i){var o=new T(this.scene,t,e,r,n,i);return this.scene.add.existing(o),o}var L=Phaser.Utils.Objects.GetAdvancedValue,M=Phaser.GameObjects.BuildGameObject;function C(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var r=L(t,"x",0),n=L(t,"y",0),i=L(t,"width",32),o=L(t,"height",32),s=new T(this.scene,r,n,i,o,t);return M(this.scene,s,t),s}function S(t){return null==t||""===t||0===t.length}function U(t,e,r){if("object"===a(t)){if(S(e)){if(null==r)return;"object"===a(r)&&(t=r)}else{"string"==typeof e&&(e=e.split("."));var n=e.pop();(function(t,e,r){var n=t;if(!S(e)){var i;"string"==typeof e&&(e=e.split("."));for(var o=0,s=e.length;o<s;o++){var u;if(null==n[i=e[o]]||"object"!==a(n[i]))u=o!==s-1||void 0===r?{}:r,n[i]=u;n=n[i]}}return n})(t,e)[n]=r}return t}}var W=function(){e(n,Phaser.Plugins.BasePlugin);var r=i(n);function n(t){var e;return l(this,n),e=r.call(this,t),t.registerGameObject("rexQuadImage",j,X),t.registerGameObject("rexQuadRenderTexture",V,C),e}return t(n,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}}]),n}();return U(window,"RexPlugins.GameObjects.QuadImage",w),U(window,"RexPlugins.GameObjects.QuadRenderTexture",T),W});
