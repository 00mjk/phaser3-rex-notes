!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexquadimageplugin=e()}(this,function(){"use strict";function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function t(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function r(t,e){return(r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function i(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=o(n);if(i){var r=o(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return c(t)}(this,t)}}function s(t,e,r){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=o(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(r):i.value}})(t,e,r||t)}function a(t,e,r){var n=t.width/2,i=t.height/2;return f.x=e-n,f.y=r-i,l(f,n,i,t.rotation),f.x*=t.scaleX,f.y*=t.scaleY,f.x+=t.x,f.y+=t.y,f}var l=Phaser.Math.RotateAround,f={x:0,y:0},y=function(){function r(t,e){h(this,r),this.parent=t,this.vertexData=e,this._localX=void 0,this._localY=void 0,t.on("destroy",this.destroy,this)}return t(r,[{key:"destroy",value:function(){this.parent=void 0,this.vertexData=void 0}},{key:"updateVertexPosition",value:function(t,e){var r=this.parent,n=r.height,i=t/n-r.frame.cutWidth/n/2,o=e/n-r.frame.cutHeight/n/2,s=this.vertexData;return s.x=i,s.y=-o,r.forceUpdate(),this}},{key:"localX",get:function(){return this._localX},set:function(t){this.setLocalXY(t,this._localY)}},{key:"localY",get:function(){return this._localY},set:function(t){this.setLocalXY(this._localX,t)}},{key:"setLocalXY",value:function(t,e,r){return this._localX===t&&this._localY===e||(this._localX=t,this._localY=e,r||this.updateVertexPosition(t,e)),this}},{key:"setWorldXY",value:function(t,e){if(this._worldX===t&&this._worldY===e)return this;var r,n,i,o,s,a=(r=this.parent,n=t,i=e,o=r.width/2,s=r.height/2,f.x=n-r.x,f.y=i-r.y,f.x/=r.scaleX,f.y/=r.scaleY,l(f,o,s,-r.rotation),f.x+=o,f.y+=s,f);return this.setLocalXY(a.x,a.y),this}},{key:"setPosition",value:function(t,e){return this.setWorldXY(t,e),this}},{key:"getWorldXY",value:function(){return a(this.parent,this._localX,this._localY)}},{key:"x",get:function(){return a(this.parent,this._localX,this._localY).x},set:function(t){this.setWorldXY(t,this.y)}},{key:"y",get:function(){return a(this.parent,this._localX,this._localY).y},set:function(t){this.setWorldXY(this.x,t)}}]),r}(),d=Phaser.Geom.Mesh.Vertex,v=Phaser.Geom.Mesh.Face,p=[0,2,1,2,3,1],b=Phaser.GameObjects.Mesh,g=Phaser.Utils.Objects.IsPlainObject,m=Phaser.Utils.Objects.GetValue,x=Phaser.Math.DegToRad,P=1+1/Math.sin(x(45)),w=function(){e(u,b);var a=i(u);function u(t,e,r,n,i,o){var s;return h(this,u),g(e)&&(e=m(o=e,"x",0),r=m(o,"y",0),n=m(o,"key",null),i=m(o,"frame",null)),(s=a.call(this,t,e,r,n,i)).type="rexQuadImage",function(t){t.controlPoints=[];for(var e=t.vertices,r=t.faces,n=t.controlPoints,i=0;i<4;i++){var o=new d;e.push(o),n.push(new y(t,o))}i=0;for(var s=p.length;i<s;i+=3){var a=e[p[i+0]],u=e[p[i+1]],c=e[p[i+2]];r.push(new v(a,u,c))}t.topLeft=n[0],t.topRight=n[1],t.bottomLeft=n[2],t.bottomRight=n[3]}(c(s)),s.setSizeToFrame(),s.resetPerspective(),s.panZ(P),s.hideCCW=m(o,"hideCCW",!0),s.resetVerts(),s}return t(u,[{key:"resetPerspective",value:function(){return this.setPerspective(this.width,this.height,45),this}},{key:"resetVerts",value:function(){this.dirtyCache[9]=-1;for(var t=this.height,e=this.width,r=[[0,0],[e,0],[0,t],[e,t]],n=this.width,i=this.height,o=this.frame.cutWidth/i/2,s=this.frame.cutHeight/i/2,a=this.frame.source.isRenderTexture,u=this.frame.u0,c=this.frame.u1,h=a?this.frame.v1:this.frame.v0,l=c-u,f=(a?this.frame.v0:this.frame.v1)-h,y=0,d=r.length;y<d;y++){var v=r[y],p=v[0],b=v[1],g=p/i-o,m=b/i-s,x=u+p/n*l,P=h+b/i*f;this.vertices[y].set(g,-m,0).setUVs(x,P)}return this.reesetControlPoints(),this}},{key:"syncSize",value:function(){return this.setSizeToFrame(),this.resetPerspective(),this.resetVerts(),this}},{key:"reesetControlPoints",value:function(){var t=this.height,e=this.width;return this.topLeft.setLocalXY(0,0,!0),this.topRight.setLocalXY(e,0,!0),this.bottomLeft.setLocalXY(0,t,!0),this.bottomRight.setLocalXY(e,t,!0),this}},{key:"forceUpdate",value:function(){return this.dirtyCache[10]=1,this}}]),u}();function O(t,e,r,n,i){var o=new w(this.scene,t,e,r,n,i);return this.scene.add.existing(o),o}var j=Phaser.Utils.Objects.GetAdvancedValue,_=Phaser.GameObjects.BuildGameObject;function X(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var r=j(t,"key",null),n=j(t,"frame",null),i=new w(this.scene,0,0,r,n,t);return _(this.scene,i,t),i}var Y=Phaser.GameObjects.RenderTexture,R=Phaser.Utils.Objects.IsPlainObject,k=Phaser.Utils.Objects.GetValue,G=function(){e(c,w);var u=i(c);function c(t,e,r,n,i,o){var s;h(this,c),R(e)&&(e=k(o=e,"x",0),r=k(o,"y",0),n=k(o,"width",32),i=k(o,"height",32));var a=new Y(t,e,r,n,i).setOrigin(.5);return(s=u.call(this,t,e,r,a.texture.key,null,o)).type="rexQuadRenderTexture",s.rt=a,s}return t(c,[{key:"destroy",value:function(t){s(o(c.prototype),"destroy",this).call(this,t),this.rt.destroy(),this.rt=null}}]),c}();function T(t,e,r,n,i){var o=new G(this.scene,t,e,r,n,i);return this.scene.add.existing(o),o}var L=Phaser.Utils.Objects.GetAdvancedValue,V=Phaser.GameObjects.BuildGameObject;function C(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var r=L(t,"x",0),n=L(t,"y",0),i=L(t,"width",32),o=L(t,"height",32),s=new G(this.scene,r,n,i,o,t);return V(this.scene,s,t),s}function S(t){return null==t||""===t||0===t.length}function U(t,e,r){if("object"===u(t)){if(S(e)){if(null==r)return;"object"===u(r)&&(t=r)}else{"string"==typeof e&&(e=e.split("."));var n=e.pop();(function(t,e,r){var n=t;if(!S(e)){var i;"string"==typeof e&&(e=e.split("."));for(var o=0,s=e.length;o<s;o++){var a;if(null==n[i=e[o]]||"object"!==u(n[i]))a=o!==s-1||void 0===r?{}:r,n[i]=a;n=n[i]}}return n})(t,e)[n]=r}return t}}var W=function(){e(n,Phaser.Plugins.BasePlugin);var r=i(n);function n(t){var e;return h(this,n),e=r.call(this,t),t.registerGameObject("rexQuadImage",O,X),t.registerGameObject("rexQuadRenderTexture",T,C),e}return t(n,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}}]),n}();return U(window,"RexPlugins.GameObjects.QuadImage",w),U(window,"RexPlugins.GameObjects.QuadRenderTexture",G),W});
