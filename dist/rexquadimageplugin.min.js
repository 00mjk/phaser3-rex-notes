!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexquadimageplugin=e()}(this,function(){"use strict";function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function t(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function r(t,e){return(r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function i(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=o(n);if(i){var r=o(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return f(t)}(this,t)}}function s(t,e,r){var n=t.width/2,i=t.height/2;return h.x=e-n,h.y=r-i,c(h,n,i,t.rotation),h.x*=t.scaleX,h.y*=t.scaleY,h.x+=t.x,h.y+=t.y,h}var c=Phaser.Math.RotateAround,h={x:0,y:0},y=function(){function i(t,e,r,n){l(this,i),this.parent=t,this.vertexDataIndex=e,this._localX=r,this._localY=n}return t(i,[{key:"updateVertexPosition",value:function(t,e){var r=this.parent,n=r.height,i=t/n-r.frame.cutWidth/n/2,o=e/n-r.frame.cutHeight/n/2,s=r.frame.source.isRenderTexture,a=r.vertices[this.vertexDataIndex];return a.x=i,a.y=s?o:-o,r.forceUpdate(),this}},{key:"localX",get:function(){return this._localX},set:function(t){this.setLocalXY(t,this._localY)}},{key:"localY",get:function(){return this._localY},set:function(t){this.setLocalXY(this._localX,t)}},{key:"setLocalXY",value:function(t,e){return this._localX===t&&this._localY===e||(this._localX=t,this._localY=e,this.updateVertexPosition(t,e)),this}},{key:"setWorldXY",value:function(t,e){if(this._worldX===t&&this._worldY===e)return this;var r,n,i,o,s,a=(r=this.parent,n=t,i=e,o=r.width/2,s=r.height/2,h.x=n-r.x,h.y=i-r.y,h.x/=r.scaleX,h.y/=r.scaleY,c(h,o,s,-r.rotation),h.x+=o,h.y+=s,h);return this.setLocalXY(a.x,a.y),this}},{key:"setPosition",value:function(t,e){return this.setWorldXY(t,e),this}},{key:"getWorldXY",value:function(){return s(this.parent,this._localX,this._localY)}},{key:"x",get:function(){return s(this.parent,this._localX,this._localY).x},set:function(t){this.setWorldXY(t,this.y)}},{key:"y",get:function(){return s(this.parent,this._localX,this._localY).y},set:function(t){this.setWorldXY(this.x,t)}}]),i}(),a=Phaser.GameObjects.Mesh,T=Phaser.Geom.Mesh.Vertex,G=Phaser.Geom.Mesh.Face,p=Phaser.Utils.Objects.IsPlainObject,d=Phaser.Utils.Objects.GetValue,v=Phaser.Math.DegToRad,m=1+1/Math.sin(v(45)),b=function(){e(h,a);var c=i(h);function h(t,e,r,n,i,o){var s;l(this,h),p(e)&&(e=d(o=e,"x",0),r=d(o,"y",0),n=d(o,"key",null),i=d(o,"frame",null)),(s=c.call(this,t,e,r,n,i)).type="rexQuadImage",s.setSizeToFrame(),s.resetPerspective(),s.panZ(m),s.hideCCW=d(o,"hideCCW",!0),s.resetVerts();var a=s.width,u=s.height;return s.topLeft=new y(f(s),0,0,0),s.topRight=new y(f(s),1,a,0),s.bottomLeft=new y(f(s),2,0,u),s.bottomRight=new y(f(s),3,a,u),s}return t(h,[{key:"resetPerspective",value:function(){return this.setPerspective(this.width,this.height,45),this}},{key:"resetVerts",value:function(){var t,e;this.clear(),this.dirtyCache[9]=-1;for(var r=this.height,n=this.width,i=[[0,0],[n,0],[0,r],[n,r]],o=[0,2,1,2,3,1],s=this.width,a=this.height,u=this.frame.cutWidth/a/2,c=this.frame.cutHeight/a/2,h=this.frame.source.isRenderTexture,l=this.frame.u0,f=this.frame.u1,y=h?this.frame.v1:this.frame.v0,p=f-l,d=(h?this.frame.v0:this.frame.v1)-y,v=0,m=i.length;v<m;v++){var b=i[v],g=b[0],x=b[1],w=g/a-u,P=x/a-c,_=l+g/s*p,j=y+x/a*d;i[v]=new T(w,-P,0,_,j)}var X=[];for(v=0,m=o.length;v<m;v+=3){var Y=i[o[v+0]],O=i[o[v+1]],k=i[o[v+2]],R=new G(Y,O,k);X.push(R)}return(t=this.vertices).push.apply(t,i),(e=this.faces).push.apply(e,X),this}},{key:"syncSize",value:function(){return this.setSizeToFrame(),this.resetPerspective(),this.resetVerts(),this}},{key:"forceUpdate",value:function(){return this.dirtyCache[10]=1,this}}]),h}();function g(t,e,r,n,i){var o=new b(this.scene,t,e,r,n,i);return this.scene.add.existing(o),o}var x=Phaser.Utils.Objects.GetAdvancedValue,w=Phaser.GameObjects.BuildGameObject;function P(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var r=x(t,"key",null),n=x(t,"frame",null),i=new b(this.scene,0,0,r,n,t);return w(this.scene,i,t),i}function _(t){return null==t||""===t||0===t.length}var j=function(){e(n,Phaser.Plugins.BasePlugin);var r=i(n);function n(t){var e;return l(this,n),e=r.call(this,t),t.registerGameObject("rexQuadImage",g,P),e}return t(n,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}}]),n}();return function(t,e,r){if("object"===u(t)){if(_(e)){if(null==r)return;"object"===u(r)&&(t=r)}else{"string"==typeof e&&(e=e.split("."));var n=e.pop();(function(t,e,r){var n=t;if(!_(e)){var i;"string"==typeof e&&(e=e.split("."));for(var o=0,s=e.length;o<s;o++){var a;if(null==n[i=e[o]]||"object"!==u(n[i]))a=o!==s-1||void 0===r?{}:r,n[i]=a;n=n[i]}}return n})(t,e)[n]=r}}}(window,"RexPlugins.GameObjects.QuadImage",b),j});
