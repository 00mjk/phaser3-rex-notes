!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexquadimageplugin=e()}(void 0,function(){function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&i(t,e)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function l(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=s(n);if(r){var i=s(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}(this,t)}}function f(){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=s(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(arguments.length<3?t:i):r.value}}).apply(this,arguments)}function t(t,e,i){var n=t.width/2,r=t.height/2;return y.x=e-n,y.y=i-r,d(y,0,0,t.rotation),y.x*=t.scaleX,y.y*=t.scaleY,y.x+=t.x,y.y+=t.y,y}var d=Phaser.Math.RotateAround,y={x:0,y:0},v=function(){function i(t,e){c(this,i),this.parent=t,this.vertex=e,this._localX=void 0,this._localY=void 0}return r(i,[{key:"destroy",value:function(){this.parent=void 0,this.vertex=void 0}},{key:"updateVertexPosition",value:function(t,e){var i=this.parent,n=i.height,r=t/n-i.frame.cutWidth/n/2,o=e/n-i.frame.cutHeight/n/2,s=this.vertex;return s.x=r,s.y=-o,i.forceUpdate(),this}},{key:"localX",get:function(){return this._localX},set:function(t){this.setLocalXY(t,this._localY)}},{key:"localY",get:function(){return this._localY},set:function(t){this.setLocalXY(this._localX,t)}},{key:"localXOrigin",get:function(){return this._localXOrigin}},{key:"localYOrigin",get:function(){return this._localYOrigin}},{key:"resetLocalXY",value:function(t,e){return this._localXOrigin=t,this._localYOrigin=e,this._localX=t,this._localY=e,this}},{key:"setLocalXY",value:function(t,e,i){return this._localX===t&&this._localY===e||(this._localX=t,this._localY=e,i||this.updateVertexPosition(t,e)),this}},{key:"setWorldXY",value:function(t,e){if(this._worldX===t&&this._worldY===e)return this;var i,n,r,o,s,a=(i=this.parent,n=t,r=e,o=i.width/2,s=i.height/2,y.x=n-i.x,y.y=r-i.y,y.x/=i.scaleX,y.y/=i.scaleY,d(y,0,0,-i.rotation),y.x+=o,y.y+=s,y);return this.setLocalXY(a.x,a.y),this}},{key:"setPosition",value:function(t,e){return this.setWorldXY(t,e),this}},{key:"getWorldXY",value:function(){return t(this.parent,this._localX,this._localY)}},{key:"x",get:function(){return t(this.parent,this._localX,this._localY).x},set:function(t){this.setWorldXY(t,this.y)}},{key:"y",get:function(){return t(this.parent,this._localX,this._localY).y},set:function(t){this.setWorldXY(this.x,t)}}]),i}(),g=Phaser.Geom.Mesh.Vertex,p=Phaser.Geom.Mesh.Face,w=[0,2,3,0,3,1],x=[0,3,4,0,4,1,1,4,2,4,5,2,3,6,4,6,7,4,4,7,8,4,8,5],e=Phaser.GameObjects.Mesh,b=Phaser.Utils.Objects.IsPlainObject,m=Phaser.Utils.Objects.GetValue,k=function(){o(u,e);var a=l(u);function u(t,e,i,n,r,o){var s;return c(this,u),b(e)&&(e=m(o=e,"x",0),i=m(o,"y",0),n=m(o,"key",null),r=m(o,"frame",null)),(s=a.call(this,t,e,i,n,r)).type="rexQuadImage",s.isNinePointMode=m(o,"ninePointMode",!1),s.controlPoints=[],function(t){for(var e=t.isNinePointMode,i=e?9:4,n=t.vertices,r=t.faces,o=t.controlPoints,s=0;s<i;s++){var a=new g;n.push(a),o.push(new v(t,a))}for(var u=e?x:w,h=(s=0,u.length);s<h;s+=3){var c=n[u[s+0]],l=n[u[s+1]],f=n[u[s+2]];r.push(new p(c,l,f))}e?(t.topLeft=o[0],t.topCenter=o[1],t.topRight=o[2],t.centerLeft=o[3],t.center=o[4],t.centerRight=o[5],t.bottomLeft=o[6],t.bottomCenter=o[7],t.bottomRight=o[8]):(t.topLeft=o[0],t.topRight=o[1],t.bottomLeft=o[2],t.bottomRight=o[3])}(h(s)),s.hideCCW=!1,s.syncSize(),s}return r(u,[{key:"preDestroy",value:function(){for(var t=0,e=this.controlPoints.length;t<e;t++)this.controlPoints[t].destroy();this.controlPoints=void 0,f(s(u.prototype),"preDestroy",this).call(this)}},{key:"resetVerts",value:function(){this.dirtyCache[9]=-1;for(var t=function(t){var e,i=t.height,n=t.width;if(t.isNinePointMode){var r=(0+n)/2,o=(0+i)/2;e=[0,0,r,0,n,0,0,o,r,o,n,o,0,i,r,i,n,i]}else e=[0,0,n,0,0,i,n,i];return e}(this),e=this.width,i=this.height,n=this.frame.cutWidth/i/2,r=this.frame.cutHeight/i/2,o=this.frame.source.isRenderTexture,s=this.frame.u0,a=this.frame.u1,u=o?this.frame.v1:this.frame.v0,h=a-s,c=(o?this.frame.v0:this.frame.v1)-u,l=this.controlPoints,f=0,d=t.length;f<d;f+=2){var y=t[f+0],v=t[f+1],g=f/2,p=y/i-n,w=v/i-r,x=s+y/e*h,b=u+v/i*c;this.vertices[g].set(p,-w,0).setUVs(x,b),l[g].resetLocalXY(y,v)}return this}},{key:"syncSize",value:function(){return this.setSizeToFrame(),this.setOrtho(this.width/this.height,1),this.resetVerts(),this}},{key:"forceUpdate",value:function(){return this.dirtyCache[10]=1,this}},{key:"tint",get:function(){return 0===this.vertices.length?16777215:this.vertices[0].color},set:function(t){for(var e=this.vertices,i=0,n=e.length;i<n;i++)e[i].color=t}},{key:"setTint",value:function(t){return this.tint=t,this}}]),u}();function a(t,e,i,n,r){var o=new k(this.scene,t,e,i,n,r);return this.scene.add.existing(o),o}var P=Phaser.Utils.Objects.GetAdvancedValue,O=Phaser.GameObjects.BuildGameObject;function j(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var i=P(t,"key",null),n=P(t,"frame",null),r=new k(this.scene,0,0,i,n,t);return O(this.scene,r,t),r}function X(t){return void 0!==t.displayWidth?t.displayWidth:t.width}function Y(t){return void 0!==t.displayHeight?t.displayHeight:t.height}function _(t,e){if(void 0===e?e=new T:!0===e&&(void 0===C&&(C=new T),e=C),t.getBounds)return t.getBounds(e);var i,n,r,o,s,a,u,h;if(t.parentContainer){var c=t.parentContainer.getBoundsTransformMatrix();B(t,e),c.transformPoint(e.x,e.y,e),i=e.x,n=e.y,U(t,e),c.transformPoint(e.x,e.y,e),r=e.x,o=e.y,L(t,e),c.transformPoint(e.x,e.y,e),s=e.x,a=e.y,D(t,e),c.transformPoint(e.x,e.y,e),u=e.x,h=e.y}else B(t,e),i=e.x,n=e.y,U(t,e),r=e.x,o=e.y,L(t,e),s=e.x,a=e.y,D(t,e),u=e.x,h=e.y;return e.x=Math.min(i,r,s,u),e.y=Math.min(n,o,a,h),e.width=Math.max(i,r,s,u)-e.x,e.height=Math.max(n,o,a,h)-e.y,e}function R(t,e){var i=Array.isArray(t);if(void 0===e?e=i?[]:{}:function(t){if("object"!==u(t)||null===t)return;if(Array.isArray(t))t.length=0;else for(var e in t)delete t[e]}(e),i){e.length=t.length;for(var n=0,r=t.length;n<r;n++)e[n]=t[n]}else for(var o in t)e[o]=t[o];return e}function G(t){var e=t.gameObjects,i=t.renderTexture;if(0===e.length)return i&&i.setSize(1,1).clear(),i;var n,r,o=Q(t,"x",void 0),s=Q(t,"y",void 0),a=Q(t,"width",void 0),u=Q(t,"height",void 0),h=Q(t,"originX",0),c=Q(t,"originY",0);if(void 0===a||void 0===u||void 0===o||void 0===s){var l=function(t,e){var i;void 0===e?e=new W:!0===e&&(void 0===S&&(S=new W),e=S);for(var n=!0,r=0,o=t.length;r<o;r++)if((i=t[r]).getBounds){var s=_(i,!0);n?(e.setTo(s.x,s.y,s.width,s.height),n=!1):z(s,e,e)}return e}(e,!0);c=h=void 0!==o&&void 0!==s?(a=2*Math.max(o-l.left,l.right-o),u=2*Math.max(s-l.top,l.bottom-s),.5):(o=l.x,s=l.y,a=l.width,u=l.height,0),n=l.x,r=l.y}else n=o+(0-h)*a,r=s+(0-c)*u;return i?(i.setPosition(o,s),i.width===a&&i.height===u||i.setSize(a,u)):i=e[0].scene.add.renderTexture(o,s,a,u),i.setOrigin(h,c),i.camera.setScroll(n,r),e=function(t,e){if(0===t.length)return t;void 0===e&&(e=!1);var i=t[0].scene.sys.displayList;return i.depthSort(),e?t.sort(function(t,e){return i.getIndex(e)-i.getIndex(t)}):t.sort(function(t,e){return i.getIndex(t)-i.getIndex(e)}),t}(R(e)),i.draw(e),i}var S,T=Phaser.Geom.Rectangle,V=Phaser.Math.Vector2,M=Phaser.Math.RotateAround,C=void 0,B=function(t,e,i){return void 0===e?e=new V:!0===e&&(void 0===I&&(I=new V),e=I),t.getTopLeft?t.getTopLeft(e):(e.x=t.x-X(t)*t.originX,e.y=t.y-Y(t)*t.originY,A(t,e,i))},U=function(t,e,i){return void 0===e?e=new V:!0===e&&(void 0===I&&(I=new V),e=I),t.getTopRight?t.getTopRight(e):(e.x=t.x-X(t)*t.originX+X(t),e.y=t.y-Y(t)*t.originY,A(t,e,i))},L=function(t,e,i){return void 0===e?e=new V:!0===e&&(void 0===I&&(I=new V),e=I),t.getBottomLeft?t.getBottomLeft(e):(e.x=t.x-X(t)*t.originX,e.y=t.y-Y(t)*t.originY+Y(t),A(t,e,i))},D=function(t,e,i){return void 0===e?e=new V:!0===e&&(void 0===I&&(I=new V),e=I),t.getBottomRight?t.getBottomRight(e):(e.x=t.x-X(t)*t.originX+X(t),e.y=t.y-Y(t)*t.originY+Y(t),A(t,e,i))},I=void 0,A=function(t,e,i){void 0===i&&(i=!1),0!==t.rotation&&M(e,t.x,t.y,t.rotation),i&&t.parentContainer&&t.parentContainer.getBoundsTransformMatrix().transformPoint(e.x,e.y,e);return e},W=Phaser.Geom.Rectangle,z=Phaser.Geom.Rectangle.Union,Q=Phaser.Utils.Objects.GetValue,H=Phaser.GameObjects.RenderTexture,E=Phaser.Utils.Objects.IsPlainObject,N=Phaser.Utils.Objects.GetValue,F=function(){o(h,k);var u=l(h);function h(t,e,i,n,r,o){var s;c(this,h),E(e)&&(e=N(o=e,"x",0),i=N(o,"y",0),n=N(o,"width",32),r=N(o,"height",32));var a=new H(t,e,i,n,r).setOrigin(.5);return(s=u.call(this,t,e,i,a.texture.key,null,o)).type="rexQuadRenderTexture",s.rt=a,s}return r(h,[{key:"destroy",value:function(t){f(s(h.prototype),"destroy",this).call(this,t),this.rt.destroy(),this.rt=null}},{key:"snapshot",value:function(t){var e=this.rt.x,i=this.rt.y;return G({gameObjects:t,renderTexture:this.rt}),this.rt.setPosition(e,i),this.syncSize(),this}}]),h}();function q(t,e,i,n,r){var o=new F(this.scene,t,e,i,n,r);return this.scene.add.existing(o),o}var J=Phaser.Utils.Objects.GetAdvancedValue,K=Phaser.GameObjects.BuildGameObject;function Z(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var i=J(t,"x",0),n=J(t,"y",0),r=J(t,"width",32),o=J(t,"height",32),s=new F(this.scene,i,n,r,o,t);return K(this.scene,s,t),s}function $(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);for(var n=.5*t.width,r=.5*t.height,o=Math.tan(e)*r,s=Math.tan(i)*n,a=t.controlPoints,u=0,h=a.length;u<h;u++){var c=a[u],l=c.localXOrigin,f=c.localYOrigin;c.localX=l+(r<f?o:-o),c.localY=f+(n<l?s:-s)}}var tt=Phaser.Utils.Objects.IsPlainObject,et=Phaser.Utils.Objects.GetValue,it=Phaser.Math.DegToRad,nt=Phaser.Math.RadToDeg,rt=function(){o(u,k);var a=l(u);function u(t,e,i,n,r){var o;if(c(this,u),tt(e)){var s=e;e=et(s,"x",0),i=et(s,"y",0),n=et(s,"key",null),r=et(s,"frame",null)}return(o=a.call(this,t,e,i,n,r)).type="rexSkewmage",o._skewX=0,o._skewY=0,o}return r(u,[{key:"skewX",get:function(){return this._skewX},set:function(t){this._skewX=t,$(this,this._skewX,this._skewY)}},{key:"skewXDeg",get:function(){return nt(this._skewX)},set:function(t){this.skewX=it(t)}},{key:"skewY",get:function(){return this._skewY},set:function(t){this._skewY=t,$(this,this._skewX,this._skewY)}},{key:"skewYDeg",get:function(){return nt(this._skewY)},set:function(t){this.skewY=it(t)}},{key:"setSkewX",value:function(t){return this.skewX=t,this}},{key:"setSkewY",value:function(t){return this.skewY=t,this}},{key:"setSkew",value:function(t,e){return void 0===e&&(e=t),this.skewX=t,this.skewY=e,this}},{key:"setSkewXDeg",value:function(t){return this.skewXDeg=t,this}},{key:"setSkewYDeg",value:function(t){return this.skewYDeg=t,this}},{key:"setSkewDeg",value:function(t,e){return void 0===e&&(e=t),this.skewXDeg=t,this.skewYDeg=e,this}}]),u}();function ot(t,e,i,n){var r=new rt(this.scene,t,e,i,n);return this.scene.add.existing(r),r}var st=Phaser.Utils.Objects.GetAdvancedValue,at=Phaser.GameObjects.BuildGameObject;function ut(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var i=st(t,"key",null),n=st(t,"frame",null),r=new rt(this.scene,0,0,i,n);return at(this.scene,r,t),r}var ht=Phaser.GameObjects.RenderTexture,ct=Phaser.Utils.Objects.IsPlainObject,lt=Phaser.Utils.Objects.GetValue,ft=function(){o(h,rt);var u=l(h);function h(t,e,i,n,r){var o;if(c(this,h),ct(e)){var s=e;e=lt(s,"x",0),i=lt(s,"y",0),n=lt(s,"width",32),r=lt(s,"height",32)}var a=new ht(t,e,i,n,r).setOrigin(.5);return(o=u.call(this,t,e,i,a.texture.key,null)).type="rexSkewRenderTexture",o.rt=a,o}return r(h,[{key:"destroy",value:function(t){f(s(h.prototype),"destroy",this).call(this,t),this.rt.destroy(),this.rt=null}}]),h}();function dt(t,e,i,n){var r=new ft(this.scene,t,e,i,n);return this.scene.add.existing(r),r}var yt=Phaser.Utils.Objects.GetAdvancedValue,vt=Phaser.GameObjects.BuildGameObject;function gt(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var i=yt(t,"x",0),n=yt(t,"y",0),r=yt(t,"width",32),o=yt(t,"height",32),s=new ft(this.scene,i,n,r,o);return vt(this.scene,s,t),s}function pt(t,e){if(t){for(var i=e.visibleSibling,n=0,r=i.length;n<r;n++)t.setChildVisible(i[n],!0);return i.length=0,t.setChildVisible(e,!1),e.isRunning=!1,1}}function wt(t){return function(){o(u,t);var a=l(u);function u(t,e){var i;c(this,u);var n,r,o,s=t.scene;return i=a.call(this,s,0,0,1,1,e),s.add.existing(h(i)),n=t,r=h(i),o=e,r.visibleSibling=[],r.isRunning=!1,r.useParentBounds=mt(o,"useParentBounds",!1),r.setPosition(n.x,n.y).setVisible(!1),n.pin(r),i}return r(u,[{key:"destroy",value:function(t){this.scene&&(this.exit(),f(s(u.prototype),"destroy",this).call(this,t))}},{key:"enter",value:function(){return function(t,e){if(!t)return!1;pt(t,e);var i=e.useParentBounds;G({gameObjects:t.getAllVisibleChildren(),renderTexture:e.rt,x:e.x,y:e.y,width:i?t.displayWidth:void 0,height:i?t.displayHeighth:void 0,originX:i?t.originX:void 0,originY:i?t.originY:void 0}),t.setChildVisible(e,!0);for(var n=e.visibleSibling,r=t.children,o=0,s=r.length;o<s;o++){var a=r[o];a.visible&&a!==e&&(t.setChildVisible(a,!1),n.push(a))}return e.isRunning=!0}(this.rexContainer.parent,this)&&this.syncSize(),this}},{key:"exit",value:function(){return pt(this.rexContainer.parent,this),this}}]),u}()}function xt(t){return null==t||""===t||0===t.length}function bt(t,e,i,n){if(void 0===n&&(n="."),"object"===u(t)){if(xt(e)){if(null==i)return;"object"===u(i)&&(t=i)}else{"string"==typeof e&&(e=e.split(n));var r=e.pop();(function(t,e,i){var n=t;if(!xt(e)){var r;"string"==typeof e&&(e=e.split("."));for(var o=0,s=e.length;o<s;o++){var a;if(null==n[r=e[o]]||"object"!==u(n[r]))a=o!==s-1||void 0===i?{}:i,n[r]=a;n=n[r]}}return n})(t,e)[r]=i}return t}}var mt=Phaser.Utils.Objects.GetValue,kt=function(){o(e,wt(ft));var t=l(e);function e(){return c(this,e),t.apply(this,arguments)}return r(e,[{key:"skewState",get:function(){return this.isRunning}}]),e}(),Pt=function(){o(n,Phaser.Plugins.BasePlugin);var i=l(n);function n(t){var e;return c(this,n),e=i.call(this,t),t.registerGameObject("rexQuadImage",a,j),t.registerGameObject("rexQuadRenderTexture",q,Z),t.registerGameObject("rexSkewImage",ot,ut),t.registerGameObject("rexSkewRenderTexture",dt,gt),e}return r(n,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}},{key:"addContainerSkew",value:function(t,e){return new kt(t,e)}}]),n}();return bt(window,"RexPlugins.GameObjects.QuadImage",k),bt(window,"RexPlugins.GameObjects.QuadRenderTexture",F),bt(window,"RexPlugins.GameObjects.SkewImage",rt),bt(window,"RexPlugins.GameObjects.SkewRenderTexture",ft),bt(window,"RexPlugins.GameObjects.ContainerSkew",kt),Pt});
