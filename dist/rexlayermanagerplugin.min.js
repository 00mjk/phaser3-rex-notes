!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexlayermanagerplugin=e()}(void 0,function(){function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function t(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&i(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function s(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function u(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=o(n);if(r){var i=o(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return s(this,t)}}function c(){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=o(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(arguments.length<3?t:i):r.value}}).apply(this,arguments)}var e={setEventEmitter:function(t,e){return void 0===e&&(e=Phaser.Events.EventEmitter),this._privateEE=!0===t||void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter:function(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter:function(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(t){return this._eventEmitter&&t&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]},eventNames:function(){return this._eventEmitter?this._eventEmitter.eventNames.apply(this._eventEmitter,arguments):[]}},a={hasProperty:function(t){var e=this.gameObject;return!!e.hasOwnProperty(t)||void 0!==e[t]},getProperty:function(t){return this.gameObject[t]},setProperty:function(t,e){return this.gameObject[t]=e,this},easeProperty:function(t,e,i,n,r,o,s){var a=this.tweens,h=a[t];h&&h.remove();var u=this.gameObject,c={targets:u,duration:i,ease:n,repeat:r,yoyo:o,onComplete:function(){a[t].remove(),a[t]=null,s&&s(u,t)},onCompleteScope:this};return c[t]=e,(h=this.scene.tweens.add(c)).timeScale=this.timeScale,a[t]=h,this}},f={hasMethod:function(t){return"function"==typeof this.gameObject[t]},call:function(t){if(!this.hasMethod(t))return this;for(var e=this.gameObject,i=arguments.length,n=new Array(1<i?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return e[t].apply(e,n),this}},l=function(){function n(t,e,i){h(this,n),this.GOManager=t,this.tweens={},this.setGO(e,i)}return t(n,[{key:"scene",get:function(){return this.GOManager.scene}},{key:"timeScale",get:function(){return this.GOManager.timeScale}},{key:"destroy",value:function(){this.freeGO(),this.GOManager=void 0}},{key:"freeTweens",value:function(){var t,e=this.tweens;for(var i in e)(t=e[i])&&t.remove(),e[i]=null;return this}},{key:"freeGO",value:function(){return this.freeTweens(),this.gameObject.destroy(),this.gameObject=void 0,this}},{key:"setGO",value:function(t,e){return t.setName(e),this.gameObject=t,this.name=e,this.freeTweens(),this}},{key:"setTimeScale",value:function(t){var e=this.tweens;for(var i in e)e[i].timeScale=t;return this}}]),n}();Object.assign(l.prototype,a,f,{hasData:function(t){var e=this.gameObject;return!!e.data&&e.data.has(t)},getData:function(t){return this.gameObject.getData(t)},setData:function(t,e){return this.gameObject.setData(t,e),this}});function d(t){return t>>16&255}function v(t){return t>>8&255}function y(t){return 255&t}function p(t,e,i,n,r){if(t.hasOwnProperty("vp"))return t;void 0===i&&(i=.5),void 0===n&&(n=.5),void 0===r&&(r=E),function(e){if(e.events)return;var i=new w,n=e.x;Object.defineProperty(e,"x",{get:function(){return n},set:function(t){n!==t&&(n=t,i.emit("update",e))}});var r=e.y;Object.defineProperty(e,"y",{get:function(){return r},set:function(t){r!==t&&(r=t,i.emit("update",e))}});var o=e.width;Object.defineProperty(e,"width",{get:function(){return o},set:function(t){o!==t&&(o=t,i.emit("update",e))}});var s=e.height;Object.defineProperty(e,"height",{get:function(){return s},set:function(t){s!==t&&(s=t,i.emit("update",e))}}),e.events=i}(e);var o=e.events;function s(){r(t,e,i,n)}t.vp=e,o.on("update",s),t.once("destroy",function(){o.off("update",s),t.vp=void 0}),Object.defineProperty(t,"vpx",{get:function(){return i},set:function(t){i!==t&&(i=t,s())}}),Object.defineProperty(t,"vpy",{get:function(){return n},set:function(t){n!==t&&(n=t,s())}}),s()}function m(t){return void 0!==t.displayWidth?t.displayWidth:t.width}function b(t){return void 0!==t.displayHeight?t.displayHeight:t.height}var g={tint:0,alpha:1},O={setGOFadeMode:function(t){return"string"==typeof t&&(t=g[t]),this.fadeMode=t,this},setGOFadeTime:function(t){return this.fadeTime=t,this},hasTintFadeEffect:function(t){return(void 0===this.fadeMode||0===this.fadeMode)&&0<this.fadeTime&&void 0!==t.setTint},hasAlphaFadeEffect:function(t){return(void 0===this.fadeMode||1===this.fadeMode)&&0<this.fadeTime&&void 0!==t.setAlpha},fadeBob:function(t,e,i,n){var r=t.gameObject;return this.hasTintFadeEffect(r)?(void 0!==e&&t.setProperty("tintGray",255*e),t.easeProperty("tintGray",Math.floor(255*i),this.fadeTime,"Linear",0,!1,n)):this.hasAlphaFadeEffect(r)?(void 0!==e&&t.setProperty("alpha",e),t.easeProperty("alpha",i,this.fadeTime,"Linear",0,!1,n)):n&&n(r),this}},w=Phaser.Events.EventEmitter,E=function(t,e,i,n){t.x=e.x+e.width*i,t.y=e.y+e.height*n},P=Phaser.Utils.Array.Remove,j={has:function(t){return this.bobs.hasOwnProperty(t)},get:function(t){return this.bobs[t]},getGO:function(t){var e=this.get(t);return e?e.gameObject:null},addGO:function(t,e){this.remove(t,!0),this.hasTintFadeEffect(e)&&function(e,i){if(e.hasOwnProperty("tintR"))return;void 0===i&&(i=16777215);var n=d(i),r=v(i),o=y(i);Object.defineProperty(e,"tint",{get:function(){return i},set:function(t){t=16777215&Math.floor(t),e.setTint&&e.setTint(t),i!==t&&(n=d(i=t),r=v(i),o=y(i))}}),Object.defineProperty(e,"tintR",{get:function(){return n},set:function(t){t=255&Math.floor(t),n!==t&&(n=t,e.tint=(255&t)<<16|65535&i)}}),Object.defineProperty(e,"tintG",{get:function(){return r},set:function(t){t=255&Math.floor(t),r!==t&&(r=t,e.tint=(255&t)<<8|16711935&i)}}),Object.defineProperty(e,"tintB",{get:function(){return o},set:function(t){t=255&Math.floor(t),o!==t&&(o=t,e.tint=255&t|16776960&i)}}),Object.defineProperty(e,"tintGray",{get:function(){return Math.floor((n+r+o)/3)},set:function(t){t=255&Math.floor(t),n===t&&r===t&&o===t||(o=r=n=t,e.tint=(255&t)<<16|(255&t)<<8|255&t)}}),e.tint=i}(e),this.viewportCoordinateEnable&&p(e,this.viewport),e.once("destroy",function(){P(this.removedGOs,e),this.isEmpty&&this.emit("empty")},this);var i=new this.BobClass(this,e,t);return this.bobs[t]=i,this},add:function(t){for(var e=this.createGameObjectCallback,i=this.createGameObjectScope,n=arguments.length,r=new Array(1<n?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var s=e.call.apply(e,[i,this.scene].concat(r));this.addGO(t,s);var a=this.get(t);return this.fadeBob(a,0,1),this},forEachGO:function(t,e){for(var i in this.bobs){var n=this.bobs[i].gameObject;if(e?t.call(e,n,i,this):t(n,i,this))break}return this}},_={remove:function(t,e){if(!this.has(t))return this;var i=this.get(t);return delete this.bobs[t],this.removedGOs.push(i.gameObject),e?i.destroy():this.fadeBob(i,void 0,0,function(){i.destroy()}),this},removeAll:function(){var t=this.bobs;for(var e in t)this.remove(e);return this},clear:function(t){void 0===t&&(t=!0);var e=this.bobs;for(var i in e)t&&e[i].destroy(),delete e[i];return this.removedGOs.length=0,this}},G={hasProperty:function(t,e){return!!this.has(t)&&this.get(t).hasProperty(e)},getProperty:function(t,e){if(this.has(t))return this.get(t).getProperty(e)},isNumberProperty:function(t,e){return"number"==typeof this.getProperty(t,e)},setProperty:function(t,e,i){return this.has(t)&&(this.symbols&&"string"==typeof i&&this.isNumberProperty(t,e)&&(i in this.symbols?i=this.symbols[i]:console.warn("Can't find symbol ".concat(i))),this.get(t).setProperty(e,i)),this},easeProperty:function(t,e,i,n,r,o,s,a){return this.has(t)&&(void 0===n&&(n=1e3),void 0===r&&(r="Linear"),void 0===o&&(o=0),void 0===s&&(s=!1),this.symbols&&"string"==typeof i&&this.isNumberProperty(t,e)&&(i in this.symbols?i=this.symbols[i]:console.warn("Can't find symbol ".concat(i))),this.get(t).easeProperty(e,i,n,r,o,s,a)),this},hasTweenTask:function(t,e){return!!this.has(t)&&this.get(t).tweens.hasOwnProperty(e)},getTweenTask:function(t,e){if(!this.has(t))return null;var i=this.get(t).tweens[e];return i||null}},T={hasMethod:function(t,e){return!!this.has(t)&&this.get(t).hasMethod(e)},call:function(t,e){var i;if(!this.has(t))return this;for(var n=arguments.length,r=new Array(2<n?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return(i=this.get(t)).call.apply(i,[e].concat(r)),this}},C={hasData:function(t,e){return!!this.has(t)&&this.get(t).hasData(e)},getData:function(t,e){if(this.has(t))return this.get(t).getData(e)},setData:function(t,e,i){return this.has(t)&&this.get(t).setData(e,i),this}};Phaser.Geom.Rectangle;function k(t,e,i){var n,r,o,s,a,h,u,c,f,l,d,v,y,p;(t.getBounds||void 0!==t.width&&void 0!==t.height)&&("number"==typeof i?n=i:(n=R(i,"color"),r=R(i,"lineWidth")),void 0===n&&(n=16777215),void 0===r&&(r=1),L[0]=(o=t,void 0===(s=L[0])?s=new x:!0===s&&(void 0===S&&(S=new x),s=S),o.getTopLeft?o.getTopLeft(s):(s.x=o.x-m(o)*o.originX,s.y=o.y-b(o)*o.originY,B(o,s,a))),L[1]=(h=t,void 0===(u=L[1])?u=new x:!0===u&&(void 0===S&&(S=new x),u=S),h.getTopRight?h.getTopRight(u):(u.x=h.x-m(h)*h.originX+m(h),u.y=h.y-b(h)*h.originY,B(h,u,c))),L[2]=(f=t,void 0===(l=L[2])?l=new x:!0===l&&(void 0===S&&(S=new x),l=S),f.getBottomRight?f.getBottomRight(l):(l.x=f.x-m(f)*f.originX+m(f),l.y=f.y-b(f)*f.originY+b(f),B(f,l,d))),L[3]=(v=t,void 0===(y=L[3])?y=new x:!0===y&&(void 0===S&&(S=new x),y=S),v.getBottomLeft?v.getBottomLeft(y):(y.x=v.x-m(v)*v.originX,y.y=v.y-b(v)*v.originY+b(v),B(v,y,p))),e.lineStyle(r,n).strokePoints(L,!0,!0))}var x=Phaser.Math.Vector2,M=Phaser.Math.RotateAround,S=void 0,B=function(t,e,i){void 0===i&&(i=!1),0!==t.rotation&&M(e,t.x,t.y,t.rotation),i&&t.parentContainer&&t.parentContainer.getBoundsTransformMatrix().transformPoint(e.x,e.y,e);return e},R=Phaser.Utils.Objects.GetValue,L=[void 0,void 0,void 0,void 0],D={drawGameObjectsBounds:function(e,i){return this.forEachGO(function(t){t.drawBounds?t.drawBounds(e,i):k(t,e,i)}),this}};Object.assign(D,O,j,_,G,T,C);function A(t,e,i){e instanceof F||(i=e,e=void 0),void 0===i?i=new V:!0===i&&(i=X);var n,r,o=t.sys.scale,s=o.baseSize,a=o.parentSize,h=o.canvasBounds,u=o.displayScale,c=0<=h.x?0:-(h.x*u.x),f=0<=h.y?0:-(h.y*u.y);return n=a.width>=h.width?s.width:s.width-(h.width-a.width)*u.x,r=a.height>=h.height?s.height:s.height-(h.height-a.height)*u.y,i.setTo(c,f,n,r),e&&(i.width/=e.zoomX,i.height/=e.zoomY,i.centerX=e.centerX+e.scrollX,i.centerY=e.centerY+e.scrollY),i}var F=Phaser.Cameras.Scene2D.BaseCamera,V=Phaser.Geom.Rectangle,X=new V,Y=Phaser.Utils.Objects.GetValue,N=function(){function r(t,e){h(this,r),this.scene=t,this.BobClass=Y(e,"BobClass",l),this.setCreateGameObjectCallback(Y(e,"createGameObject"),Y(e,"createGameObjectScope")),this.setEventEmitter(Y(e,"eventEmitter",void 0));var i=Y(e,"fade",500);"number"==typeof i?(this.setGOFadeMode(),this.setGOFadeTime(i)):(this.setGOFadeMode(Y(i,"mode")),this.setGOFadeTime(Y(i,"time",500)));var n=Y(e,"viewportCoordinate",!1);!1!==n?(this.setViewportCoordinateEnable(Y(e,"enable",!0)),this.setViewport(Y(n,"viewport"))):this.setViewportCoordinateEnable(!1),this.setSymbols(Y(e,"symbols")),this.bobs={},this.removedGOs=[],this._timeScale=1}return t(r,[{key:"destroy",value:function(t){this.clear(!t),this.createGameObjectCallback=void 0,this.viewport=void 0,this.scene=void 0}},{key:"timeScale",get:function(){return this._timeScale},set:function(t){if(this._timeScale!==t){this._timeScale=t;var e=this.bobs;for(var i in e)e[i].setTimeScale(t)}}},{key:"setTimeScale",value:function(t){return this.timeScale=t,this}},{key:"setCreateGameObjectCallback",value:function(t,e){return this.createGameObjectCallback=t,this.createGameObjectScope=e,this}},{key:"setViewportCoordinateEnable",value:function(t){return void 0===t&&(t=!0),this.viewportCoordinateEnable=t,this}},{key:"setViewport",value:function(t){return void 0===t&&(t=A(this.scene,this.scene.cameras.main)),this.viewport=t,this}},{key:"setSymbols",value:function(t){return this.symbols=t,this}},{key:"isEmpty",get:function(){return function(t){for(var e in t)return!1;return!0}(this.bobs)&&0===this.removedGOs.length}}]),r}();Object.assign(N.prototype,e,D);var z=Phaser.Utils.Objects.GetValue,U=function(){r(a,N);var s=u(a);function a(t,e){var i;h(this,a),void 0===e&&(e={}),e.hasOwnProperty("fade")||(e.fade=0),e.viewportCoordinate=!1,i=s.call(this,t,e);var n=z(e,"layers");if(n)for(var r=0,o=n.length;r<o;r++)i.add(n[r]);return i}return t(a,[{key:"setCreateGameObjectCallback",value:function(t,e){return t=t||W,c(o(a.prototype),"setCreateGameObjectCallback",this).call(this,t,e),this}},{key:"getLayer",value:function(t){return this.getGO(t)}},{key:"addToLayer",value:function(t,e){var i=this.getGO(t);if(i)return e.isRexContainerLite?e.addToLayer(i):i.add(e),this;console.warn("Can't get layer \"".concat(t,'"'))}}]),a}(),W=function(t,e){var i=t.add.layer();return void 0!==e&&i.setDepth(e),i};return function(){r(i,Phaser.Plugins.BasePlugin);var e=u(i);function i(t){return h(this,i),e.call(this,t)}return t(i,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}},{key:"add",value:function(t,e){return new U(t,e)}}]),i}()});
