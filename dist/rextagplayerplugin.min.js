!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rextagplayerplugin=e()}(void 0,function(){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function h(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function d(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&n(t,e)}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function n(t,e){return(n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function p(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function v(i){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=l(i);if(s){var n=l(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return p(t)}(this,t)}}function c(){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=l(t)););return t}(t,e);if(i){var s=Object.getOwnPropertyDescriptor(i,e);return s.get?s.get.call(arguments.length<3?t:n):s.value}}).apply(this,arguments)}function E(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function r(t,e,n){if(t&&"number"!=typeof t){if(t.hasOwnProperty(e))return t[e];if(-1===e.indexOf("."))return n;for(var i=e.split("."),s=t,r=n,a=0;a<i.length;a++){if(!s.hasOwnProperty(i[a])){r=n;break}r=s[i[a]],s=s[i[a]]}return r}return n}function a(t){return t.replace(g,"\\$&").replace(y,"\\x2d")}function e(t){return"string"!=typeof t||(""===t?t=null:k.test(t)?t=parseFloat(t):"false"===t?t=!1:"true"===t&&(t=!0)),t}function u(t){return t}var t={setEventEmitter:function(t,e){return void 0===e&&(e=Phaser.Events.EventEmitter),this._privateEE=!0===t||void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter:function(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter:function(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(t){return this._eventEmitter&&t&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]},eventNames:function(){return this._eventEmitter?this._eventEmitter.eventNames.apply(this._eventEmitter,arguments):[]}},g=/[|\\{}()[\]^$+*?.]/g,y=/-/g,k=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,m=function(){function n(t){f(this,n),this.setEventEmitter(r(t,"eventEmitter",void 0)),this.setTagExpression(r(t,"regex.tag","[a-z0-9-_.]+")),this.setValueExpression(r(t,"regex.value","[ #a-z-_.0-9,|&]+")),this.setValueConverter(r(t,"valueConvert",!0));var e=r(t,"delimiters","<>");this.setDelimiters(e[0],e[1]),this.isRunning=!1,this.isPaused=!1,this.skipEventFlag=!1,this.lastTagStart=null,this.lastTagEnd=null,this.lastContent=null}return h(n,[{key:"shutdown",value:function(){this.destroyEventEmitter()}},{key:"destroy",value:function(){this.shutdown()}},{key:"setTagExpression",value:function(t){return this.tagExpression=t,this}},{key:"setValueExpression",value:function(t){return this.valueExpression=t,this}},{key:"setValueConverter",value:function(t){return t=!0===t?e:t||u,this.valueConverter=t,this}},{key:"setDelimiters",value:function(t,e){void 0===e&&(e=t[1],t=t[0]),this.delimiterLeft=t,this.delimiterRight=e,t=a(t),e=a(e);var n="".concat(t,"(").concat(this.tagExpression,")(=(").concat(this.valueExpression,"))?").concat(e),i="".concat(t,"/(").concat(this.tagExpression,")").concat(e);return this.reTagOn=RegExp(n,"i"),this.reTagOff=RegExp(i,"i"),this.reSplit=RegExp("".concat(n,"|").concat(i),"gi"),this}},{key:"setSource",value:function(t){return this.source=t,this}},{key:"resetIndex",value:function(t){return void 0===t&&(t=0),this.progressIndex=t,this.reSplit.lastIndex=t,this.lastTagStart=null,this.lastTagEnd=null,this.lastContent=null,this}},{key:"start",value:function(t){return this.setSource(t).restart(),this}},{key:"restart",value:function(){this.resetIndex().next()}},{key:"next",value:function(){this.isPaused&&this.onResume(),0===this.reSplit.lastIndex&&this.onStart();for(var t=this.source,e=t.length;!this.isPaused;){var n=this.reSplit.exec(t);if(!n)return this.progressIndex<e&&this.onContent(t.substring(this.progressIndex,e)),void this.onComplete();var i=n[0],s=this.reSplit.lastIndex-i.length;this.progressIndex<s&&this.onContent(t.substring(this.progressIndex,s)),this.reTagOff.test(i)?this.onTagEnd(i):this.onTagStart(i),this.progressIndex=this.reSplit.lastIndex}}},{key:"skipEvent",value:function(){return this.skipEventFlag=!0,this}},{key:"pause",value:function(){return this.isPaused||this.onPause(),this}},{key:"onContent",value:function(t){this.skipEventFlag=!1,this.emit("content",t),this.lastContent=t}},{key:"onTagStart",value:function(t){var e=t.match(this.reTagOn),n=e[1],i=function(t,e){if(null==t)return[];for(var n=t.split(","),i=0,s=n.length;i<s;i++)n[i]=e(n[i]);return n}(e[3],this.valueConverter);this.skipEventFlag=!1,this.emit.apply(this,["+".concat(n)].concat(E(i))),this.skipEventFlag||this.emit.apply(this,["+",n].concat(E(i))),this.lastTagStart=n}},{key:"onTagEnd",value:function(t){var e=t.match(this.reTagOff)[1];this.skipEventFlag=!1,this.emit("-".concat(e)),this.skipEventFlag||this.emit("-",e),this.lastTagEnd=e}},{key:"onStart",value:function(){this.isRunning=!0,this.emit("start",this)}},{key:"onComplete",value:function(){this.isRunning=!1,this.emit("complete",this),this.resetIndex()}},{key:"onPause",value:function(){this.isPaused=!0,this.emit("pause",this)}},{key:"onResume",value:function(){this.isPaused=!1,this.emit("resume",this)}},{key:"getTagOnRegString",value:function(t,e){return void 0===t&&(t=this.tagExpression),void 0===e&&(e=this.valueExpression),"".concat(a(this.delimiterLeft),"(").concat(t,")(=(").concat(e,"))?").concat(a(this.delimiterRight))}},{key:"getTagOffRegString",value:function(t){return void 0===t&&(t=this.tagExpression),"".concat(a(this.delimiterLeft),"/(").concat(t,")").concat(a(this.delimiterRight))}}]),n}();Object.assign(m.prototype,t);function w(t,e){return 2===t.length&&t[0]===e}function x(t,e){return 3===t.length&&t[0]===e&&"play"===t[2]}function b(t,e){return 2===t.length&&t[0]===e}function T(t,e){return 3===t.length&&t[0]===e&&"text"===t[2]}function S(t){return t instanceof ut}var O=Phaser.Utils.Objects.GetValue,P=Phaser.Utils.Objects.GetValue,M=Phaser.Utils.Objects.GetValue,C=Phaser.Utils.Objects.GetValue,R=Phaser.Utils.Objects.GetValue,F=Phaser.Utils.Objects.GetValue,j=Phaser.Utils.Objects.GetValue,_=Phaser.Utils.Objects.GetValue,L=Phaser.Utils.Objects.GetValue,G=Phaser.Utils.Objects.GetValue,A=Phaser.Utils.Objects.GetValue,B=Phaser.Utils.Objects.GetValue,z=Phaser.Utils.Objects.GetValue,I=Phaser.Utils.Objects.GetValue,V=Phaser.Utils.Objects.GetValue,W=Phaser.Utils.Objects.GetValue,U=Phaser.Math.DegToRad,D=Phaser.Utils.Objects.GetValue,H=Phaser.Utils.Objects.GetValue,X=Phaser.Utils.Objects.GetValue,Y=Phaser.Utils.Objects.GetValue,N=Phaser.Utils.Objects.GetValue,J=Phaser.Utils.Objects.GetValue,K=Phaser.Utils.Objects.GetValue,$=Phaser.Utils.Objects.GetValue,q=Phaser.Utils.Objects.GetValue,Z={to:!0,yoyo:!0},Q=Phaser.Utils.Objects.GetValue,tt=Phaser.Utils.Objects.GetValue,et=Phaser.Utils.Objects.GetValue,nt=Phaser.Utils.Objects.GetValue,it=Phaser.Utils.Objects.GetValue,st={to:!0,yoyo:!0},rt=[function(e,n,t){var i=O(t,"tags.wait","wait"),s=O(t,"tags.click","click");n.on("+".concat(i),function(t){e.wait(t),n.skipEvent()}).on("-".concat(i),function(){n.skipEvent()}).on("+".concat(s),function(){e.wait("click"),n.skipEvent()}).on("-".concat(s),function(){n.skipEvent()})},function(n,i,t){var e=P(t,"tags.se","se");i.on("+".concat(e),function(t,e){this.skipSoundEffect||(n.soundManager.playSoundEffect(t),e&&n.soundManager.fadeInSoundEffect(e),i.skipEvent())}).on("-".concat(e),function(){i.skipEvent()})},function(e,n,t){var i=M(t,"tags.se.fadein","se.fadein");n.on("+".concat(i),function(t){e.soundManager.fadeInSoundEffect(t),n.skipEvent()}).on("-".concat(i),function(){n.skipEvent()})},function(n,i,t){var e=C(t,"tags.se.fadeout","se.fadeout");i.on("+".concat(e),function(t,e){e="stop"===e,n.soundManager.fadeOutSoundEffect(t,e),i.skipEvent()}).on("-".concat(e),function(){i.skipEvent()})},function(e,n,t){var i=R(t,"tags.se.volume","se.volume");n.on("+".concat(i),function(t){e.soundManager.setSoundEffectVolume(t),n.skipEvent()}).on("-".concat(i),function(){n.skipEvent()})},function(n,i,t){var e=F(t,"tags.bgm","bgm");i.on("+".concat(e),function(t,e){n.soundManager.playBackgroundMusic(t),e&&n.soundManager.fadeInBackgroundMusic(e),i.skipEvent()}).on("-".concat(e),function(){n.soundManager.stopBackgroundMusic(),i.skipEvent()})},function(e,n,t){var i=j(t,"tags.bgm.fadein","bgm.fadein");n.on("+".concat(i),function(t){e.soundManager.fadeInBackgroundMusic(t),n.skipEvent()}).on("-".concat(i),function(){n.skipEvent()})},function(n,i,t){var e=_(t,"tags.bgm.fadeout","bgm.fadeout");i.on("+".concat(e),function(t,e){e="stop"===e,n.soundManager.fadeOutBackgroundMusic(t,e),i.skipEvent()}).on("-".concat(e),function(){i.skipEvent()})},function(n,i,t){var e=L(t,"tags.bgm.cross","bgm.cross");i.on("+".concat(e),function(t,e){n.soundManager.crossFadeBackgroundMusic(t,e),i.skipEvent()}).on("-".concat(e),function(){i.skipEvent()})},function(t,e,n){var i=G(n,"tags.bgm.pause","bgm.pause");e.on("+".concat(i),function(){t.soundManager.pauseBackgroundMusic(),e.skipEvent()}).on("-".concat(i),function(){t.soundManager.resumeBackgroundMusic(),e.skipEvent()})},function(s,r,t){var e=A(t,"tags.camera.fadein","camera.fadein");r.on("+".concat(e),function(t,e,n,i){s.camera.fadeIn(t,e,n,i),r.skipEvent()})},function(s,r,t){var e=B(t,"tags.camera.fadeout","camera.fadeout");r.on("+".concat(e),function(t,e,n,i){s.camera.fadeOut(t,e,n,i),r.skipEvent()})},function(n,i,t){var e=z(t,"tags.camera.shake","camera.shake");i.on("+".concat(e),function(t,e){n.camera.shake(t,e),i.skipEvent()})},function(s,r,t){var e=I(t,"tags.camera.flash","camera.flash");r.on("+".concat(e),function(t,e,n,i){s.camera.flash(t,e,n,i),r.skipEvent()})},function(i,s,t){var e=V(t,"tags.camera.zoom","camera.zoom");s.on("+".concat(e),function(t){i.camera.setZoom(t),s.skipEvent()}).on("+".concat(e,".to"),function(t,e,n){i.camera.zoomTo(t,e,n),s.skipEvent()})},function(i,s,t){var e=W(t,"tags.camera.rotate","camera.rotate");s.on("+".concat(e),function(t){i.camera.setRotation(U(t)),s.skipEvent()}).on("+".concat(e,".to"),function(t,e,n){t=U(t),i.camera.rotateTo(U(t),!1,e,n),s.skipEvent()})},function(o,u,t){var e=D(t,"tags.camera.scroll","camera.scroll");u.on("+".concat(e),function(t,e){o.camera.setScroll(t,e),u.skipEvent()}).on("+".concat(e,".to"),function(t,e,n,i){var s=o.camera,r=s.scrollX,a=s.scrollY;s.setScroll(t,e),t+=s.centerX,e+=s.centerY,s.setScroll(r,a),s.pan(t,e,n,i),u.skipEvent()})},function(o,u,t){var h=H(t,"sprite","sprite");h&&u.on("+",function(t){var e;if(!u.skipEventFlag){var n,i=t.split(".");if(w(i,h)){n=i[1];for(var s=arguments.length,r=new Array(1<s?s-1:0),a=1;a<s;a++)r[a-1]=arguments[a];(e=o.spriteManager).add.apply(e,[n].concat(r)),u.skipEvent()}}}).on("-",function(t){if(!u.skipEventFlag){var e,n=t.split(".");w(n,h)&&(e=n[1],o.spriteManager.remove(e),u.skipEvent())}})},function(e,n,t){var i=X(t,"sprite","sprite");i&&n.on("-",function(t){n.skipEventFlag||t===i&&(e.spriteManager.removeAll(),n.skipEvent())})},function(o,u,t){var h=Y(t,"sprite","sprite");h&&u.on("+",function(t,e,n){if(!u.skipEventFlag){var i,s,r,a=t.split(".");if(r=h,3===(s=a).length&&s[0]===r&&"texture"===s[2])i=a[1],o.spriteManager.setTexture(i,e,n),u.skipEvent()}})},function(r,a,t){var o=N(t,"sprite","sprite");o&&a.on("+",function(t){if(!a.skipEventFlag){var e,n=t.split(".");if(x(n,o)){e=n[1];var i=Array.prototype.slice.call(arguments,1),s=i.shift();r.spriteManager.playAnimation(e,s),0<i.length&&r.spriteManager.chainAnimation(e,i),a.skipEvent()}}}).on("+",function(t){if(!a.skipEventFlag){var e,n,i,s=t.split(".");if(i=o,3===(n=s).length&&n[0]===i&&"stop"===n[2])e=s[1],r.spriteManager.stopAnimation(e),a.skipEvent()}}).on("-",function(t){if(!a.skipEventFlag){var e,n=t.split(".");x(n,o)&&(e=n[1],r.spriteManager.stopAnimation(e),a.skipEvent())}})},function(a,o,t){var u=J(t,"sprite","sprite");u&&o.on("+",function(t){if(!o.skipEventFlag){var e,n=t.split(".");if(s=u,3===(i=n).length&&i[0]===s&&"chain"===i[2]){var i,s;e=n[1];var r=Array.prototype.slice.call(arguments,1);a.spriteManager.chainAnimation(e,r),o.skipEvent()}}})},function(r,a,t){var o=K(t,"sprite","sprite");o&&a.on("+",function(t){if(!a.skipEventFlag){var e,n,i,s=t.split(".");if(i=o,3===(n=s).length&&n[0]===i&&"pause"===n[2])e=s[1],r.spriteManager.pauseAnimation(e),a.skipEvent()}})},function(o,u,t){var h=$(t,"sprite","sprite");h&&u.on("+",function(t,e){if(!u.skipEventFlag){var n,i,s,r,a=t.split(".");if(r=h,3===(s=a).length&&s[0]===r)n=a[1],i=a[2],o.spriteManager.setProperty(n,i,e),u.skipEvent()}})},function(c,f,t){var d=q(t,"sprite","sprite");d&&f.on("+",function(t,e,n,i,s){if(!f.skipEventFlag){var r,a,o,u,h,l=t.split(".");if(h=d,4===(u=l).length&&u[0]===h&&Z[u[3]])r=l[1],a=l[2],o="yoyo"===l[3],"number"==typeof i&&(s=i,i=void 0),c.spriteManager.easeProperty(r,a,e,n,i,s,o),f.skipEvent()}})},function(i,s,t){var r=Q(t,"text","text");r&&s.on("+",function(t){if(!s.skipEventFlag){var e,n=t.split(".");b(n,r)&&(e=n[1],i.textManager.add(e),s.skipEvent())}}).on("-",function(t){if(!s.skipEventFlag){var e,n=t.split(".");b(n,r)&&(e=n[1],i.textManager.remove(e),s.skipEvent())}})},function(e,n,t){var i=tt(t,"text","text");i&&n.on("-",function(t){n.skipEventFlag||t===i&&(e.textManager.removeAll(),n.skipEvent())})},function(i,s,t){var r=et(t,"text","text");r&&s.on("+",function(t,e){if(!s.skipEventFlag){var n=t.split(".");T(n,r)&&(n[1],s.skipEvent())}}).on("content",function(t){if(!s.skipEventFlag&&"\n"!==t){var e,n=s.lastTagStart.split(".");T(n,r)&&(e=n[1],t=t.replaceAll("\\n","\n"),i.textManager.setText(e,t),s.skipEvent())}})},function(o,u,t){var h=nt(t,"text","text");h&&u.on("+",function(t,e){if(!u.skipEventFlag){var n,i,s,r,a=t.split(".");if(r=h,3===(s=a).length&&s[0]===r)n=a[1],i=a[2],o.textManager.setProperty(n,i,e),u.skipEvent()}})},function(c,f,t){var d=it(t,"text","text");d&&f.on("+",function(t,e,n,i,s){if(!f.skipEventFlag){var r,a,o,u,h,l=t.split(".");if(h=d,4===(u=l).length&&u[0]===h&&st[u[3]])r=l[1],a=l[2],o="yoyo"===l[3],"number"==typeof i&&(s=i,i=void 0),c.textManager.easeProperty(r,a,e,n,i,s,o),f.skipEvent()}})},function(n,i){i.on("content",function(t){if(!i.skipEventFlag&&"\n"!==t){var e="+".concat(i.lastTagStart);n.emit("".concat(e,"#content"),i,t)}})},function(r,a){a.on("+",function(t){if(!a.skipEventFlag){for(var e="+".concat(t),n=arguments.length,i=new Array(1<n?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];r.emit.apply(r,["".concat(e),a].concat(i))}}).on("-",function(t){if(!a.skipEventFlag){var e="-".concat(t);r.emit("".concat(e),a)}})}],at=Phaser.Utils.Objects.GetValue,ot=function(){d(s,m);var i=v(s);function s(t,e){var n;return f(this,s),void 0===e&&(e={}),e.hasOwnProperty("delimiters")||(e.delimiters="[]"),function(t,e,n){for(var i=0,s=rt.length;i<s;i++)rt[i](t,e,n);e.on("start",function(){t.emit("start",e)}).on("complete",function(){t.emit("complete",e)})}(t,p(n=i.call(this,e)),e),n.setCommentLineStartSymbol(at(e,"comment","//")),n}return h(s,[{key:"setCommentLineStartSymbol",value:function(t){return this.commentLineStart=t,this}},{key:"start",value:function(t){return c(l(s.prototype),"start",this).call(this,function(t,e){for(var n=t.commentLineStart,i=e.split("\n"),s=0,r=i.length;s<r;s++){var a=i[s];""===a||(0===a.trim().length||n&&a.startsWith(n))&&(i[s]="")}return i.join("")}(this,t)),this}}]),s}(),ut=Phaser.Scene,ht=Phaser.Utils.Objects.GetValue,lt=function(){function i(t,e){var n;f(this,i),this.parent=t,this.scene=null==(n=t)||"object"!==o(n)?null:S(n)?n:n.scene&&S(n.scene)?n.scene:n.parent&&n.parent.scene&&S(n.parent.scene)?n.parent.scene:void 0,this.isShutdown=!1,this.setEventEmitter(ht(e,"eventEmitter",!0)),this.parent&&this.parent===this.scene?this.scene.sys.events.once("shutdown",this.onSceneDestroy,this):this.parent&&this.parent.once&&this.parent.once("destroy",this.onParentDestroy,this)}return h(i,[{key:"shutdown",value:function(){this.isShutdown||(this.parent&&this.parent===this.scene?this.scene.sys.events.off("shutdown",this.onSceneDestroy,this):this.parent&&this.parent.once&&this.parent.off("destroy",this.onParentDestroy,this),this.destroyEventEmitter(),this.parent=void 0,this.scene=void 0,this.isShutdown=!0)}},{key:"destroy",value:function(t){this.shutdown(t)}},{key:"onSceneDestroy",value:function(){this.destroy(!0)}},{key:"onParentDestroy",value:function(t,e){this.destroy(e)}}]),i}();Object.assign(lt.prototype,t);function ct(t,e,n,i,s){void 0===i&&(i=1),void 0===s&&(s=0);var r,a={mode:0,volume:{start:s,end:i},duration:n};return"string"==typeof e&&(e=t.sys.sound.add(e)),e.hasOwnProperty("_fade")?(r=e._fade).stop().resetFromJSON(a):(r=new Yt(t,e,a),e._fade=r),r.start(),e.isPlaying||e.setVolume(s).play(),e}function ft(t,e,n,i){void 0===i&&(i=!0);var s,r={mode:i?2:1,volume:{start:e.volume,end:0},duration:n};return e.hasOwnProperty("_fade")?(s=e._fade).stop().resetFromJSON(r):(s=new Yt(t,e,r),e._fade=s),s.start(),e.isPlaying||e.play(),e}function dt(t){return t>>16&255}function pt(t){return t>>8&255}function vt(t){return 255&t}function gt(t,e,n,i,s){if(t.hasOwnProperty("vp"))return t;void 0===n&&(n=.5),void 0===i&&(i=.5),void 0===s&&(s=Qt),function(e){if(e.events)return;var n=new Zt,i=e.x;Object.defineProperty(e,"x",{get:function(){return i},set:function(t){i!==t&&(i=t,n.emit("update",e))}});var s=e.y;Object.defineProperty(e,"y",{get:function(){return s},set:function(t){s!==t&&(s=t,n.emit("update",e))}});var r=e.width;Object.defineProperty(e,"width",{get:function(){return r},set:function(t){r!==t&&(r=t,n.emit("update",e))}});var a=e.height;Object.defineProperty(e,"height",{get:function(){return a},set:function(t){a!==t&&(a=t,n.emit("update",e))}}),e.events=n}(e);var r=e.events;function a(){s(t,e,n,i)}t.vp=e,r.on("update",a),t.once("destroy",function(){r.off("update",a),t.vp=void 0}),Object.defineProperty(t,"vpx",{get:function(){return n},set:function(t){n!==t&&(n=t,a())}}),Object.defineProperty(t,"vpy",{get:function(){return i},set:function(t){i!==t&&(i=t,a())}}),a()}var yt=Phaser.Utils.Objects.GetValue,kt=function(){d(s,lt);var i=v(s);function s(t,e){var n;return f(this,s),(n=i.call(this,t,e))._isRunning=!1,n.isPaused=!1,n.tickingState=!1,n.setTickingMode(yt(e,"tickingMode",1)),n}return h(s,[{key:"boot",value:function(){2!==this.tickingMode||this.tickingState||this.startTicking()}},{key:"shutdown",value:function(t){this.isShutdown||(this.stop(),this.tickingState&&this.stopTicking(),c(l(s.prototype),"shutdown",this).call(this,t))}},{key:"setTickingMode",value:function(t){"string"==typeof t&&(t=mt[t]),this.tickingMode=t}},{key:"startTicking",value:function(){this.tickingState=!0}},{key:"stopTicking",value:function(){this.tickingState=!1}},{key:"isRunning",get:function(){return this._isRunning},set:function(t){this._isRunning!==t&&(this._isRunning=t,1===this.tickingMode&&t!=this.tickingState&&(t?this.startTicking():this.stopTicking()))}},{key:"start",value:function(){return this.isPaused=!1,this.isRunning=!0,this}},{key:"pause",value:function(){return this.isRunning&&(this.isPaused=!0,this.isRunning=!1),this}},{key:"resume",value:function(){return this.isPaused&&(this.isRunning=!0),this}},{key:"stop",value:function(){return this.isPaused=!1,this.isRunning=!1,this}},{key:"complete",value:function(){this.isPaused=!1,this.isRunning=!1,this.emit("complete",this.parent,this)}}]),s}(),mt={no:0,lazy:1,always:2},wt=Phaser.Utils.Objects.GetValue,xt=function(){d(s,kt);var i=v(s);function s(t,e){var n;return f(this,s),(n=i.call(this,t,e)).resetFromJSON(e),n.boot(),n}return h(s,[{key:"resetFromJSON",value:function(t){return this.isRunning=wt(t,"isRunning",!1),this.timeScale=wt(t,"timeScale",1),this.now=wt(t,"now",0),this}},{key:"toJSON",value:function(){return{isRunning:this.isRunning,timeScale:this.timeScale,now:this.now,tickingMode:this.tickingMode}}},{key:"start",value:function(t){return void 0===t&&(t=0),this.delta=0,this.now=t,c(l(s.prototype),"start",this).call(this),this}},{key:"seek",value:function(t){return this.now=t,this}},{key:"setTimeScale",value:function(t){return this.timeScale=t,this}},{key:"tick",value:function(t){return t*=this.timeScale,this.now+=t,this.delta=t,this.emit("update",this.now,this.delta),this}}]),s}(),bt=function(){d(e,xt);var t=v(e);function e(){return f(this,e),t.apply(this,arguments)}return h(e,[{key:"startTicking",value:function(){c(l(e.prototype),"startTicking",this).call(this),this.scene.sys.events.on("update",this.update,this)}},{key:"stopTicking",value:function(){c(l(e.prototype),"stopTicking",this).call(this),this.scene&&this.scene.sys.events.off("update",this.update,this)}},{key:"update",value:function(t,e){return this.isRunning&&0!==this.timeScale&&this.tick(e),this}}]),e}(),Tt=Phaser.Math.Clamp,St=function(){function n(t,e){f(this,n),this.setTimeline(t).reset(e)}return h(n,[{key:"setTimeline",value:function(t){return this.timeline=t,this}},{key:"setName",value:function(t){return this.name=t,this}},{key:"setCallbacks",value:function(t,e,n,i){return this.target=t,this.onStart=e,this.onProgress=n,this.onComplete=i,this}},{key:"setDuration",value:function(t,e){return void 0===e&&(e=!1),this.duration=t,this.remainder=t,this.t=0,this.yoyo=e,this}},{key:"setPaused",value:function(t){return this.isPaused=t,this}},{key:"pause",value:function(){return this.isPaused=!0,this}},{key:"resume",value:function(){return this.isPaused=!1,this}},{key:"setRemoved",value:function(t){return this.removed=t,this}},{key:"remove",value:function(){return this.removed=!0,this}},{key:"seek",value:function(t){return this.remainder=this.duration*(1-t),this}},{key:"reset",value:function(t){return this.setName(t.name).setDuration(t.duration,t.yoyo).setCallbacks(t.target,t.onStart,t.onProgress,t.onComplete).setPaused(!1).setRemoved(!1),this}},{key:"onFree",value:function(){this.setTimeline().setCallbacks()}},{key:"getProgress",value:function(){var t,e,n=1-this.remainder/this.duration;return n=Tt(n,0,1),this.yoyo&&(void 0===e&&(e=.5),(t=n)<=e?t/=e:t=1-(t-e)/(1-e),n=t),n}},{key:"setProgress",value:function(t){t=Tt(t,0,1),this.remainder=this.duration*(1-t)}},{key:"runCallback",value:function(t){t&&t(this.target,this.t,this)}},{key:"update",value:function(t,e){if(this.removed)return!0;if(this.isPaused)return!1;this.remainder-=e,this.t=this.getProgress(),this.runCallback(this.onProgress);var n=this.remainder<=0;return n&&this.runCallback(this.onComplete),n}}]),n}(),Ot=function(){function t(){f(this,t),this.items=[]}return h(t,[{key:"destroy",value:function(){this.clear(),this.items=void 0}},{key:"pop",value:function(){return 0<this.items.length?this.items.pop():null}},{key:"push",value:function(t){return this.items.push(t),this}},{key:"pushMultiple",value:function(t){return this.items.push.apply(this.items,t),t.length=0,this}},{key:"clear",value:function(){return this.items.length=0,this}}]),t}(),Pt=function(){d(e,Ot);var t=v(e);function e(){return f(this,e),t.apply(this,arguments)}return h(e,[{key:"allocate",value:function(){return this.pop()}},{key:"free",value:function(t){t.onFree(),this.push(t)}},{key:"freeMultiple",value:function(t){for(var e=0,n=t.length;e<n;e++)this.free(t[e]);return this}}]),e}(),Mt=Phaser.Utils.Objects.GetValue,Et=new Pt,Ct=function(){d(o,bt);var i=v(o);function o(t,e){var n;return f(this,o),(n=i.call(this,t,e)).addedTimers=[],n.timers=[],n.timerPool=Mt(e,"pool",Et),n}return h(o,[{key:"shutdown",value:function(){this.isShutdown||(this.timerPool.freeMultiple(this.addedTimers).freeMultiple(this.timers),this.timerPool=void 0,this.addedTimers=void 0,this.timers=void 0,c(l(o.prototype),"shutdown",this).call(this))}},{key:"addTimer",value:function(t){var e=this.timerPool.allocate();return e?e.setTimeline(this).reset(t):e=new St(this,t),this.addedTimers.push(e),e.runCallback(e.onStart),this.isRunning||this.start(),e}},{key:"delayCall",value:function(t,i,s,r){return this.addTimer({duration:t,onComplete:function(t,e,n){void 0===s&&(s=[]),s.push(n),i.apply(r,s)}})}},{key:"getTimers",value:function(t){for(var e=[],n=[this.addedTimers,this.timers],i=0,s=n.length;i<s;i++)for(var r=n[i],a=0,o=r.length;a<o;a++){var u=r[a];u.name===t&&e.push(u)}return e}},{key:"update",value:function(t,e){var n;c(l(o.prototype),"update",this).call(this,t,e),(n=this.timers).push.apply(n,E(this.addedTimers));for(var i=[],s=this.addedTimers.length=0,r=this.timers.length;s<r;s++){var a=this.timers[s];a.update(this.now,this.delta)?this.timerPool.free(a):i.push(a)}this.timers=i,0===this.timers.length&&0===this.addedTimers.length&&this.complete()}}]),o}(),Rt=function(){d(e,kt);var t=v(e);function e(){return f(this,e),t.apply(this,arguments)}return h(e,[{key:"startTicking",value:function(){c(l(e.prototype),"startTicking",this).call(this),this.scene.sys.events.on("update",this.update,this)}},{key:"stopTicking",value:function(){c(l(e.prototype),"stopTicking",this).call(this),this.scene&&this.scene.sys.events.off("update",this.update,this)}}]),e}(),Ft=Phaser.Utils.Objects.GetValue,jt=Phaser.Math.Clamp,_t=function(){function e(t){f(this,e),this.resetFromJSON(t)}return h(e,[{key:"resetFromJSON",value:function(t){this.state=Ft(t,"state",Lt),this.timeScale=Ft(t,"timeScale",1),this.delay=Ft(t,"delay",0),this.repeat=Ft(t,"repeat",0),this.repeatCounter=Ft(t,"repeatCounter",0),this.duration=Ft(t,"duration",0),this.nowTime=Ft(t,"nowTime",0),this.justRestart=Ft(t,"justRestart",!1)}},{key:"toJSON",value:function(){return{state:this.state,timeScale:this.timeScale,delay:this.delay,repeat:this.repeat,repeatCounter:this.repeatCounter,duration:this.duration,nowTime:this.nowTime,justRestart:this.justRestart}}},{key:"destroy",value:function(){}},{key:"setTimeScale",value:function(t){return this.timeScale=t,this}},{key:"setDelay",value:function(t){return void 0===t&&(t=0),this.delay=t,this}},{key:"setDuration",value:function(t){return this.duration=t,this}},{key:"setRepeat",value:function(t){return this.repeat=t,this}},{key:"setRepeatInfinity",value:function(){return this.repeat=-1,this}},{key:"start",value:function(){return this.nowTime=0<this.delay?-this.delay:0,this.state=0<=this.nowTime?At:Gt,this.repeatCounter=0,this}},{key:"stop",value:function(){return this.state=Lt,this}},{key:"update",value:function(t,e){this.state!==Lt&&this.state!==Bt&&0!==e&&0!==this.timeScale&&(this.nowTime+=e*this.timeScale,this.state=0<=this.nowTime?At:Gt,this.justRestart=!1,this.nowTime>=this.duration&&(-1===this.repeat||this.repeatCounter<this.repeat?(this.repeatCounter++,this.justRestart=!0,this.nowTime-=this.duration):(this.nowTime=this.duration,this.state=Bt)))}},{key:"t",get:function(){var t;switch(this.state){case Lt:case Gt:t=0;break;case At:t=this.nowTime/this.duration;break;case Bt:t=1}return jt(t,0,1)},set:function(t){(t=jt(t,-1,1))<0?(this.state=Gt,this.nowTime=-this.delay*t):(this.state=At,this.nowTime=this.duration*t,1===t&&0!==this.repeat&&this.repeatCounter++)}},{key:"setT",value:function(t){return this.t=t,this}},{key:"isIdle",get:function(){return this.state===Lt}},{key:"isDelay",get:function(){return this.state===Gt}},{key:"isCountDown",get:function(){return this.state===At}},{key:"isRunning",get:function(){return this.state===Gt||this.state===At}},{key:"isDone",get:function(){return this.state===Bt}},{key:"isOddIteration",get:function(){return 1==(1&this.repeatCounter)}},{key:"isEvenIteration",get:function(){return 0==(1&this.repeatCounter)}}]),e}(),Lt=0,Gt=1,At=2,Bt=-1,zt=function(){d(s,Rt);var i=v(s);function s(t,e){var n;return f(this,s),(n=i.call(this,t,e)).timer=new _t,n}return h(s,[{key:"shutdown",value:function(t){this.isShutdown||(c(l(s.prototype),"shutdown",this).call(this,t),this.timer.destroy(),this.timer=void 0)}},{key:"start",value:function(){return this.timer.start(),c(l(s.prototype),"start",this).call(this),this}},{key:"stop",value:function(){return this.timer.stop(),c(l(s.prototype),"stop",this).call(this),this}},{key:"complete",value:function(){return this.timer.stop(),c(l(s.prototype),"complete",this).call(this),this}}]),s}(),It=Phaser.Utils.Objects.GetValue,Vt=Phaser.Utils.Objects.GetAdvancedValue,Wt=Phaser.Tweens.Builders.GetEaseFunction,Ut=function(){d(e,zt);var t=v(e);function e(){return f(this,e),t.apply(this,arguments)}return h(e,[{key:"resetFromJSON",value:function(t){return this.timer.resetFromJSON(It(t,"timer")),this.setEnable(It(t,"enable",!0)),this.setTarget(It(t,"target",this.parent)),this.setDelay(Vt(t,"delay",0)),this.setDuration(Vt(t,"duration",1e3)),this.setEase(It(t,"ease","Linear")),this.setRepeat(It(t,"repeat",0)),this}},{key:"setEnable",value:function(t){return null==t&&(t=!0),this.enable=t,this}},{key:"setTarget",value:function(t){return void 0===t&&(t=this.parent),this.target=t,this}},{key:"setDelay",value:function(t){return this.delay=t,this}},{key:"setDuration",value:function(t){return this.duration=t,this}},{key:"setEase",value:function(t){return void 0===t&&(t="Linear"),this.ease=t,this.easeFn=Wt(t),this}},{key:"setRepeat",value:function(t){return this.repeat=t,this}},{key:"start",value:function(){return this.timer.isRunning||c(l(e.prototype),"start",this).call(this),this}},{key:"restart",value:function(){return this.timer.stop(),this.start.apply(this,arguments),this}},{key:"stop",value:function(t){return void 0===t&&(t=!1),c(l(e.prototype),"stop",this).call(this),t&&(this.timer.setT(1),this.updateGameObject(this.target,this.timer),this.complete()),this}},{key:"update",value:function(t,e){if(!this.isRunning||!this.enable||!this.parent.active)return this;var n=this.target,i=this.timer;return i.update(t,e),i.isDelay||this.updateGameObject(n,i),this.emit("update",n,this),i.isDone&&this.complete(),this}},{key:"updateGameObject",value:function(){}}]),e}(),Dt=Phaser.Utils.Objects.GetValue,Ht=Phaser.Utils.Objects.GetAdvancedValue,Xt=Phaser.Math.Linear,Yt=function(){d(r,Ut);var s=v(r);function r(t,e,n){var i;return f(this,r),e.scene=t,e.active=!0,(i=s.call(this,e,n)).volume={},i.resetFromJSON(n),i}return h(r,[{key:"resetFromJSON",value:function(t){return c(l(r.prototype),"resetFromJSON",this).call(this,t),this.setMode(Dt(t,"mode",0)),this.setEnable(Dt(t,"enable",!0)),this.setVolumeRange(Ht(t,"volume.start",this.parent.volume),Ht(t,"volume.end",0)),this}},{key:"setMode",value:function(t){return"string"==typeof t&&(t=Nt[t]),this.mode=t,this}},{key:"setVolumeRange",value:function(t,e){return this.volume.start=t,this.volume.end=e,this}},{key:"start",value:function(){return this.timer.isRunning||(this.parent.setVolume(this.volume.start),this.timer.setDelay(this.delay).setDuration(this.duration),c(l(r.prototype),"start",this).call(this)),this}},{key:"updateGameObject",value:function(t,e){t.volume=Xt(this.volume.start,this.volume.end,e.t)}},{key:"complete",value:function(){switch(c(l(r.prototype),"complete",this).call(this),this.mode){case 1:this.parent.stop();break;case 2:this.parent.destroy()}return this}}]),r}(),Nt={stop:1,destroy:2},Jt=Phaser.Utils.Objects.GetValue,Kt=Phaser.Utils.Array.Remove,$t=function(){function i(t,e){f(this,i),this.scene=t,this.soundEffects=[],this.backgroundMusic=void 0,this.setBackgroundMusicLoopValue(Jt(e,"bgm.loop",!0)),this.setBackgroundMusicFadeTime(Jt(e,"bgm.fade",500));var n=Jt(e,"bgm.initial",void 0);n&&this.setCurrentBackgroundMusic(n)}return h(i,[{key:"destroy",value:function(t){if(this.soundEffects.length&&!t)for(var e=this.soundEffects.length-1;0<=e;e--)this.soundEffects[e].destroy();this.soundEffects.length=0,this.backgroundMusic&&!t&&this.backgroundMusic.destroy(),this.backgroundMusic=void 0,this.scene=void 0}},{key:"setBackgroundMusicLoopValue",value:function(t){return this.backgroundMusicLoopValue=t,this}},{key:"setBackgroundMusicFadeTime",value:function(t){return this.backgroundMusicFadeTime=t,this}},{key:"getSoundEffects",value:function(){return this.soundEffects}},{key:"getLastSoundEffect",value:function(){return this.soundEffects[this.soundEffects.length-1]}},{key:"getBackgroundMusic",value:function(){return this.backgroundMusic}},{key:"playSoundEffect",value:function(t){var e=this.scene.sys.sound.add(t);return this.soundEffects.push(e),e.once("complete",function(){e.destroy(),this.scene&&Kt(this.soundEffects,e)},this).once("destroy",function(){this.scene&&Kt(this.soundEffects,e)},this).play(),this}},{key:"setSoundEffectVolume",value:function(t){var e=this.getLastSoundEffect();return e&&e.setVolume(t),this}},{key:"fadeInSoundEffect",value:function(t){var e=this.getLastSoundEffect();return e&&ct(this.scene,e,t),this}},{key:"fadeOutSoundEffect",value:function(t,e){var n=this.getLastSoundEffect();return n&&ft(this.scene,n,t,e),this}},{key:"fadeOutAllSoundEffects",value:function(t,e){for(var n=this.soundEffects.length-1;0<=n;n--)ft(this.scene,this.soundEffects[n],t,e);return this}},{key:"setCurrentBackgroundMusic",value:function(t){(this.backgroundMusic=t)&&(t.setLoop(this.backgroundMusicLoopValue),t.once("complete",function(){this.backgroundMusic.destroy(),this.backgroundMusic=void 0},this).once("destroy",function(){this.backgroundMusic=void 0},this),t.isPlaying||t.play())}},{key:"playBackgroundMusic",value:function(t){return this.backgroundMusic&&this.backgroundMusic.key===t||(this.stopBackgroundMusic(),this.setCurrentBackgroundMusic(this.scene.sys.sound.add(t)),0<this.backgroundMusicFadeTime&&this.fadeInBackgroundMusic(this.backgroundMusicFadeTime)),this}},{key:"pauseBackgroundMusic",value:function(){return this.backgroundMusic&&this.backgroundMusic.pause(),this}},{key:"resumeBackgroundMusic",value:function(){return this.backgroundMusic&&this.backgroundMusic.resume(),this}},{key:"stopBackgroundMusic",value:function(){return this.backgroundMusic&&(0<this.backgroundMusicFadeTime?this.fadeOutBackgroundMusic(this.backgroundMusicFadeTime,!0):(this.backgroundMusic.stop(),this.backgroundMusic.destroy(),this.backgroundMusic=void 0)),this}},{key:"fadeInBackgroundMusic",value:function(t){return this.backgroundMusic&&ct(this.scene,this.backgroundMusic,t),this}},{key:"fadeOutBackgroundMusic",value:function(t,e){return this.backgroundMusic&&ft(this.scene,this.backgroundMusic,t,e),this}},{key:"crossFadeBackgroundMusic",value:function(t,e){var n=this.backgroundMusicFadeTime;return this.backgroundMusicFadeTime=0,this.fadeOutBackgroundMusic(e,!0).playBackgroundMusic(t).fadeInBackgroundMusic(e),this.backgroundMusicFadeTime=n,this}}]),i}(),qt=function(){function i(t,e,n){f(this,i),this.GOManager=t,this.gameObject=e.setName(n),this.tweens={},this.name=n}return h(i,[{key:"scene",get:function(){return this.GOManager.scene}},{key:"timeScale",get:function(){return this.GOManager.timeScale}},{key:"destroy",value:function(){this.freeGO().freeTweens(),this.GOManager=void 0}},{key:"freeGO",value:function(){return this.gameObject.destroy(),this.gameObject=void 0,this}},{key:"freeTweens",value:function(){var t=this.tweens;for(var e in t)t[e].remove(),delete t[e];return this}},{key:"setProperty",value:function(t,e){return this.gameObject[t]=e,this}},{key:"easeProperty",value:function(t,e,n,i,s,r,a){var o=this.tweens;o.hasOwnProperty(t)&&o[t].remove();var u=this.gameObject,h={targets:u,duration:n,ease:i,repeat:s,yoyo:r,onComplete:function(){o[t].remove(),delete o[t],a&&a(u,t)},onCompleteScope:this};h[t]=e;var l=this.scene.tweens.add(h);return l.timeScale=this.timeScale,o[t]=l,this}},{key:"setTimeScale",value:function(t){var e=this.tweens;for(var n in e)e[n].timeScale=t;return this}}]),i}(),Zt=Phaser.Events.EventEmitter,Qt=function(t,e,n,i){t.x=e.x+e.width*n,t.y=e.y+e.height*i},te=Phaser.Utils.Array.Remove,ee={has:function(t){return this.bobs.hasOwnProperty(t)},get:function(t){return this.bobs[t]},getGO:function(t){return this.get(t).gameObject},add:function(t){this.remove(t);for(var e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];var s=this.createGameObjectCallback.apply(this,[this.scene].concat(n));0<this.fadeTime&&function(e,n){if(e.hasOwnProperty("tintR"))return;void 0===n&&(n=16777215);var i=dt(n),s=pt(n),r=vt(n);Object.defineProperty(e,"tint",{get:function(){return n},set:function(t){t=16777215&Math.floor(t),e.setTint(t),n!==t&&(i=dt(n=t),s=pt(n),r=vt(n))}}),Object.defineProperty(e,"tintR",{get:function(){return i},set:function(t){t=255&Math.floor(t),i!==t&&(i=t,e.tint=(255&t)<<16|65535&n)}}),Object.defineProperty(e,"tintG",{get:function(){return s},set:function(t){t=255&Math.floor(t),s!==t&&(s=t,e.tint=(255&t)<<8|16711935&n)}}),Object.defineProperty(e,"tintB",{get:function(){return r},set:function(t){t=255&Math.floor(t),r!==t&&(r=t,e.tint=255&t|16776960&n)}}),Object.defineProperty(e,"tintGray",{get:function(){return Math.floor((i+s+r)/3)},set:function(t){t=255&Math.floor(t),i===t&&s===t&&r===t||(r=s=i=t,e.tint=(255&t)<<16|(255&t)<<8|255&t)}}),e.tint=n}(s),this.viewportCoordinateEnable&&gt(s),s.once("destroy",function(){te(this.removedGOs,s),this.isEmpty&&this.emit("empty")},this);var r=new this.BobClass(this,s,t);return this.bobs[t]=r,0<this.fadeTime&&r.setProperty("tintGray",0).easeProperty("tintGray",255,this.fadeTime),this}},ne={remove:function(t){if(!this.has(t))return this;var e=this.get(t);return delete this.bobs[t],this.removedGOs.push(e.gameObject),0<this.fadeTime?e.easeProperty("tintGray",0,this.fadeTime,"Linear",0,!1,function(){e.destroy()}):e.destroy(),this},removeAll:function(){var t=this.bobs;for(var e in t)this.remove(e);return this},clear:function(t){void 0===t&&(t=!0);var e=this.bobs;for(var n in e)t&&e[n].destroy(),delete e[n];return this.removedGOs.length=0,this}},ie={setProperty:function(t,e,n){return this.has(t)&&this.get(t).setProperty(e,n),this},easeProperty:function(t,e,n,i,s,r,a,o){return this.has(t)&&(void 0===i&&(i=1e3),void 0===s&&(s="Linear"),void 0===r&&(r=0),void 0===a&&(a=!1),this.get(t).easeProperty(e,n,i,s,r,a,o)),this},getTweenTask:function(t,e){if(this.has(t)){var n=this.get(t).tweens;if(n.hasOwnProperty(e))return n[e]}return null}},se={};Object.assign(se,ee,ne,ie);var re=Phaser.Utils.Objects.GetValue,ae=function(){function n(t,e){f(this,n),this.scene=t,this.BobClass=re(e,"BobClass",qt),this.setCreateGameObjectCallback(re(e,"createGameObject")),this.setEventEmitter(re(e,"eventEmitter",void 0)),this.setGOFadeTime(re(e,"fade",500)),this.setViewportCoordinateEnable(re(e,"viewportCoordinate",!1)),this.bobs={},this.removedGOs=[],this._timeScale=1}return h(n,[{key:"destroy",value:function(t){this.clear(!t),this.createGameObjectCallback=void 0,this.scene=void 0}},{key:"timeScale",get:function(){return this._timeScale},set:function(t){if(this._timeScale!==t){this._timeScale=t;var e=this.bobs;for(var n in e)e[n].setTimeScale(t)}}},{key:"setTimeScale",value:function(t){return this.timeScale=t,this}},{key:"setCreateGameObjectCallback",value:function(t){return this.createGameObjectCallback=t||function(t,e,n){return t.add.sprite(0,0,e,n)},this}},{key:"setGOFadeTime",value:function(t){return this.fadeTime=t,this}},{key:"setViewportCoordinateEnable",value:function(t){return void 0===t&&(t=!0),this.viewportCoordinateEnable=t,this}},{key:"isEmpty",get:function(){return function(t){for(var e in t)return!1;return!0}(this.bobs)&&0===this.removedGOs.length}}]),n}();Object.assign(ae.prototype,t,se);var oe=function(){d(e,qt);var t=v(e);function e(){return f(this,e),t.apply(this,arguments)}return h(e,[{key:"setTexture",value:function(t,e){return this.gameObject.setTexture(t,e),this}},{key:"playAnimation",value:function(t){return this.gameObject.anims.timeScale=this.timeScale,this.gameObject.play(t),this}},{key:"stopAnimation",value:function(){return this.gameObject.stop(),this}},{key:"chainAnimation",value:function(t){return this.gameObject.chain(t),this}},{key:"pauseAnimation",value:function(){return this.gameObject.anims.pause(),this}},{key:"setTimeScale",value:function(t){return c(l(e.prototype),"setTimeScale",this).call(this,t),this.gameObject.anims&&(this.gameObject.anims.timeScale=t),this}}]),e}(),ue={};Object.assign(ue,{playAnimation:function(t,e){return this.has(t)||this.add(t),this.get(t).playAnimation(e),this},stopAnimation:function(t){return this.has(t)&&this.get(t).stopAnimation(),this},chainAnimation:function(t,e){return this.has(t)&&this.get(t).chainAnimation(e),this},pauseAnimation:function(t){return this.has(t)&&this.get(t).pauseAnimation(),this},setTexture:function(t,e,n){return this.has(t)&&this.get(t).setTexture(e,n),this}});var he=function(){d(i,ae);var n=v(i);function i(t,e){return f(this,i),void 0===e&&(e={}),e.BobClass=oe,n.call(this,t,e)}return h(i,[{key:"setCreateGameObjectCallback",value:function(t){return this.createGameObjectCallback=t&&"sprite"!==t?"image"===t?function(t,e,n){return t.add.image(0,0,e,n)}:t:function(t,e,n){return t.add.sprite(0,0,e,n)},this}}]),i}();Object.assign(he.prototype,ue);function le(t){var e=we.create(this),n=e.getContext("2d");t.syncFont(e,n);var i=n.measureText(t.testString);if("actualBoundingBoxAscent"in i){var s=i.actualBoundingBoxAscent,r=i.actualBoundingBoxDescent,a={ascent:s,descent:r,fontSize:s+r};return we.remove(e),a}var o=Math.ceil(i.width*t.baselineX),u=o,h=2*u;if(u=u*t.baselineY|0,e.width=o,e.height=h,n.fillStyle="#f00",n.fillRect(0,0,o,h),n.font=t._font,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(t.testString,0,u),a={ascent:0,descent:0,fontSize:0},!n.getImageData(0,0,o,h))return a.ascent=u,a.descent=u+6,a.fontSize=a.ascent+a.descent,we.remove(e),a;var l,c,f=n.getImageData(0,0,o,h).data,d=f.length,p=4*o,v=0,g=!1;for(l=0;l<u;l++){for(c=0;c<p;c+=4)if(255!==f[v+c]){g=!0;break}if(g)break;v+=p}for(a.ascent=u-l,v=d-p,g=!1,l=h;u<l;l--){for(c=0;c<p;c+=4)if(255!==f[v+c]){g=!0;break}if(g)break;v-=p}return a.descent=l-u,a.fontSize=a.ascent+a.descent,we.remove(e),a}function ce(t,e,n){if(null==t)return t;switch(o(t)){case"string":return t;case"number":return"#".concat(Ee(Math.floor(t).toString(16),6,"0",1));case"function":return t(e,n);case"object":return t.hasOwnProperty("r")?t.hasOwnProperty("a")?"rgba(".concat(t.r,",").concat(t.g,",").concat(t.b,",").concat(t.a,")"):"rgb(".concat(t.r,",").concat(t.g,",").concat(t.b,")"):t.hasOwnProperty("h")?t.hasOwnProperty("a")?"hsla(".concat(t.h,",").concat(t.s,",").concat(t.l,",").concat(t.a,")"):"hsl(".concat(t.h,",").concat(t.s,",").concat(t.l,")"):t;default:return t}}function fe(t,e,n,i,s,r,a,o,u,h,l,c,f){var d,p,v,g,y,k,m,w,x,b,T,S,O,P,M,E,C;if(d=e,k=f,S=new Ae(p=n,v=i,g=s,y=r,a),O=S.minWidth,P=S.minHeight,M=O<=g?1:g/O,E=P<=y?1:y/P,C=S.cornerRadius,d.save(),d.beginPath(),d.translate(p,v),b=g-(w=(m=C.br).x*M),T=y-(x=m.y*E),d.moveTo(g,T),0<w&&0<x?He(d,b,T,w,x,Ve,We,k):(d.lineTo(g,y),d.lineTo(b,y)),b=w=(m=C.bl).x*M,T=y-(x=m.y*E),d.lineTo(w,y),0<w&&0<x?He(d,b,T,w,x,We,Ue,k):(d.lineTo(0,y),d.lineTo(0,T)),b=w=(m=C.tl).x*M,T=x=m.y*E,d.lineTo(0,T),0<w&&0<x?He(d,b,T,w,x,Ue,De,k):(d.lineTo(0,0),d.lineTo(b,0)),b=g-(w=(m=C.tr).x*M),T=x=m.y*E,d.lineTo(b,0),0<w&&0<x?He(d,b,T,w,x,De,Ve,k):(d.lineTo(g,0),d.lineTo(g,T)),d.closePath(),d.restore(),null!=o){var R;if(null!=l)(R=c?e.createLinearGradient(0,0,s,0):e.createLinearGradient(0,0,0,r)).addColorStop(0,o),R.addColorStop(1,l),o=R;e.fillStyle=o,e.fill()}null!=u&&0<h&&(e.strokeStyle=u,e.lineWidth=h,e.stroke())}function de(t,e){var n=Array.isArray(t);if(void 0===e?e=n?[]:{}:function(t){if("object"!==o(t)||null===t)return;if(Array.isArray(t))t.length=0;else for(var e in t)delete t[e]}(e),n){e.length=t.length;for(var i=0,s=t.length;i<s;i++)e[i]=t[i]}else for(var r in t)e[r]=t[r];return e}function pe(){}function ve(t,e,n){var i=cn.pop();return null===i&&(i={}),i.text=t,i.width=e,i.newLineMode=n,i}function ge(t,e,n,i,s){i<=0&&(n=vn);var r=[];if(!t||!t.length)return r;for(var a,o,u,h,l=n===vn,c=n===gn,f=t.split(kn),d=0,p=f.length;d<p;d++)if(a=f[d],u=d===p-1?fn:dn,l){var v=e(a);r.push(ve(a,v,u))}else{var g,y,k,m,w;if(o=0===d?i-s:i,a.length<=100)if((v=e(a))<=o){r.push(ve(a,v,u));continue}c?(y=""===(g=a.split(" "))[g.length-1])&&--g.length:g=a;for(var x,b="",T=0,S=c?e(" "):void 0,O=0,P=g.length;O<P;O++)if(m=e(k=g[O]),w=O===P-1,!c||w&&!y||(k+=" ",m+=S),c&&i<m){""!==b?r.push(ve(b,T,pn)):0===O&&0<s&&r.push(ve("",0,pn)),r.push.apply(r,E(ge(k,e,yn,i,0)));var M=r.pop();b=M.text,T=M.width,(h=M)&&cn.push(h)," "===b&&(b="",T=0)}else o<(x=T+m)?(r.push(ve(b,T,pn)),b=k,T=m,o=i):(b+=k,T=x),w&&r.push(ve(b,T,u))}return r}var ye=function(){d(e,qt);var t=v(e);function e(){return f(this,e),t.apply(this,arguments)}return h(e,[{key:"setText",value:function(t){return this.gameObject.setText(t),this}}]),e}(),ke=Phaser.Renderer.WebGL.Utils,me={renderWebGL:function(t,e,n,i){if(0!==e.width&&0!==e.height){n.addToRenderList(e);var s=e.frame,r=s.width,a=s.height,o=ke.getTintAppendFloatAlpha,u=t.pipelines.set(e.pipeline,e),h=u.setTexture2D(s.glTexture,e);t.pipelines.preBatch(e),u.batchTexture(e,s.glTexture,r,a,e.x,e.y,r/e.style.resolution,a/e.style.resolution,e.scaleX,e.scaleY,e.rotation,e.flipX,e.flipY,e.scrollFactorX,e.scrollFactorY,e.displayOriginX,e.displayOriginY,0,0,r,a,o(e.tintTopLeft,n.alpha*e._alphaTL),o(e.tintTopRight,n.alpha*e._alphaTR),o(e.tintBottomLeft,n.alpha*e._alphaBL),o(e.tintBottomRight,n.alpha*e._alphaBR),e.tintFill,0,0,n,i,!1,h),t.pipelines.postBatch(e)}},renderCanvas:function(t,e,n,i){0!==e.width&&0!==e.height&&(n.addToRenderList(e),t.batchSprite(e,e.frame,n,i))}},we=Phaser.Display.Canvas.CanvasPool,xe=0,be=1,Te=2,Se=0,Oe=1,Pe=2,Me=/(?:\r\n|\r|\n)/,Ee=Phaser.Utils.String.Pad,Ce=Phaser.Utils.Objects.GetAdvancedValue,Re=Phaser.Utils.Objects.GetValue,Fe={backgroundColor:["backgroundColor",null,ce],backgroundColor2:["backgroundColor2",null,ce],backgroundHorizontalGradient:["backgroundHorizontalGradient",!0,null],backgroundStrokeColor:["backgroundStrokeColor",null,ce],backgroundStrokeLineWidth:["backgroundStrokeLineWidth",2,null],backgroundCornerRadius:["backgroundCornerRadius",0,null],backgroundCornerIteration:["backgroundCornerIteration",null,null],fontFamily:["fontFamily","Courier",null],fontSize:["fontSize","16px",null],fontStyle:["fontStyle","",null],color:["color","#fff",ce],stroke:["stroke","#fff",ce],strokeThickness:["strokeThickness",0,null],shadowOffsetX:["shadow.offsetX",0,null],shadowOffsetY:["shadow.offsetY",0,null],shadowColor:["shadow.color","#000",ce],shadowBlur:["shadow.blur",0,null],shadowStroke:["shadow.stroke",!1,null],shadowFill:["shadow.fill",!1,null],underlineColor:["underline.color","#000",ce],underlineThickness:["underline.thickness",0,null],underlineOffset:["underline.offset",0,null],halign:["halign","left",null],valign:["valign","top",null],maxLines:["maxLines",0,null],fixedWidth:["fixedWidth",0,null],fixedHeight:["fixedHeight",0,null],resolution:["resolution",0,null],lineSpacing:["lineSpacing",0,null],xOffset:["xOffset",0,null],rtl:["rtl",!1,null],testString:["testString","|MÃ‰qgy",null],baselineX:["baselineX",1.2,null],baselineY:["baselineY",1.4,null],wrapMode:["wrap.mode",0,null],wrapWidth:["wrap.width",0,null],wrapCallback:["wrap.callback",null],wrapCallbackScope:["wrap.callbackScope",null]},je=function(){function n(t,e){f(this,n),this.parent=t,this.backgroundColor,this.backgroundColor2,this.backgroundHorizontalGradient,this.backgroundStrokeColor,this.backgroundStrokeLineWidth,this.backgroundCornerRadius,this.backgroundCornerIteration,this.fontFamily,this.fontSize,this.fontStyle,this.color,this.stroke,this.strokeThickness,this.shadowOffsetX,this.shadowOffsetY,this.shadowColor,this.shadowBlur,this.shadowStroke,this.shadowFill,this.underlineColor,this.underlineThickness,this.underlineOffset,this.halign,this.valign,this.maxLines,this.fixedWidth,this.fixedHeight,this.resolution,this.lineSpacing,this.xOffset,this.rtl,this.testString,this.baselineX,this.baselineY,this.wrapMode,this.wrapWidth,this.wrapCallback,this.wrapCallbackScope,this._font,this.setStyle(e,!1,!0)}return h(n,[{key:"canvas",get:function(){return this.parent.canvasText.canvas}},{key:"context",get:function(){return this.parent.canvasText.context}},{key:"isWrapFitMode",get:function(){return 0<this.fixedWidth&&this.wrapMode!==Se&&0===this.wrapWidth}},{key:"setStyle",value:function(t,e,n){if(void 0===e&&(e=!0),void 0===n&&(n=!1),t&&t.hasOwnProperty("wrap")){var i=t.wrap;if(i.hasOwnProperty("mode")){var s=i.mode;"string"==typeof s&&(i.mode=_e[s])}else i.hasOwnProperty("width")&&(i.mode=1)}for(var r in t&&t.rtl&&n&&!t.hasOwnProperty("halign")&&(t.halign="right"),t&&t.hasOwnProperty("fontSize")&&"number"==typeof t.fontSize&&(t.fontSize=t.fontSize.toString()+"px"),Fe){var a=Fe[r],o=a[0],u=n?a[1]:this[r],h=a[2];if("wrapCallback"===r||"wrapCallbackScope"===r)this[r]=Re(t,o,u);else{var l=Ce(t,o,u);h&&(l=h(l)),this[r]=l}}var c=Re(t,"font",null);this._font=null===c?this.fontStyle+" "+this.fontSize+" "+this.fontFamily:c;var f=Re(t,"fill",null);null!==f&&(this.color=ce(f));var d=Re(t,"images",void 0);d&&this.parent.addImage(d);var p=Re(t,"metrics",!1);return p?this.metrics={ascent:Re(p,"ascent",0),descent:Re(p,"descent",0),fontSize:Re(p,"fontSize",0)}:!e&&this.metrics||(this.metrics=le(this)),e?this.parent.updateText():this.parent}},{key:"syncFont",value:function(t,e){e.font=this._font}},{key:"syncStyle",value:function(t,e){e.textBaseline="alphabetic",e.fillStyle=this.color,e.strokeStyle=this.stroke,e.lineWidth=this.strokeThickness,e.lineCap="round",e.lineJoin="round"}},{key:"syncShadow",value:function(t,e){e?(t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor=0,t.shadowBlur=0)}},{key:"update",value:function(t){return t&&(this._font="".concat(this.fontStyle," ").concat(this.fontSize," ").concat(this.fontFamily).trim(),this.metrics=le(this)),this.parent.updateText(t)}},{key:"buildFont",value:function(){var t="".concat(this.fontStyle," ").concat(this.fontSize," ").concat(this.fontFamily).trim();return t!==this._font&&(this._font=t),this}},{key:"setFont",value:function(t){return"string"==typeof t?(this.fontFamily=t,this.fontSize="",this.fontStyle=""):(this.fontFamily=Re(t,"fontFamily","Courier"),this.fontSize=Re(t,"fontSize","16px"),this.fontStyle=Re(t,"fontStyle","")),this.update(!0)}},{key:"setFontFamily",value:function(t){return this.fontFamily=t,this.update(!0)}},{key:"setFontStyle",value:function(t){return this.fontStyle=t,this.update(!0)}},{key:"setFontSize",value:function(t){return"number"==typeof t&&(t=t.toString()+"px"),this.fontSize=t,this.update(!0)}},{key:"setTestString",value:function(t){return this.testString=t,this.update(!0)}},{key:"setFixedSize",value:function(t,e){return this.fixedWidth=t,this.fixedHeight=e,t&&(this.parent.width=t),e&&(this.parent.height=e),this.update(this.isWrapFitMode)}},{key:"setResolution",value:function(t){return this.resolution=t,this.update(!1)}},{key:"setLineSpacing",value:function(t){return this.lineSpacing=t,this.update(!1)}},{key:"setXOffset",value:function(t){return this.xOffset=t,this.update(!1)}},{key:"setBackgroundColor",value:function(t,e,n){return void 0===n&&(n=!0),this.backgroundColor=ce(t,this.canvas,this.context),this.backgroundColor2=ce(e,this.canvas,this.context),this.backgroundHorizontalGradient=n,this.update(!1)}},{key:"setBackgroundStrokeColor",value:function(t,e){return this.backgroundStrokeColor=ce(t,this.canvas,this.context),this.backgroundStrokeLineWidth=e,this.update(!1)}},{key:"setBackgroundCornerRadius",value:function(t,e){return this.backgroundCornerRadius=t,this.backgroundCornerIteration=e,this.update(!1)}},{key:"setFill",value:function(t){return this.color=ce(t,this.canvas,this.context),this.update(!1)}},{key:"setColor",value:function(t){return this.color=ce(t,this.canvas,this.context),this.update(!1)}},{key:"setStroke",value:function(t,e){return void 0===t?this.strokeThickness=0:(void 0===e&&(e=this.strokeThickness),this.stroke=ce(t,this.canvas,this.context),this.strokeThickness=e),this.update(!0)}},{key:"setShadow",value:function(t,e,n,i,s,r){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n="#000"),void 0===i&&(i=0),void 0===s&&(s=!1),void 0===r&&(r=!0),this.shadowOffsetX=t,this.shadowOffsetY=e,this.shadowColor=ce(n,this.canvas,this.context),this.shadowBlur=i,this.shadowStroke=s,this.shadowFill=r,this.update(!1)}},{key:"setShadowOffset",value:function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.shadowOffsetX=t,this.shadowOffsetY=e,this.update(!1)}},{key:"setShadowColor",value:function(t){return void 0===t&&(t="#000"),this.shadowColor=ce(t,this.canvas,this.context),this.update(!1)}},{key:"setShadowBlur",value:function(t){return void 0===t&&(t=0),this.shadowBlur=t,this.update(!1)}},{key:"setShadowStroke",value:function(t){return this.shadowStroke=t,this.update(!1)}},{key:"setShadowFill",value:function(t){return this.shadowFill=t,this.update(!1)}},{key:"setUnderline",value:function(t,e,n){return void 0===t&&(t="#000"),void 0===e&&(e=0),void 0===n&&(n=0),this.underlineColor=ce(t,this.canvas,this.context),this.underlineThickness=e,this.underlineOffset=n,this.update(!1)}},{key:"setUnderlineColor",value:function(t){return void 0===t&&(t="#000"),this.underlineColor=ce(t,this.canvas,this.context),this.update(!1)}},{key:"setUnderlineThickness",value:function(t){return void 0===t&&(t=0),this.underlineThickness=t,this.update(!1)}},{key:"setUnderlineOffset",value:function(t){return void 0===t&&(t=0),this.underlineOffset=t,this.update(!1)}},{key:"setWrapMode",value:function(t){return"string"==typeof t&&(t=_e[t.toLowerCase()]||0),this.wrapMode=t,this.update(!0)}},{key:"setWrapWidth",value:function(t){return this.wrapWidth=t,this.update(!1)}},{key:"setAlign",value:function(t,e){return void 0===t&&(t="left"),void 0===e&&(e="top"),this.halign=t,this.valign=e,this.update(!1)}},{key:"setHAlign",value:function(t){return void 0===t&&(t="left"),this.halign=t,this.update(!1)}},{key:"setVAlign",value:function(t){return void 0===t&&(t="top"),this.valign=t,this.update(!1)}},{key:"setMaxLines",value:function(t){return void 0===t&&(t=0),this.maxLines=t,this.update(!1)}},{key:"getTextMetrics",value:function(){var t=this.metrics;return{ascent:t.ascent,descent:t.descent,fontSize:t.fontSize}}},{key:"setTextMetrics",value:function(t,e){return this.metrics.ascent=t.ascent,this.metrics.descent=t.descent,this.metrics.fontSize=t.fontSize,e&&("string"==typeof e?(this.fontFamily=e,this.fontSize="",this.fontStyle=""):(this.fontFamily=Re(e,"fontFamily",this.fontFamily),this.fontSize=Re(e,"fontSize",this.fontSize),this.fontStyle=Re(e,"fontStyle",this.fontStyle))),this.parent.updateText(!0)}},{key:"lineHeight",get:function(){return this.metrics.fontSize+this.strokeThickness+this.lineSpacing}},{key:"toJSON",value:function(){var t={};for(var e in Fe)t[e]=this[e];return t.metrics=this.getTextMetrics(),t}},{key:"destroy",value:function(){this.parent=void 0}}]),n}(),_e={none:Se,word:Oe,char:Pe,character:Pe},Le=Phaser.Display.Canvas.CanvasPool,Ge=Phaser.Utils.Objects.GetValue,Ae=function(){function r(t,e,n,i,s){f(this,r),this.cornerRadius={},this._width=0,this._height=0,this.setTo(t,e,n,i,s)}return h(r,[{key:"setTo",value:function(t,e,n,i,s){return this.setPosition(t,e),this.setRadius(s),this.setSize(n,i),this}},{key:"setPosition",value:function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e,this}},{key:"setRadius",value:function(t){return void 0===t&&(t=0),this.radius=t,this}},{key:"setSize",value:function(t,e){return this.width=t,this.height=e,this}},{key:"minWidth",get:function(){var t=this.cornerRadius;return Math.max(t.tl.x+t.tr.x,t.bl.x+t.br.x)}},{key:"minHeight",get:function(){var t=this.cornerRadius;return Math.max(t.tl.y+t.bl.y,t.tr.y+t.br.y)}},{key:"width",get:function(){return this._width},set:function(t){null==t&&(t=0),this._width=Math.max(t,this.minWidth)}},{key:"height",get:function(){return this._height},set:function(t){null==t&&(t=0),this._height=Math.max(t,this.minHeight)}},{key:"radius",get:function(){var t=this.cornerRadius;return Math.max(t.tl.x,t.tl.y,t.tr.x,t.tr.y,t.bl.x,t.bl.y,t.br.x,t.br.y)},set:function(t){var e,n;n="number"==typeof t?e=t:(e=Ge(t,"x",0),Ge(t,"y",0));var i=this.cornerRadius;i.tl=Be(Ge(t,"tl",void 0),e,n),i.tr=Be(Ge(t,"tr",void 0),e,n),i.bl=Be(Ge(t,"bl",void 0),e,n),i.br=Be(Ge(t,"br",void 0),e,n)}},{key:"radiusTL",get:function(){var t=this.cornerRadius.tl;return Math.max(t.x,t.y)},set:function(t){ze(this.cornerRadius.tl,t)}},{key:"radiusTR",get:function(){var t=this.cornerRadius.tr;return Math.max(t.x,t.y)},set:function(t){ze(this.cornerRadius.tr,t)}},{key:"radiusBL",get:function(){var t=this.cornerRadius.bl;return Math.max(t.x,t.y)},set:function(t){ze(this.cornerRadius.bl,t)}},{key:"radiusBR",get:function(){var t=this.cornerRadius.br;return Math.max(t.x,t.y)},set:function(t){ze(this.cornerRadius.br,t)}}]),r}(),Be=function(t,e,n){return void 0===t?{x:e,y:n}:"number"==typeof t?{x:t,y:t}:t},ze=function(t,e){"number"==typeof e?(t.x=e,t.y=e):(t.x=Ge(e,"x",0),t.y=Ge(e,"y",0))},Ie=Phaser.Math.DegToRad,Ve=Ie(0),We=Ie(90),Ue=Ie(180),De=Ie(270),He=function(t,e,n,i,s,r,a,o){if(null==o)t.ellipse(e,n,i,s,0,r,a);else for(var u,h,l,c=(a-r)/(o+=1),f=0;f<=o;f++)l=r+c*f,u=e+i*Math.cos(l),h=n+s*Math.sin(l),t.lineTo(u,h)},Xe={draw:function(t,e,n,i){var s=this.penManager;this.hitAreaManager.clear();var r=this.context;r.save();var a=this.defaultStyle;this.clear(),function(t,e,n,i,s,r,a,o){if(null!=e||null!=n){var u=t.canvas.width,h=t.canvas.height;null==n&&(i=0);var l=i/2;u-=i,h-=i,fe(t.canvas,t.context,l,l,u,h,s,e,n,i,r,a,o)}}(this,a.backgroundColor,a.backgroundStrokeColor,a.backgroundStrokeLineWidth,a.backgroundCornerRadius,a.backgroundColor2,a.backgroundHorizontalGradient,a.backgroundCornerIteration),t+=this.startXOffset,e+=this.startYOffset;var o,u,h,l,c,f,d=a.halign,p=a.valign,v=a.lineHeight,g=s.lines,y=g.length,k=a.maxLines;l=(h=0<k&&k<y?(u=k,"center"===p?Math.floor((y-u)/2):"bottom"===p?y-u:0):(u=y,0))+u;var m=this.rtl,w=m?this.parent.width:void 0;f="center"===p?Math.max((i-u*v)/2,0):"bottom"===p?Math.max(i-u*v-2,0):0,f+=e;for(var x=h;x<l;x++)if(0!==(o=s.getLineWidth(x))){for(var b=g[x],T=b.length,S=d,O=0;O<T;O++){var P=b[O].prop.align;if(void 0!==P){S=P;break}}c="center"===S?(n-o)/2:"right"===S?m?0:n-o:m?n-o:0,c+=t;for(O=0;O<T;O++)this.drawPen(b[O],c,f,w)}r.restore()},drawPen:function(t,e,n,i){e+=t.x,n+=t.y+(t.prop.y||0),void 0!==i&&(e=i-e);var s=this.canvas,r=this.context;r.save();var a=this.parser.propToContextStyle(this.defaultStyle,t.prop);a.buildFont(),a.syncFont(s,r),a.syncStyle(s,r),0<a.underlineThickness&&0<t.width&&this.drawUnderline(e,n,t.width,a),t.isTextPen&&this.drawText(e,n,t.text,a),t.isImagePen&&this.drawImage(e,n,t.prop.img,a),r.restore(),t.hasAreaMarker&&0<t.width&&this.hitAreaManager.add(t.prop.area,e,n-this.startYOffset,t.width,this.defaultStyle.lineHeight)},clear:function(){var t=this.canvas;this.context.clearRect(0,0,t.width,t.height)},drawUnderline:function(t,e,n,i){e+=i.underlineOffset-i.underlineThickness/2,this.autoRound&&(t=Math.round(t),e=Math.round(e));var s=this.context,r=s.lineCap;s.lineCap="butt",s.strokeStyle=i.underlineColor,s.lineWidth=i.underlineThickness,s.beginPath(),s.moveTo(t,e),s.lineTo(t+n,e),s.stroke(),s.lineCap=r},drawText:function(t,e,n,i){this.autoRound&&(t=Math.round(t),e=Math.round(e));var s=this.context;i.stroke&&"none"!==i.stroke&&0<i.strokeThickness&&(i.syncShadow(s,i.shadowStroke),s.strokeText(n,t,e)),i.color&&"none"!==i.color&&(i.syncShadow(s,i.shadowFill),s.fillText(n,t,e))},drawImage:function(t,e,n){e-=this.startYOffset,this.parent.imageManager.draw(n,this.context,t,e,this.autoRound)}},Ye=Phaser.Utils.Objects.GetValue,Ne=xe,Je=be,Ke=function(){function e(t){f(this,e),this.prop={},this.resetFromJSON(t)}return h(e,[{key:"resetFromJSON",value:function(t){this.text=Ye(t,"text",""),this.x=Ye(t,"x",0),this.y=Ye(t,"y",0),this.width=Ye(t,"width",0);var e=Ye(t,"prop",null);null===e&&(e={}),this.prop=e,this.newLineMode=Ye(t,"newLineMode",0),this.startIndex=Ye(t,"startIndex",0)}},{key:"plainText",get:function(){var t=this.text;return this.newLineMode===Je&&(t+="\n"),t}},{key:"wrapText",get:function(){var t=this.text;return this.newLineMode!==Ne&&(t+="\n"),t}},{key:"rawTextLength",get:function(){var t=this.text.length;return this.newLineMode===Je&&(t+=1),t}},{key:"endIndex",get:function(){return this.startIndex+this.rawTextLength}},{key:"lastX",get:function(){return this.x+this.width}},{key:"isTextPen",get:function(){return""!==this.text}},{key:"isImagePen",get:function(){return!!this.prop.img}},{key:"hasAreaMarker",get:function(){return!!this.prop.area}}]),e}(),$e=Phaser.Utils.Objects.GetFastValue,qe=xe,Ze=Te,Qe=new Ot,tn=new Ot,en=function(){function o(t){f(this,o),this.pens=[],this.lines=[],this.maxLinesWidth=void 0,this.PensPool=$e(t,"pensPool",Qe),this.LinesPool=$e(t,"linesPool",tn),this.tagToText=$e(t,"tagToText",pe),this.tagToTextScope=$e(t,"tagToTextScope",void 0)}return h(o,[{key:"destroy",value:function(){this.clear(),this.tagToText=void 0,this.tagToTextScope=void 0}},{key:"clear",value:function(){for(var t=0,e=this.lines.length;t<e;t++)this.lines[t].length=0;this.PensPool.pushMultiple(this.pens),this.LinesPool.pushMultiple(this.lines),this.maxLinesWidth=void 0}},{key:"addTextPen",value:function(t,e,n,i,s,r){var a=this.PensPool.pop();return null==a&&(a=new Ke),nn.text=t,nn.x=e,nn.y=n,nn.width=i,nn.prop=s,nn.newLineMode=r,a.resetFromJSON(nn),this.addPen(a),this}},{key:"addImagePen",value:function(t,e,n,i){return this.addTextPen("",t,e,n,i,qe),this}},{key:"addNewLinePen",value:function(){var t=this.lastPen,e=t?t.lastX:0,n=t?t.y:0,i=t?de(t.prop):null;return this.addTextPen("",e,n,0,i,Ze),this}},{key:"addPen",value:function(t){var e=this.lastPen;t.startIndex=null==e?0:e.endIndex,this.pens.push(t);var n=this.lastLine;null==n&&(n=this.LinesPool.pop()||[],this.lines.push(n)),n.push(t),t.newLineMode!==qe&&(n=this.LinesPool.pop()||[],this.lines.push(n)),this.maxLinesWidth=void 0}},{key:"clone",value:function(t){null==t&&(t=new o),t.clear();for(var e=0,n=this.lines.length;e<n;e++)for(var i=this.lines[e],s=0,r=i.length;s<r;s++){var a=i[s];t.addPen(a.text,a.x,a.y,a.width,de(a.prop),a.newLineMode)}return t}},{key:"lastPen",get:function(){return this.pens[this.pens.length-1]}},{key:"lastLine",get:function(){return this.lines[this.lines.length-1]}},{key:"getLineStartIndex",value:function(t){if(t>=this.lines.length)return this.getLineEndIndex(t);var e=this.lines[t];return e&&e[0]?e[0].startIndex:0}},{key:"getLineEndIndex",value:function(t){t>=this.lines.length&&(t=this.lines.length-1);var e,n,i=!1;for(e=t;0<=e&&!(i=null!=(n=this.lines[e])&&0<n.length);e--);return i?n[n.length-1].endIndex:0}},{key:"getLineWidth",value:function(t){var e=this.lines[t];if(!e)return 0;var n=e[e.length-1];return null==n?0:n.lastX}},{key:"getMaxLineWidth",value:function(){if(void 0!==this.maxLinesWidth)return this.maxLinesWidth;for(var t,e=0,n=0,i=this.lines.length;n<i;n++)e<(t=this.getLineWidth(n))&&(e=t);return this.maxLinesWidth=e}},{key:"getLineWidths",value:function(){for(var t=[],e=0,n=this.lines.length;e<n;e++)t.push(this.getLineWidth(e));return t}},{key:"linesCount",get:function(){return this.lines.length}},{key:"plainText",get:function(){for(var t="",e=this.pens,n=0,i=e.length;n<i;n++)t+=e[n].plainText;return t}},{key:"rawTextLength",get:function(){for(var t=0,e=this.pens,n=0,i=this.pens.length;n<i;n++)t+=e[n].rawTextLength;return t}},{key:"getSliceTagText",value:function(t,e,n){if(void 0===t&&(t=0),void 0===e){var i=this.lastPen;if(null==i)return"";e=i.endIndex}void 0===n&&(n=!1);for(var s,r,a,o,u,h,l="",c=0,f=this.pens.length;c<f&&((o=(s=this.pens[c]).endIndex)<=t||(s=this.pens[c],r=n?s.wrapText:s.plainText,u=s.prop,t<=(a=s.startIndex)&&o<=e||(r=r.substring(t-a,e-a)),this.tagToTextScope?l+=this.tagToText.call(this.tagToTextScope,r,u,h):l+=this.tagToText(r,u,h),h=u,!(e<=o)));c++);return l}},{key:"length",get:function(){return this.lines.length},set:function(){this.clear()}}]),o}(),nn={},sn=Phaser.Geom.Rectangle,rn=new Ot,an=function(){function t(){f(this,t),this.hitAreas=[]}return h(t,[{key:"destroy",value:function(){this.clear()}},{key:"clear",value:function(){return rn.pushMultiple(this.hitAreas),this}},{key:"add",value:function(t,e,n,i,s){var r=rn.pop();return null===r?r=new sn(e,n,i,s):r.setTo(e,n,i,s),r.key=t,this.hitAreas.push(r),this}},{key:"getFirst",value:function(t,e){for(var n=0,i=this.hitAreas.length;n<i;n++){var s=this.hitAreas[n];if(s.contains(t,e))return s}return null}},{key:"drawBounds",value:function(t,e,n){void 0===e&&(e=16777215),n&&t.save().scaleCanvas(n.scaleX,n.scaleY).rotateCanvas(n.rotation).translateCanvas(n.x,n.y);for(var i=0,s=this.hitAreas.length;i<s;i++){var r=this.hitAreas[i];t.lineStyle(1,e).strokeRect(r.x,r.y,r.width,r.height)}return n&&t.restore(),this}}]),t}(),on=function(t,e,n,i){var s=this.hitAreaManager.getFirst(e,n);null!==s&&ln.call(this,"areadown",s.key,t,e,n,i)},un=function(t,e,n,i){var s=this.hitAreaManager.getFirst(e,n);null!==s&&ln.call(this,"areaup",s.key,t,e,n,i)},hn=function(t,e,n,i){if(null===e)return null!==this.lastHitAreaKey&&ln.call(this,"areaout",this.lastHitAreaKey,t,e,n,i),void(this.lastHitAreaKey=null);var s=this.hitAreaManager.getFirst(e,n),r=s?s.key:null;this.lastHitAreaKey!==r&&(null!==this.lastHitAreaKey&&ln.call(this,"areaout",this.lastHitAreaKey,t,e,n,i),null!==r&&ln.call(this,"areaover",r,t,e,n,i),this.lastHitAreaKey=r)},ln=function(t,e,n,i,s,r){this.parent.emit("".concat(t,"-").concat(e),n,i,s,r),this.parent.emit(t,e,n,i,s,r)},cn=new Ot,fn=xe,dn=be,pn=Te,vn=Se,gn=Oe,yn=Pe,kn=Me,mn=Phaser.Utils.Objects.GetValue,wn=Se,xn=xe,bn=function(){function n(t){f(this,n),this.parent=t.parent,this.context=mn(t,"context",null),this.canvas=this.context.canvas,this.parser=mn(t,"parser",null),this.defaultStyle=mn(t,"style",null),this.autoRound=!0,this.pensPool=mn(t,"pensPool",null),this.penManager=this.newPenManager(),this._tmpPenManager=null,this.hitAreaManager=new an,this.lastHitAreaKey=null;var e=this.context;this.getTextWidth=function(t){return e.measureText(t).width}}return h(n,[{key:"destroy",value:function(){this.context=void 0,this.canvas=void 0,this.parser=void 0,this.defaultStyle=void 0,this.penManager&&(this.penManager.destroy(),this.penManager=void 0),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=void 0),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=void 0)}},{key:"updatePenManager",value:function(t,e,n,i,s){if(void 0===s&&(s=this.penManager),s.clear(),""===t)return s;var r=this.parent.style;if(r.isWrapFitMode){var a=this.parent.padding;n=r.fixedWidth-a.left-a.right}function o(t){return v.measureText(t).width}for(var u,h,l,c,f,d,p=this.canvas,v=this.context,g=0,y=0,k=r.wrapCallback,m=r.wrapCallbackScope,w=!0,x=this.parser.splitText(t),b=0,T=x.length;b<T;b++)if(u=(c=this.parser.tagTextToProp(x[b],h)).plainText,(h=c.prop).img){var S=this.imageManager.getOuterWidth(h.img);0<n&&e!==wn&&n<g+S&&(s.addNewLinePen(),y+=i,g=0),s.addImagePen(g,y,S,de(h)),g+=S}else if(""!==u){if(v.save(),(l=this.parser.propToContextStyle(this.defaultStyle,h)).buildFont(),l.syncFont(p,v),l.syncStyle(p,v),k){"string"==typeof(f=k.call(m,u,o,n,g))&&(f=f.split("\n"));for(var O=0,P=f.length;O<P;O++)"string"==typeof(M=f[O])?f[O]=ve(M,o(M),O<P-1?2:0):w=!1}else f=ge(u,o,e,n,g);var M;for(O=0,P=f.length;O<P;O++)M=f[O],s.addTextPen(M.text,g,y,M.width,de(h),M.newLineMode),M.newLineMode!==xn?(g=0,y+=i):g+=M.width;w&&(d=f)&&cn.pushMultiple(d),f=null,v.restore()}for(b=0,T=this.lines.length;b<T;b++){var E=this.lines[b],C=E[E.length-1];C&&(C.width+=this.parser.getStrokeThinkness(this.defaultStyle,C.prop))}return s}},{key:"startXOffset",get:function(){var t=this.defaultStyle;return t.strokeThickness/2+t.xOffset}},{key:"startYOffset",get:function(){var t=this.defaultStyle;return t.strokeThickness/2+t.metrics.ascent}},{key:"lines",get:function(){return this.penManager.lines}},{key:"desplayLinesCount",get:function(){var t=this.penManager.linesCount,e=this.defaultStyle.maxLines;return 0<e&&e<t&&(t=e),t}},{key:"linesWidth",get:function(){return Math.ceil(this.penManager.getMaxLineWidth())}},{key:"linesHeight",get:function(){var t=this.desplayLinesCount,e=this.defaultStyle.lineHeight*t;return 0<t&&(e-=this.defaultStyle.lineSpacing),e}},{key:"imageManager",get:function(){return this.parent.imageManager}},{key:"rtl",get:function(){return this.parent.style.rtl}},{key:"newPenManager",value:function(){return new en({pensPool:this.pensPool,tagToText:this.parser.propToTagText,tagToTextScope:this.parser})}},{key:"tmpPenManager",get:function(){return null===this._tmpPenManager&&(this._tmpPenManager=this.newPenManager()),this._tmpPenManager}},{key:"getPlainText",value:function(t,e,n){var i;if(null==t)i=this.penManager.plainText;else{var s=this.parser.splitText(t,1);i="";for(var r=0,a=s.length;r<a;r++)i+=s[r]}return null==e&&null==n||(null==e&&(e=0),null==n&&(n=i.length),i=i.substring(e,n)),i}},{key:"getPenManager",value:function(t,e){if(void 0===t)return this.copyPenManager(e,this.penManager);void 0===e&&(e=this.newPenManager());var n=this.defaultStyle;return this.updatePenManager(t,n.wrapMode,n.wrapWidth,n.lineHeight,e),e}},{key:"getText",value:function(t,e,n,i){if(null==t)return this.penManager.getSliceTagText(e,n,i);var s=this.tmpPenManager,r=this.defaultStyle;return this.updatePenManager(t,r.wrapMode,r.wrapWidth,r.lineHeight,s),s.getSliceTagText(e,n,i)}},{key:"copyPenManager",value:function(t,e){return void 0===e&&(e=this.penManager),e.copy(t)}},{key:"getTextWidth",value:function(t){return void 0===t&&(t=this.penManager),t.getMaxLineWidth()}},{key:"getLastPen",value:function(t){return void 0===t&&(t=this.penManager),t.lastPen}}]),n}(),Tn={setInteractive:function(){this.parent.on("pointerdown",on,this).on("pointerup",un,this).on("pointermove",hn,this).on("pointerover",hn,this).on("pointerout",function(t,e){hn.call(this,t,null,null,e)},this)}};Object.assign(bn.prototype,Xe,Tn);function Sn(t,e){void 0===e&&(e={key:t}),e.hasOwnProperty("key")||(e.key=t);var n=e.key,i=e.frame,s=e.width,r=e.height;if(void 0===s||void 0===r){var a=this.textureManager.getFrame(n,i),o=a?a.cutWidth:0,u=a?a.cutHeight:0;void 0===s&&void 0===r?(s=o,r=u):void 0===s?s=o*(r/u):void 0===r&&(r=u*(s/o))}this.images[t]={key:n,frame:i,width:s,height:r,y:On(e,"y",0),left:On(e,"left",0),right:On(e,"right",0)}}var On=Phaser.Utils.Objects.GetValue,Pn=function(){function e(t){f(this,e),this.textureManager=t.sys.textures,this.images={}}return h(e,[{key:"destroy",value:function(){this.textureManager=void 0,this.images=void 0}},{key:"add",value:function(t,e){if("string"==typeof t)Sn.call(this,t,e);else if(Array.isArray(t))for(var n=0,i=(s=t).length;n<i;n++)Sn.call(this,s[n]);else{var s=t;for(var t in s)Sn.call(this,t,s[t])}return this}},{key:"has",value:function(t){return this.images.hasOwnProperty(t)}},{key:"remove",value:function(t){return this.has(t)&&delete this.images[t],this}},{key:"get",value:function(t){return this.has(t)||this.textureManager.exists(t)&&this.add(t),this.images[t]}},{key:"getOuterWidth",value:function(t){var e=this.get(t);return e?e.width+e.left+e.right:0}},{key:"getFrame",value:function(t){var e=this.get(t);return e?this.textureManager.getFrame(e.key,e.frame):void 0}},{key:"hasTexture",value:function(t){return!!this.getFrame(t)}}]),e}(),Mn={draw:function(t,e,n,i,s){var r=this.get(t);n+=r.left,i+=r.y,s&&(n=Math.round(n),i=Math.round(i));var a=this.textureManager.getFrame(r.key,r.frame);e.drawImage(a.source.image,a.cutX,a.cutY,a.cutWidth,a.cutHeight,n,i,r.width,r.height)}};Object.assign(Pn.prototype,Mn);var En=Phaser.Utils.Objects.IsPlainObject,Cn=Phaser.DOM.AddToDOM,Rn=Phaser.Display.Canvas.CanvasPool,Fn=Phaser.GameObjects.GameObject,jn=Phaser.Utils.Objects.GetValue,_n=Phaser.DOM.RemoveFromDOM,Ln=Me,Gn={},An=function(){d(c,Fn);var l=v(c);function c(t,e,n,i,s,r,a){var o;if(f(this,c),En(e)){var u=e;e=jn(u,"x",0),n=jn(u,"y",0),i=jn(u,"text",""),s=jn(u,"style","")}if(void 0===e&&(e=0),void 0===n&&(n=0),(o=l.call(this,t,r)).renderer=t.sys.game.renderer,o.setPosition(e,n),o.setOrigin(0,0),o.initPipeline(),o.canvas=Rn.create(p(o)),o.context=o.canvas.getContext("2d"),o._imageManager=void 0,s){if(s.hasOwnProperty("align")){var h=s.align;delete s.align,s.halign=h}s.hasOwnProperty("stroke")&&!s.hasOwnProperty("strokeThickness")&&(s.strokeThickness=1)}return o.style=new je(p(o),s),o.autoRound=!0,o._text=void 0,o.padding={left:0,right:0,top:0,bottom:0},o.width=1,o.height=1,o.dirty=!1,0===o.style.resolution&&(o.style.resolution=1),o._crop=o.resetCropObject(),o.texture=t.sys.textures.addCanvas(null,o.canvas,!0),o.frame=o.texture.get(),o.frame.source.resolution=o.style.resolution,o.renderer.gl&&(o.renderer.deleteTexture(o.frame.source.glTexture),o.frame.source.glTexture=null),Gn.hasOwnProperty(r)||(Gn[r]=new Ot),o.canvasText=new bn({parent:p(o),context:o.context,parser:a,style:o.style,pensPool:Gn[r]}),o.parser=a,o.initRTL(),s&&s.padding&&o.setPadding(s.padding),o.setText(i),t.sys.game.events.on("contextrestored",o.onContextRestored,p(o)),o}return h(c,[{key:"onContextRestored",value:function(){this.dirty=!0}},{key:"preDestroy",value:function(){this.style.rtl&&_n(this.canvas),this.scene.sys.game.events.off("contextrestored",this.onContextRestored,this),this.canvasText.destroy(),this.canvasText=void 0,this._imageManager&&(this._imageManager.destroy(),this._imageManager=void 0),Rn.remove(this.canvas),this.texture.destroy()}},{key:"text",get:function(){return this._text},set:function(t){this.setText(t)}},{key:"initRTL",value:function(){this.style.rtl&&(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",Cn(this.canvas,this.scene.sys.canvas),this.originX=1)}},{key:"setText",value:function(t){return(t=null==t?"":Array.isArray(t)?t.join("\n"):t.toString())===this._text||(this._text=t,this.updateText()),this}},{key:"appendText",value:function(t){return null==t||(Array.isArray(t)&&(t=t.join("\n")),this.setText(this.text+t.toString())),this}},{key:"setStyle",value:function(t){return this.style.setStyle(t)}},{key:"setFont",value:function(t){return this.style.setFont(t)}},{key:"setFontFamily",value:function(t){return this.style.setFontFamily(t)}},{key:"setFontSize",value:function(t){return this.style.setFontSize(t)}},{key:"setFontStyle",value:function(t){return this.style.setFontStyle(t)}},{key:"setTestString",value:function(t){return this.style.setTestString(t)}},{key:"setFixedSize",value:function(t,e){return this.style.setFixedSize(t,e)}},{key:"setBackgroundColor",value:function(t,e,n){return this.style.setBackgroundColor(t,e,n)}},{key:"setBackgroundStrokeColor",value:function(t,e){return this.style.setBackgroundStrokeColor(t,e)}},{key:"setBackgroundCornerRadius",value:function(t,e){return this.style.setBackgroundCornerRadius(t,e)}},{key:"setFill",value:function(t){return this.style.setFill(t)}},{key:"setColor",value:function(t){return this.style.setColor(t)}},{key:"setStroke",value:function(t,e){return this.style.setStroke(t,e)}},{key:"setShadow",value:function(t,e,n,i,s,r){return this.style.setShadow(t,e,n,i,s,r)}},{key:"setShadowOffset",value:function(t,e){return this.style.setShadowOffset(t,e)}},{key:"setShadowColor",value:function(t){return this.style.setShadowColor(t)}},{key:"setShadowBlur",value:function(t){return this.style.setShadowBlur(t)}},{key:"setShadowStroke",value:function(t){return this.style.setShadowStroke(t)}},{key:"setShadowFill",value:function(t){return this.style.setShadowFill(t)}},{key:"setWrapMode",value:function(t){return this.style.setWrapMode(t)}},{key:"setWrapWidth",value:function(t){return this.style.setWrapWidth(t)}},{key:"setWordWrapWidth",value:function(t){return this.style.setWrapWidth(t)}},{key:"setAlign",value:function(t){return this.style.setHAlign(t)}},{key:"setHAlign",value:function(t){return this.style.setHAlign(t)}},{key:"setVAlign",value:function(t){return this.style.setVAlign(t)}},{key:"setLineSpacing",value:function(t){return this.style.setLineSpacing(t)}},{key:"setXOffset",value:function(t){return this.style.setXOffset(t)}},{key:"setPadding",value:function(t,e,n,i){if("object"===o(t)){var s=t,r=jn(s,"x",null);n=null!==r?t=r:(t=jn(s,"left",0),jn(s,"right",t));var a=jn(s,"y",null);i=null!==a?e=a:(e=jn(s,"top",0),jn(s,"bottom",e))}else void 0===t&&(t=0),void 0===e&&(e=t),void 0===n&&(n=t),void 0===i&&(i=e);return this.padding.left=t,this.padding.top=e,this.padding.right=n,this.padding.bottom=i,this.updateText(!1)}},{key:"setMaxLines",value:function(t){return this.style.setMaxLines(t)}},{key:"setResolution",value:function(t){return this.style.setResolution(t)}},{key:"updateText",value:function(t){void 0===t&&(t=!0);var e=this.canvasText,n=this.style;t&&e.updatePenManager(this._text,n.wrapMode,n.wrapWidth,n.lineHeight);var i,s,r=this.padding,a=Math.ceil(e.linesWidth);0===n.fixedWidth?(this.width=a+r.left+r.right,i=a):(this.width=n.fixedWidth,(i=this.width-r.left-r.right)<a&&(i=a)),0===n.fixedHeight?(this.height=e.linesHeight+r.top+r.bottom,s=e.linesHeight):(this.height=n.fixedHeight,(s=this.height-r.top-r.bottom)<e.linesHeight&&(s=e.linesHeight));var o=this.width,u=this.height;this.updateDisplayOrigin();var h=n.resolution;o*=h,u*=h,o=Math.max(Math.ceil(o),1),u=Math.max(Math.ceil(u),1);var l=this.canvas,c=this.context;l.width!==o||l.height!==u?(l.width=o,l.height=u,this.frame.setSize(o,u)):c.clearRect(0,0,o,u),c.save(),c.scale(h,h);var f=this.style.rtl?r.right:r.left,d=r.top;e.draw(f,d,i,s),c.restore(),this.renderer&&this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(l,this.frame.source.glTexture,!0),this.frame.glTexture=this.frame.source.glTexture),this.dirty=!0;var p=this.input;return p&&!p.customHitArea&&(p.hitArea.width=this.width,p.hitArea.height=this.height),this}},{key:"getTextMetrics",value:function(){return this.style.getTextMetrics()}},{key:"setTextMetrics",value:function(t,e){return this.style.setTextMetrics(t,e)}},{key:"toJSON",value:function(){var t=Bn.ToJSON(this),e={autoRound:this.autoRound,text:this._text,style:this.style.toJSON(),resolution:this.resolution,padding:{left:this.padding.left,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}};return t.data=e,t}},{key:"setInteractive",value:function(t,e,n){var i=!!this.input;return Fn.prototype.setInteractive.call(this,t,e,n),i||this.canvasText.setInteractive(),this}},{key:"getWrappedText",value:function(t,e,n){return(t=this.canvasText.getText(t,e,n,!0)).split(Ln)}},{key:"getPlainText",value:function(t,e,n){return this.canvasText.getPlainText(t,e,n)}},{key:"getText",value:function(t,e,n,i){return void 0===i&&(i=!1),this.canvasText.getText(t,e,n,i)}},{key:"getSubString",value:function(t,e,n){return this.getText(t,e,n)}},{key:"copyPenManager",value:function(t){return this.canvasText.copyPenManager(t)}},{key:"getPenManager",value:function(t,e){return this.canvasText.getPenManager(t,e)}},{key:"setSize",value:function(t,e){return this.setFixedSize(t,e)}},{key:"resize",value:function(t,e){return this.setFixedSize(t,e)}},{key:"lineSpacing",get:function(){return this.style.lineSpacing},set:function(t){this.setLineSpacing(t)}},{key:"imageManager",get:function(){return this._imageManager||(this._imageManager=new Pn(this.scene)),this._imageManager}},{key:"addImage",value:function(t,e){return this.imageManager.add(t,e),this}},{key:"drawAreaBounds",value:function(t,e){return this.canvasText.hitAreaManager.drawBounds(t,e,this),this}},{key:"measureTextMargins",value:function(t,e){return function(t,e,n){void 0===n&&(n={});var i=Le.create(this),s=i.getContext("2d");t.syncFont(i,s);var r=s.measureText(e),a=Math.ceil(r.width*t.baselineX),o=a,u=2*o;if(o=o*t.baselineY|0,i.width=a,i.height=u,s.fillStyle="#f00",s.fillRect(0,0,a,u),s.font=t._font,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(t.testString,0,o),(n.left=0)===a||0==u||!s.getImageData(0,0,a,u))return Le.remove(i),n;for(var h=s.getImageData(0,0,a,u).data,l=!1,c=0;c<a;c++){for(var f=0;f<u;f++){if(255!==h[4*(f*a+c)]){n.left=c,l=!0;break}}if(l)break}return Le.remove(i),n}(this.style,t,e)}},{key:"generateTexture",value:function(t,e,n,i,s){var r=this.canvas;return void 0===i?i=r.width:i*=this.resolution,void 0===s?s=r.height:s*=this.resolution,function(t,e,n,i,s,r,a){var o,u=t.sys.textures,h=t.renderer;void 0===i&&(i=0),void 0===s&&(s=0),void 0===r&&(r=e.width),void 0===a&&(a=e.height);var l=(o=u.exists(n)?u.get(n):u.createCanvas(n,r,a)).getSourceImage();l.width!==r&&(l.width=r),l.height!==a&&(l.height=a);var c=l.getContext("2d");c.clearRect(0,0,r,a),c.drawImage(e,i,s,r,a),h.gl&&o&&h.canvasToTexture(l,o.source[0].glTexture,!0,0)}(this.scene,r,t,e,n,i,s),this}}]),c}(),Bn=Phaser.GameObjects.Components;Phaser.Class.mixin(An,[Bn.Alpha,Bn.BlendMode,Bn.ComputedSize,Bn.Crop,Bn.Depth,Bn.Flip,Bn.GetBounds,Bn.Mask,Bn.Origin,Bn.Pipeline,Bn.ScrollFactor,Bn.Tint,Bn.Transform,Bn.Visible,me]);function zn(t,e){return void 0===e?"\\[".concat(t,"\\]"):"\\[".concat(t,"=(").concat(e,")\\]")}function In(t){return"\\[/".concat(t,"\\]")}var Vn="[-.0-9]+",Wn="[a-z]+|#[0-9abcdef]+",Un="[^\\]]+",Dn=zn("esc"),Hn=In("esc"),Xn=zn("raw"),Yn=In("raw"),Nn=zn("b"),Jn=In("b"),Kn=zn("i"),$n=In("i"),qn=zn("weight",Vn),Zn=In("weight"),Qn=zn("size",Vn),ti=In("size"),ei=zn("color",Wn),ni=In("color"),ii=zn("u"),si=zn("u",Wn),ri=In("u"),ai=zn("shadow"),oi=In("shadow"),ui="stroke",hi=zn(ui),li=zn(ui,Wn),ci=In(ui),fi=zn("y",Vn),di=In("y"),pi=zn("img",Un),vi=In("img"),gi=zn("area",Un),yi=In("area"),ki=zn("align",Un),mi=In("align"),wi=new RegExp(Dn,"i"),xi=new RegExp(Hn,"i"),bi=new RegExp(Xn,"i"),Ti=new RegExp(Yn,"i"),Si=new RegExp(Nn,"i"),Oi=new RegExp(Jn,"i"),Pi=new RegExp(Kn,"i"),Mi=new RegExp($n,"i"),Ei=new RegExp(qn,"i"),Ci=new RegExp(Zn,"i"),Ri=new RegExp(Qn,"i"),Fi=new RegExp(ti,"i"),ji=new RegExp(ei,"i"),_i=new RegExp(ni,"i"),Li=new RegExp(ii,"i"),Gi=new RegExp(si,"i"),Ai=new RegExp(ri,"i"),Bi=new RegExp(ai,"i"),zi=new RegExp(oi,"i"),Ii=new RegExp(hi,"i"),Vi=new RegExp(li,"i"),Wi=new RegExp(ci,"i"),Ui=new RegExp(fi,"i"),Di=new RegExp(di,"i"),Hi=new RegExp(pi,"i"),Xi=new RegExp(vi,"i"),Yi=new RegExp(gi,"i"),Ni=new RegExp(yi,"i"),Ji=new RegExp(ki,"i"),Ki=new RegExp(mi,"i"),$i=new RegExp([Xn,Yn,Dn,Hn,Nn,Jn,Kn,$n,qn,Zn,Qn,ti,ei,ni,ii,si,ri,ai,oi,hi,li,ci,fi,di,pi,vi,gi,yi,ki,mi].join("|"),"ig"),qi={plainText:null,prevProp:null},Zi=function(t,e,n,i){return!0===e?t[n]=i:t.hasOwnProperty(n)&&delete t[n],t},Qi=function(t){var e=t.b,n=t.weight,i=t.i;return e||n||i?i?e?"bold italic":n?"".concat(n," italic"):"italic":e?"bold":n.toString():""},ts=new je,es={},ns=function(){function t(){f(this,t)}return h(t,[{key:"getStrokeThinkness",value:function(t,e){return e.hasOwnProperty("stroke")?t.strokeThickness:0}}]),t}(),is={splitText:function(t,e){for(var n=[],i=0,s=!1,r=!1;;){var a=$i.exec(t);if(!a)break;var o=a[0];if(r){if(!xi.test(o))continue;r=!1}else if(s){if(!Ti.test(o))continue;s=!1}else wi.test(o)?r=!0:bi.test(o)&&(s=!0);var u=$i.lastIndex,h=u-o.length;if(i<h){var l=t.substring(i,h);n.push(l)}void 0===e&&n.push(o),i=u}var c=t.length;return i<c&&n.push(t.substring(i,c)),n},tagTextToProp:function(t,e){null==e&&(e={});var n="";if(e.img&&Zi(e,!1,"img"),e.esc)xi.test(t)?Zi(e,!1,"esc"):n=t;else if(e.raw)Ti.test(t)?Zi(e,!1,"raw"):n=t;else if(wi.test(t))Zi(e,!0,"esc",!0);else if(xi.test(t))Zi(e,!1,"esc");else if(bi.test(t))Zi(e,!0,"raw",!0);else if(Ti.test(t))Zi(e,!1,"raw");else if(Si.test(t))Zi(e,!0,"b",!0);else if(Oi.test(t))Zi(e,!1,"b");else if(Pi.test(t))Zi(e,!0,"i",!0);else if(Mi.test(t))Zi(e,!1,"i");else if(Ei.test(t)){var i=t.match(Ei);Zi(e,!0,"weight",i[1])}else if(Ci.test(t))Zi(e,!1,"weight");else if(Ri.test(t)){i=t.match(Ri);Zi(e,!0,"size","".concat(i[1],"px"))}else if(Fi.test(t))Zi(e,!1,"size");else if(ji.test(t)){i=t.match(ji);Zi(e,!0,"color",i[1])}else if(_i.test(t))Zi(e,!1,"color");else if(Li.test(t))Zi(e,!0,"u",!0);else if(Gi.test(t)){i=t.match(Gi);Zi(e,!0,"u",i[1])}else if(Ai.test(t))Zi(e,!1,"u");else if(Bi.test(t))Zi(e,!0,"shadow",!0);else if(zi.test(t))Zi(e,!1,"shadow");else if(Ii.test(t))Zi(e,!0,"stroke",!0);else if(Vi.test(t)){i=t.match(Vi);Zi(e,!0,"stroke",i[1])}else if(Wi.test(t))Zi(e,!1,"stroke");else if(Ui.test(t)){i=t.match(Ui);Zi(e,!0,"y",parseFloat(i[1]))}else if(Di.test(t))Zi(e,!1,"y");else if(Hi.test(t)){i=t.match(Hi);Zi(e,!0,"img",i[1])}else if(Xi.test(t))Zi(e,!1,"img");else if(Yi.test(t)){i=t.match(Yi);Zi(e,!0,"area",i[1])}else if(Ni.test(t))Zi(e,!1,"area");else if(Ji.test(t)){i=t.match(Ji);Zi(e,!0,"align",i[1])}else Ki.test(t)?Zi(e,!1,"align"):n=t;var s=qi;return s.plainText=n,s.prop=e,s},propToContextStyle:function(t,e){var n=ts;if(e.hasOwnProperty("img"))n.image=e.img;else{if(n.image=null,e.hasOwnProperty("family")?n.fontFamily=e.family:n.fontFamily=t.fontFamily,e.hasOwnProperty("size")){var i=e.size;"number"==typeof i&&(i="".concat(i,"px")),n.fontSize=i}else n.fontSize=t.fontSize;n.fontStyle=Qi(e),e.hasOwnProperty("color")?n.color=e.color:n.color=t.color,e.hasOwnProperty("stroke")?(!0===e.stroke?n.stroke=t.stroke:n.stroke=e.stroke,n.strokeThickness=t.strokeThickness):(n.stroke=t.stroke,n.strokeThickness=0)}return e.hasOwnProperty("shadow")?(!0===e.shadow?n.shadowColor=t.shadowColor:n.shadowColor=e.shadow,n.shadowOffsetX=t.shadowOffsetX,n.shadowOffsetY=t.shadowOffsetY,n.shadowBlur=t.shadowBlur,n.shadowStroke=!0,n.shadowFill=!0):(n.shadowColor="#000",n.shadowOffsetX=0,n.shadowOffsetY=0,n.shadowBlur=0,n.shadowStroke=!1,n.shadowFill=!1),e.hasOwnProperty("u")?(!0===e.u?n.underlineColor=t.underlineColor:n.underlineColor=e.u,n.underlineThickness=t.underlineThickness,n.underlineOffset=t.underlineOffset):(n.underlineColor="#000",n.underlineThickness=0,n.underlineOffset=0),n},propToTagText:function(t,e,n){null==n&&(n=es);var i=[];for(var s in n)e.hasOwnProperty(s)||i.push("[/".concat(s,"]"));for(var s in e){var r=e[s];if(n[s]!==r)switch(s){case"size":i.push("[size=".concat(r.replace("px",""),"]"));break;case"color":case"weight":case"stroke":case"y":case"img":case"area":case"align":i.push("[".concat(s,"=").concat(r,"]"));break;case"u":!0===r?i.push("[u]"):i.push("[u=".concat(r,"]"));break;default:i.push("[".concat(s,"]"))}}return i.push(t),i.join("")}};Object.assign(ns.prototype,is);var ss=function(){d(o,An);var a=v(o);function o(t,e,n,i,s){f(this,o);var r=new ns(s);return a.call(this,t,e,n,i,s,"rexBBCodeText",r)}return h(o)}(),rs={plainText:null,prevProp:null},as=new je,os=function(){function e(t){f(this,e),void 0===t&&(t={}),this.tags=t}return h(e,[{key:"addTag",value:function(t,e){this.tags[t]=e}},{key:"getTag",value:function(t){return this.tags[t]}},{key:"splitText",value:function(t,e){for(var n=[],i=0;;){var s=ls.exec(t);if(!s)break;var r=s[0],a=ls.lastIndex-r.length;if(i<a&&n.push(t.substring(i,a)),void 0===e)n.push(r);else if(1===e)if(cs.test(r)){var o=r.match(fs);n.push(o[2])}else if(ds.test(r)){o=r.match(ps);n.push(o[2])}i=ls.lastIndex}var u=t.length;return i<u&&n.push(t.substring(i,u)),n}},{key:"tagTextToProp",value:function(t){var e,n;if(cs.test(t)){if(null!=(r=t.match(fs))){var i=r[1],s=this.tags;(n=s.hasOwnProperty(i)?s[i]:{})._class=i,e=r[2]}}else if(ds.test(t)){var r;if(null!=(r=t.match(ps))){var a=r[1];(n=us(a))._style=a,e=r[2]}}null==e&&(e=t),null==n&&(n={});var o=rs;return o.plainText=e,o.prop=n,o}},{key:"propToContextStyle",value:function(t,e){var n=as;if(e.hasOwnProperty("img"))n.image=e.img;else{if(n.image=null,e.hasOwnProperty("family")||e.hasOwnProperty("fontFamily")||e.hasOwnProperty("font-family")){var i=e.hasOwnProperty("family")?e.family:e.hasOwnProperty("fontFamily")?e.fontFamily:e["font-family"];n.fontFamily=i}else n.fontFamily=t.fontFamily;if(e.hasOwnProperty("size")||e.hasOwnProperty("fontSize")||e.hasOwnProperty("font-size")){var s=e.hasOwnProperty("size")?e.size:e.hasOwnProperty("fontSize")?e.fontSize:e["font-size"];"number"==typeof s&&(s="".concat(s,"px")),n.fontSize=s}else n.fontSize=t.fontSize;if(e.hasOwnProperty("style")||e.hasOwnProperty("fontStyle")||e.hasOwnProperty("font-style")){var r=e.hasOwnProperty("style")?e.style:e.hasOwnProperty("fontStyle")?e.fontStyle:e["font-style"];n.fontStyle=r}else n.fontStyle=t.fontStyle;if(e.hasOwnProperty("color")||e.hasOwnProperty("font-color")){var a=e.hasOwnProperty("color")?e.color:e["font-color"];n.color=a}else n.color=t.color;if(e.hasOwnProperty("stroke")){var o=e.stroke;n.stroke=o.hasOwnProperty("color")?o.color:t.stroke,n.strokeThickness=o.hasOwnProperty("thickness")?o.thickness:t.strokeThickness}else n.stroke=t.stroke,n.strokeThickness=t.strokeThickness}if(e.hasOwnProperty("shadow")){var u=e.shadow;n.shadowColor=u.hasOwnProperty("color")?u.color:t.shadowColor,n.shadowOffsetX=u.hasOwnProperty("offsetX")?u.offsetX:t.shadowOffsetX,n.shadowOffsetY=u.hasOwnProperty("offsetY")?u.offsetY:t.shadowOffsetY,n.shadowBlur=u.hasOwnProperty("blur")?u.blur:t.shadowBlur,n.shadowStroke=!0,n.shadowFill=!0}else n.shadowColor=t.shadowColor,n.shadowOffsetX=t.shadowOffsetX,n.shadowOffsetY=t.shadowOffsetY,n.shadowBlur=t.shadowBlur,n.shadowStroke=t.shadowStroke,n.shadowFill=t.shadowFill;if(e.hasOwnProperty("u")||e.hasOwnProperty("underline")){var h=e.hasOwnProperty("u")?e.u:e.underline;n.underlineColor=h.hasOwnProperty("color")?h.color:t.underlineColor,n.underlineThickness=h.hasOwnProperty("thickness")?h.thickness:t.underlineThickness,n.underlineOffset=h.hasOwnProperty("offset")?h.offset:t.underlineOffset}else n.underlineColor=t.underlineColor,n.underlineThickness=t.underlineThickness,n.underlineOffset=t.underlineOffset;return n}},{key:"getStrokeThinkness",value:function(t,e){var n;if(e.hasOwnProperty("stroke")){var i=e.stroke;n=i.hasOwnProperty("thickness")?i.thickness:t.strokeThickness}else n=t.strokeThickness;return n}},{key:"propToTagText",value:function(t,e){return e.hasOwnProperty("_class")?""===t&&this.isTextTag(e._class)?"":"<class='".concat(e._class,"'>").concat(t,"</class>"):e.hasOwnProperty("_style")?"<style='".concat(e._style,"'>").concat(t,"</style>"):t}},{key:"destroy",value:function(){this.tags=void 0}},{key:"isTextTag",value:function(t){var e=this.tags[t];return!!e&&null==e.img}}]),e}(),us=function(t){for(var e,n,i,s={},r=0,a=(t=t.split(";")).length;r<a;r++)if(n=(e=t[r].split(":"))[0],i=e[1],!hs(n)&&!hs(i)){switch(n){case"stroke":var o=i.split(" ");i={},1<=(h=o.length)&&(i.color=o[0]),2<=h&&(i.thickness=parseInt(o[1].replace("px","")));break;case"shadow":var u=i.split(" ");i={},1<=(h=u.length)&&(i.color=u[0]),2<=h&&(i.offsetX=parseInt(u[1].replace("px",""))),3<=h&&(i.offsetY=parseInt(u[2].replace("px",""))),4<=h&&(i.blur=parseInt(u[3].replace("px","")));break;case"u":case"underline":var h,l=i.split(" ");i={},1<=(h=l.length)&&(i.color=l[0]),2<=h&&(i.thickness=parseInt(l[1].replace("px",""))),3<=h&&(i.offset=parseInt(l[2].replace("px","")));break;case"y":i=parseFloat(i)}s[n]=i}return s},hs=function(t){return 0===(t=t.replace(vs,"")).length},ls=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>|<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/g,cs=/<\s*class=/i,fs=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>/,ds=/<\s*style=/i,ps=/<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/,vs=/^\s+|\s+$/,gs=Phaser.Utils.Objects.GetValue,ys=function(){d(u,An);var o=v(u);function u(t,e,n,i,s){f(this,u);var r=gs(s,"tags",void 0),a=new os(r);return o.call(this,t,e,n,i,s,"rexTagText",a)}return h(u,[{key:"addTag",value:function(t,e){return this.parser.addTag(t,e),this.updateText(!0)}},{key:"addTags",value:function(t){for(var e in t)this.parser.addTag(e,t[e]);return this.updateText(!0)}},{key:"getTag",value:function(t){return this.parser.getTag(t)}},{key:"preDestroy",value:function(){c(l(u.prototype),"preDestroy",this).call(this),this.parser.destroy(),this.parser=void 0}}]),u}(),ks={};Object.assign(ks,{setText:function(t,e){return this.has(t)||this.add(t),this.get(t).setText(e),this}});var ms=function(){d(i,ae);var n=v(i);function i(t,e){return f(this,i),void 0===e&&(e={}),e.BobClass=ye,n.call(this,t,e)}return h(i,[{key:"setCreateGameObjectCallback",value:function(t){return this.createGameObjectCallback=t&&"text"!==t?"bbcodetext"===t?function(t){var e=new ss(t,0,0,"");return t.add.existing(e),e}:"tag"===t?function(t){var e=new ys(t,0,0,"");return t.add.existing(e),e}:t:function(t){return t.add.text(0,0,"")},this}}]),i}();Object.assign(ms.prototype,ks);function ws(t){return n=t,i="complete",new Promise(function(t,e){n.once(i,function(){t()})});var n,i}function xs(t,e,n,i,s){return function(){t.emit(Rs,s),e.apply(i,n)}}function bs(t,e,n,i,s){var r=xs(t,n,i,s,"custom"),a=e?"wait.".concat(e):"wait";t.emit(a,r)}function Ts(t,e,n,i,s){var r,a,o,u,h,l=xs(t,n,i,s,"time");t.once(Rs,function(){r&&(r.remove(),r=void 0)}),a=e,o=l,r=t.timeline.delayCall(a,o,u,h),t.emit("wait.time",e)}function Ss(t,e,n,i){var s=t.clickEE;if(s){var r=xs(t,e,n,i,"click");t.once(Rs,function(){s.off("pointerdown",r,t)}),s.once("pointerdown",r,t),t.emit("wait.click")}}function Os(t,e,n,i,s){var r=xs(t,n,i,s,"music");e&&(t.once(Rs,function(){e.off("complete",r,t)}),e.once("complete",r,t)),t.emit("wait.music",e),e||r()}function Ps(t){switch(t){case"camera.fadein":case"camera.fadeout":case"camera.flash":case"camera.shake":case"camera.zoom":case"camera.rotate":case"camera.scroll":return 1;default:return}}function Ms(e,t,n,i,s){var r,a,o=xs(e,n,i,s,"camera.".concat(t)),u=e.camera;switch(t){case"camera.fadein":r=u.fadeEffect,a="camerafadeincomplete";break;case"camera.fadeout":r=u.fadeEffect,a="camerafadeoutcomplete";break;case"camera.flash":r=u.flashEffect,a="cameraflashcomplete";break;case"camera.shake":r=u.shakeEffect,a="camerashakecomplete";break;case"camera.zoom":r=u.zoomEffect,a="camerazoomcomplete";break;case"camera.rotate":r=u.rotateToEffect,a="camerarotatecomplete";break;case"camera.scroll":r=u.panEffect,a="camerapancomplete"}r.isRunning?(e.once(Rs,function(t){u.off(a,o,e)}),u.once(a,o,e),e.emit("wait.camera",t)):(e.emit("wait.camera",t),o())}function Es(t,e,n,i,s){var r=xs(t,n,i,s,"keydown"),a="keydown-".concat(e.toUpperCase()),o=t.scene.input.keyboard;t.once(Rs,function(){o.off(a,r,t)}),o.once(a,r,t),t.emit("wait.keydown",e)}function Cs(e,t,n,i,s){var r=xs(e,n,i,s),a=t.split("."),o=e.spriteManager;switch(a.length){case 1:o.isEmpty?(e.emit("wait.sprite"),r()):(e.once(Rs,function(t){o.off("empty",r,e)}),o.once("empty",r,e),e.emit("wait.sprite"));break;case 2:var u=a[1];if(o.has(u)){var h=e.spriteManager.get(u).sprite;e.once(Rs,function(){h.off("destroy",r,e)}),h.once("destroy",r,e),e.emit("wait.sprite",u)}else e.emit("wait.sprite",u),r();break;case 3:u=a[1];var l=a[2],c=e.spriteManager.getTweenTask(u,l);c?(e.once(Rs,function(){c.off("complete",r,e)}),c.once("complete",r,e),e.emit("wait.sprite",u,l)):(e.emit("wait.sprite",u,l),r())}}var Rs="_remove.wait",Fs=[Rs,"_remove.play"],js=Phaser.Input.Keyboard.KeyCodes,_s={setClickTarget:function(t){return(this.clickTarget=t)?S(t)?this.clickEE=t.input:this.clickEE=t.setInteractive():this.clickEE=null,this},setTargetCamera:function(t){return this.camera=t,this},setSkipSoundEffect:function(t){if(void 0===t&&(t=!0),this.skipSoundEffect=t){var e=this._soundManager;e&&e.fadeOutAllSoundEffects(100,!0)}return this},play:function(t){return this.parser.start(t),this},playPromise:function(t){var e=ws(this);return this.play(t),e},pause:function(){return this.parser.pause(),this},resume:function(){return this.parser.next(),this},wait:function(t){return this.ignoreWait||(this.pause(),function(t,e,n,i,s){for(var r=0,a=(e="string"==typeof e&&1<e.length&&-1!==e.indexOf("|")?e.split("|"):[e]).length;r<a;r++){var o=e[r];if(null==o||"wait"===o)bs(t,void 0,n,i,s);else if("number"!=typeof o&&isNaN(o))if("click"===o)Ss(t,n,i,s);else if("se"===o){var u=t.soundManager.getLastSoundEffect();Os(t,u,n,i,s)}else if("bgm"===o){u=t.soundManager.getBackgroundMusic();Os(t,u,n,i,s)}else js.hasOwnProperty(o.toUpperCase())?Es(t,o,n,i,s):Ps(o)?Ms(t,o,n,i,s):("sprite"===(h=o.split("."))[0]&&h.length<=3?Cs:bs)(t,o,n,i,s);else Ts(t,parseFloat(o),n,i,s)}var h}(this,t,this.resume,[],this)),this}},Ls=Phaser.Events.EventEmitter,Gs=Phaser.Utils.Objects.GetValue,As=function(){d(o,Ls);var a=v(o);function o(t,e){var n;f(this,o),(n=a.call(this)).scene=t,n.parser=new ot(p(n),Gs(e,"parser",void 0)),n.timeline=new Ct(p(n)),n._soundManager=void 0;var i=Gs(e,"sounds",void 0);i&&(n._soundManager=new $t(n.scene,i)),n.setTargetCamera(Gs(e,"camera",n.scene.sys.cameras.main)),n._spriteManager=void 0;var s=Gs(e,"sprites",void 0);s&&(n._spriteManager=new he(n.scene,s)),n._textManager=void 0;var r=Gs(e,"texts",void 0);return r&&(n._textManager=new ms(n.scene,r)),n.setClickTarget(Gs(e,"clickTarget",t)),n}return h(o,[{key:"isPlaying",get:function(){return this.parser.isRunning}},{key:"soundManager",get:function(){return void 0===this._soundManager&&(this._soundManager=new $t(this.scene)),this._soundManager}},{key:"spriteManager",get:function(){return void 0===this._spriteManager&&(this._spriteManager=new he(this.scene)),this._spriteManager}},{key:"textManager",get:function(){return void 0===this._textManager&&(this._textManager=new ms(this.scene)),this._textManager}},{key:"destroy",value:function(t){this.scene&&(function(t){for(var e=0,n=Fs.length;e<n;e++)t.emit(Fs[e])}(this),this._soundManager&&this._soundManager.destroy(t),this._soundManager=void 0,this.camera=void 0,this._spriteManager&&this._spriteManager.destroy(t),this._spriteManager=void 0,this.scene=void 0)}}]),o}();return Object.assign(As.prototype,_s),function(){d(n,Phaser.Plugins.BasePlugin);var e=v(n);function n(t){return f(this,n),e.call(this,t)}return h(n,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}},{key:"add",value:function(t,e){return new As(t,e)}}]),n}()});
