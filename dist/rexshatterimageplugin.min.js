!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).rexshatterimageplugin=t()}(this,function(){"use strict";function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function t(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function i(o){var a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,r,n=u(o);if(a){var i=u(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return t=this,!(r=e)||"object"!=typeof r&&"function"!=typeof r?c(t):r}}function x(e){var t,r,n,i,o,a,u=e.rectangle;a=u?(t=u.x,n=u.y,o=u.width,u.height):(n=t=0,o=e.width,e.height),r=t+o,i=n+a;var s,f,c=e.center;f=void 0===c?(s=(t+r)/2,(n+i)/2):(s=j(c.x,t,r),j(c.y,n,i));var h=[];h.push([s,f]);for(var l=P(e,"samples",12),p=P(e,"variation",.25),v=Math.min(o,a),y=1-p,m=1+p,g=0;g<3;g++)O(h,s,f,v*Math.pow(3,g)/27,l,y,m,t,r,n,i);return v=2*Math.min(o,a),O(h,s,f,v,l,y,m,t,r,n,i),function(e,t){void 0===t&&(t=!0);var r=b.triangulate(e);if(t){for(var n=[],i=0,o=r.length;i<o;i+=3){var a=e[r[i+0]],u=e[r[i+1]],s=e[r[i+2]],f=new d(a[0],a[1],u[0],u[1],s[0],s[1]);n.push(f)}return n}return{vertices:e,indices:r}}(h,P(e,"triangleOutput",!0))}var o,b=(function(e){var t,x;function y(e,t,r,n){var i,o,a,u,s,f,c,h,l,p,v=e[t][0],y=e[t][1],m=e[r][0],g=e[r][1],b=e[n][0],d=e[n][1],P=Math.abs(y-g),j=Math.abs(g-d);if(P<x&&j<x)throw new Error("Eek! Coincident points!");return o=P<x?(u=-(b-m)/(d-g))*((i=(m+v)/2)-(f=(m+b)/2))+(h=(g+d)/2):j<x?(a=-(m-v)/(g-y))*((i=(b+m)/2)-(s=(v+m)/2))+(c=(y+g)/2):(i=((a=-(m-v)/(g-y))*(s=(v+m)/2)-(u=-(b-m)/(d-g))*(f=(m+b)/2)+(h=(g+d)/2)-(c=(y+g)/2))/(a-u),j<P?a*(i-s)+c:u*(i-f)+h),{i:t,j:r,k:n,x:i,y:o,r:(l=m-i)*l+(p=g-o)*p}}function m(e){var t,r,n,i,o,a;for(r=e.length;r;)for(i=e[--r],n=e[--r],t=r;t;)if(a=e[--t],n===(o=e[--t])&&i===a||n===a&&i===o){e.splice(r,2),e.splice(t,2);break}}x=1/1048576,t={triangulate:function(r,e){var t,n,i,o,a,u,s,f,c,h,l,p,v=r.length;if(v<3)return[];if(r=r.slice(0),e)for(t=v;t--;)r[t]=r[t][e];for(i=new Array(v),t=v;t--;)i[t]=t;for(i.sort(function(e,t){return r[t][0]-r[e][0]}),o=function(e){var t,r,n,i,o,a,u=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;for(t=e.length;t--;)e[t][0]<u&&(u=e[t][0]),e[t][0]>f&&(f=e[t][0]),e[t][1]<s&&(s=e[t][1]),e[t][1]>c&&(c=e[t][1]);return n=c-s,[[(o=u+.5*(r=f-u))-20*(i=Math.max(r,n)),(a=s+.5*n)-i],[o,a+20*i],[o+20*i,a-i]]}(r),r.push(o[0],o[1],o[2]),a=[y(r,v+0,v+1,v+2)],u=[],s=[],t=i.length;t--;s.length=0){for(p=i[t],n=a.length;n--;)0<(f=r[p][0]-a[n].x)&&f*f>a[n].r?(u.push(a[n]),a.splice(n,1)):f*f+(c=r[p][1]-a[n].y)*c-a[n].r>x||(s.push(a[n].i,a[n].j,a[n].j,a[n].k,a[n].k,a[n].i),a.splice(n,1));for(m(s),n=s.length;n;)l=s[--n],h=s[--n],a.push(y(r,h,l,p))}for(t=a.length;t--;)u.push(a[t]);for(a.length=0,t=u.length;t--;)u[t].i<v&&u[t].j<v&&u[t].k<v&&a.push(u[t].i,u[t].j,u[t].k);return a},contains:function(e,t){if(t[0]<e[0][0]&&t[0]<e[1][0]&&t[0]<e[2][0]||t[0]>e[0][0]&&t[0]>e[1][0]&&t[0]>e[2][0]||t[1]<e[0][1]&&t[1]<e[1][1]&&t[1]<e[2][1]||t[1]>e[0][1]&&t[1]>e[1][1]&&t[1]>e[2][1])return null;var r=e[1][0]-e[0][0],n=e[2][0]-e[0][0],i=e[1][1]-e[0][1],o=e[2][1]-e[0][1],a=r*o-n*i;if(0==a)return null;var u=(o*(t[0]-e[0][0])-n*(t[1]-e[0][1]))/a,s=(r*(t[1]-e[0][1])-i*(t[0]-e[0][0]))/a;return u<0||s<0||1<u+s?null:[u,s]}},e.exports=t}(o={exports:{}}),o.exports),d=Phaser.Geom.Triangle,P=Phaser.Utils.Objects.GetValue,j=Phaser.Math.Clamp,y=2*Math.PI,O=function(e,t,r,n,i,o,a,u,s,f,c){for(var h=0;h<i;h++){var l=h/i*y,p=t+Math.cos(l)*n*m(o,a),v=r+Math.sin(l)*n*m(o,a);p=j(p,u,s),v=j(v,f,c),e.push([p,v])}return e},m=function(e,t){return e===t?e:e+(t-e)*Math.random()},a=Phaser.GameObjects.Mesh,h=Phaser.Utils.Objects.IsPlainObject,l=Phaser.Utils.Objects.GetValue,p=Phaser.Geom.Mesh.GenerateGridVerts,v=Phaser.Geom.Mesh.Vertex,w=Phaser.Geom.Mesh.Face,I=Phaser.Math.Distance.Power,g=function(){t(s,a);var u=i(s);function s(e,t,r,n,i,o){var a;return f(this,s),h(t)&&(t=l(o=t,"x",0),r=l(o,"y",0),n=l(o,"key",null),i=l(o,"frame",null)),(a=u.call(this,e,t,r,n,i)).type="rexShatterImage",a.setOrtho(),a.hideCCW=!1,p({mesh:c(a),texture:a.texture.key,frame:a.frame.name,flipY:a.frame.source.isRenderTexture}),a}return e(s,[{key:"shatter",value:function(e){this.vertices.length=0,this.faces.length=0,this.dirtyCache[9]=-1;var t=this.width,r=this.height;if(0===t||0===r)return this;void 0===e&&(e={x:t/2,y:r/2});for(var n=x({width:t,height:r,center:e,triangleOutput:!1}),i=this.frame.source.isRenderTexture,o=this.frame.u0,a=this.frame.u1,u=i?this.frame.v1:this.frame.v0,s=i?this.frame.v0:this.frame.v1,f=n.vertices,c=n.indices,h=e.x,l=e.y,p=0,v=c.length;p<v;p+=3){var y=f[c[p+0]],m=f[c[p+1]],g=f[c[p+2]],b=G(y[0],y[1],t,r,o,a,u,s),d=G(m[0],m[1],t,r,o,a,u,s),P=G(g[0],g[1],t,r,o,a,u,s),j=new w(b,d,P);this.vertices.push(b,d,P),this.faces.push(j),j.g=Math.min(I(h,l,y[0],y[1]),I(h,l,m[0],m[1]),I(h,l,g[0],g[1]))}return this.faces.sort(function(e,t){return e.g-t.g}),this}}]),s}(),M=Phaser.Math.Linear,G=function(e,t,r,n,i,o,a,u){e/=n,r/=n;var s=(t/=n)/(n=1),f=M(i,o,e/r),c=M(a,u,s);return new v(e-=r/2,-(t-=n/2),0,f,c)};function T(e,t,r,n,i){var o=new g(this.scene,e,t,r,n,i);return this.scene.add.existing(o),o}var N=Phaser.Utils.Objects.GetAdvancedValue,k=Phaser.GameObjects.BuildGameObject;function S(e,t){void 0===e&&(e={}),void 0!==t&&(e.add=t);var r=N(e,"key",null),n=N(e,"frame",null),i=new g(this.scene,0,0,r,n,e);return k(this.scene,i,e),i}function _(e){return null==e||""===e||0===e.length}var E=function(){t(n,Phaser.Plugins.BasePlugin);var r=i(n);function n(e){var t;return f(this,n),t=r.call(this,e),e.registerGameObject("rexShatterImage",T,S),t}return e(n,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}}]),n}();return function(e,t,r){if("object"===s(e)){if(_(t)){if(null==r)return;"object"===s(r)&&(e=r)}else{"string"==typeof t&&(t=t.split("."));var n=t.pop();(function(e,t,r){var n=e;if(!_(t)){var i;"string"==typeof t&&(t=t.split("."));for(var o=0,a=t.length;o<a;o++){var u;if(null==n[i=t[o]]||"object"!==s(n[i]))u=o!==a-1||void 0===r?{}:r,n[i]=u;n=n[i]}}return n})(e,t)[n]=r}}}(window,"RexPlugins.GameObjects.ShatterImage",g),E});
