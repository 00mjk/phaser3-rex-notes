!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).rexshatterimageplugin=t()}(this,function(){"use strict";function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function t(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function i(o){var u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,r,n=a(o);if(u){var i=a(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return t=this,!(r=e)||"object"!=typeof r&&"function"!=typeof r?c(t):r}}function j(e){var t,r,n,i,o,u,a=e.rectangle;u=a?(t=a.x,n=a.y,o=a.width,a.height):(n=t=0,o=e.width,e.height),r=t+o,i=n+u;var s,f,c=e.center;f=void 0===c?(s=(t+r)/2,(n+i)/2):(s=P(c.x,t,r),P(c.y,n,i));var h=[];h.push([s,f]);for(var l=w(e,"samples",12),p=w(e,"variation",.25),v=Math.min(o,u),y=1-p,m=1+p,g=0;g<3;g++)O(h,s,f,v*Math.pow(3,g)/27,l,y,m,t,r,n,i);return v=2*Math.min(o,u),O(h,s,f,v,l,y,m,t,r,n,i),function(e,t){void 0===t&&(t=!0);var r=d.triangulate(e);if(t){for(var n=[],i=0,o=r.length;i<o;i+=3){var u=e[r[i+0]],a=e[r[i+1]],s=e[r[i+2]],f=new b(u[0],u[1],a[0],a[1],s[0],s[1]);n.push(f)}return n}return{vertices:e,indices:r}}(h,w(e,"triangleOutput",!0))}var o,d=(function(e){var t,P;function y(e,t,r,n){var i,o,u,a,s,f,c,h,l,p,v=e[t][0],y=e[t][1],m=e[r][0],g=e[r][1],d=e[n][0],b=e[n][1],j=Math.abs(y-g),w=Math.abs(g-b);if(j<P&&w<P)throw new Error("Eek! Coincident points!");return o=j<P?(a=-(d-m)/(b-g))*((i=(m+v)/2)-(f=(m+d)/2))+(h=(g+b)/2):w<P?(u=-(m-v)/(g-y))*((i=(d+m)/2)-(s=(v+m)/2))+(c=(y+g)/2):(i=((u=-(m-v)/(g-y))*(s=(v+m)/2)-(a=-(d-m)/(b-g))*(f=(m+d)/2)+(h=(g+b)/2)-(c=(y+g)/2))/(u-a),w<j?u*(i-s)+c:a*(i-f)+h),{i:t,j:r,k:n,x:i,y:o,r:(l=m-i)*l+(p=g-o)*p}}function m(e){var t,r,n,i,o,u;for(r=e.length;r;)for(i=e[--r],n=e[--r],t=r;t;)if(u=e[--t],n===(o=e[--t])&&i===u||n===u&&i===o){e.splice(r,2),e.splice(t,2);break}}P=1/1048576,t={triangulate:function(r,e){var t,n,i,o,u,a,s,f,c,h,l,p,v=r.length;if(v<3)return[];if(r=r.slice(0),e)for(t=v;t--;)r[t]=r[t][e];for(i=new Array(v),t=v;t--;)i[t]=t;for(i.sort(function(e,t){return r[t][0]-r[e][0]}),o=function(e){var t,r,n,i,o,u,a=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;for(t=e.length;t--;)e[t][0]<a&&(a=e[t][0]),e[t][0]>f&&(f=e[t][0]),e[t][1]<s&&(s=e[t][1]),e[t][1]>c&&(c=e[t][1]);return n=c-s,[[(o=a+.5*(r=f-a))-20*(i=Math.max(r,n)),(u=s+.5*n)-i],[o,u+20*i],[o+20*i,u-i]]}(r),r.push(o[0],o[1],o[2]),u=[y(r,v+0,v+1,v+2)],a=[],s=[],t=i.length;t--;s.length=0){for(p=i[t],n=u.length;n--;)0<(f=r[p][0]-u[n].x)&&f*f>u[n].r?(a.push(u[n]),u.splice(n,1)):f*f+(c=r[p][1]-u[n].y)*c-u[n].r>P||(s.push(u[n].i,u[n].j,u[n].j,u[n].k,u[n].k,u[n].i),u.splice(n,1));for(m(s),n=s.length;n;)l=s[--n],h=s[--n],u.push(y(r,h,l,p))}for(t=u.length;t--;)a.push(u[t]);for(u.length=0,t=a.length;t--;)a[t].i<v&&a[t].j<v&&a[t].k<v&&u.push(a[t].i,a[t].j,a[t].k);return u},contains:function(e,t){if(t[0]<e[0][0]&&t[0]<e[1][0]&&t[0]<e[2][0]||t[0]>e[0][0]&&t[0]>e[1][0]&&t[0]>e[2][0]||t[1]<e[0][1]&&t[1]<e[1][1]&&t[1]<e[2][1]||t[1]>e[0][1]&&t[1]>e[1][1]&&t[1]>e[2][1])return null;var r=e[1][0]-e[0][0],n=e[2][0]-e[0][0],i=e[1][1]-e[0][1],o=e[2][1]-e[0][1],u=r*o-n*i;if(0==u)return null;var a=(o*(t[0]-e[0][0])-n*(t[1]-e[0][1]))/u,s=(r*(t[1]-e[0][1])-i*(t[0]-e[0][0]))/u;return a<0||s<0||1<a+s?null:[a,s]}},e.exports=t}(o={exports:{}}),o.exports),b=Phaser.Geom.Triangle,w=Phaser.Utils.Objects.GetValue,P=Phaser.Math.Clamp,y=2*Math.PI,O=function(e,t,r,n,i,o,u,a,s,f,c){for(var h=0;h<i;h++){var l=h/i*y,p=t+Math.cos(l)*n*m(o,u),v=r+Math.sin(l)*n*m(o,u);p=P(p,a,s),v=P(v,f,c),e.push([p,v])}return e},m=function(e,t){return e===t?e:e+(t-e)*Math.random()},u=Phaser.GameObjects.Mesh,h=Phaser.Utils.Objects.IsPlainObject,l=Phaser.Utils.Objects.GetValue,p=Phaser.Geom.Mesh.GenerateGridVerts,v=Phaser.Geom.Mesh.Vertex,x=Phaser.Geom.Mesh.Face,g=function(){t(s,u);var a=i(s);function s(e,t,r,n,i,o){var u;return f(this,s),h(t)&&(t=l(o=t,"x",0),r=l(o,"y",0),n=l(o,"key",null),i=l(o,"frame",null)),(u=a.call(this,e,t,r,n,i)).type="rexShatterImage",u.setOrtho(),u.hideCCW=!1,p({mesh:c(u),texture:u.texture.key,frame:u.frame.name,width:u.width/u.height,height:1,widthSegments:1,heightSegments:1,flipY:u.frame.source.isRenderTexture}),u}return e(s,[{key:"shatter",value:function(e){this.vertices.length=0,this.faces.length=0,this.dirtyCache[9]=-1;var t=this.width,r=this.height;if(0===t||0===r)return this;void 0===e&&(e={x:t/2,y:r/2});for(var n=j({width:t,height:r,center:e,triangleOutput:!1}),i=this.frame.source.isRenderTexture,o=this.frame.u0,u=this.frame.u1,a=i?this.frame.v1:this.frame.v0,s=i?this.frame.v0:this.frame.v1,f=n.vertices,c=n.indices,h=0,l=c.length;h<l;h+=3){var p=f[c[h+0]],v=f[c[h+1]],y=f[c[h+2]],m=G(p[0],p[1],t,r,o,u,a,s),g=G(v[0],v[1],t,r,o,u,a,s),d=G(y[0],y[1],t,r,o,u,a,s),b=new x(m,g,d);this.vertices.push(m,g,d),this.faces.push(b)}return this}}]),s}(),I=Phaser.Math.Linear,G=function(e,t,r,n,i,o,u,a){e/=n,r/=n;var s=(t/=n)/(n=1),f=I(i,o,e/r),c=I(u,a,s);return new v(e-=r/2,-(t-=n/2),0,f,c)};function M(e,t,r,n,i){var o=new g(this.scene,e,t,r,n,i);return this.scene.add.existing(o),o}var T=Phaser.Utils.Objects.GetAdvancedValue,N=Phaser.GameObjects.BuildGameObject;function S(e,t){void 0===e&&(e={}),void 0!==t&&(e.add=t);var r=T(e,"key",null),n=T(e,"frame",null),i=new g(this.scene,0,0,r,n,e);return N(this.scene,i,e),i}function k(e){return null==e||""===e||0===e.length}var _=function(){t(n,Phaser.Plugins.BasePlugin);var r=i(n);function n(e){var t;return f(this,n),t=r.call(this,e),e.registerGameObject("rexShatterImage",M,S),t}return e(n,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}}]),n}();return function(e,t,r){if("object"===s(e)){if(k(t)){if(null==r)return;"object"===s(r)&&(e=r)}else{"string"==typeof t&&(t=t.split("."));var n=t.pop();(function(e,t,r){var n=e;if(!k(t)){var i;"string"==typeof t&&(t=t.split("."));for(var o=0,u=t.length;o<u;o++){var a;if(null==n[i=t[o]]||"object"!==s(n[i]))a=o!==u-1||void 0===r?{}:r,n[i]=a;n=n[i]}}return n})(e,t)[n]=r}}}(window,"RexPlugins.GameObjects.ShatterImage",g),_});
