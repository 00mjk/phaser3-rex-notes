!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexshatterimageplugin=e()}(this,function(){"use strict";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function t(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function r(t,e){return(r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function i(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=o(n);if(i){var r=o(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return u(this,t)}}function j(t){var e,r,n,i,o,u,a=t.rectangle;u=a?(e=a.x,n=a.y,o=a.width,a.height):(n=e=0,o=t.width,t.height),r=e+o,i=n+u;var s,f,c=t.center;f=void 0===c?(s=(e+r)/2,(n+i)/2):(s=P(c.x,e,r),P(c.y,n,i));var h=[];h.push([s,f]);for(var l=O(t,"samples",12),p=O(t,"variation",.25),v=Math.min(o,u),y=1-p,g=1+p,b=0;b<3;b++)w(h,s,f,v*Math.pow(3,b)/27,l,y,g,e,r,n,i);return v=2*Math.min(o,u),w(h,s,f,v,l,y,g,e,r,n,i),function(t,e){void 0===e&&(e=!0);var r=m.triangulate(t);if(e){for(var n=[],i=0,o=r.length;i<o;i+=3){var u=t[r[i+0]],a=t[r[i+1]],s=t[r[i+2]],f=new d(u[0],u[1],a[0],a[1],s[0],s[1]);n.push(f)}return n}return{vertices:t,indices:r}}(h,O(t,"triangleOutput",!0))}var a,m=(function(t){var e,P;function y(t,e,r,n){var i,o,u,a,s,f,c,h,l,p,v=t[e][0],y=t[e][1],g=t[r][0],b=t[r][1],m=t[n][0],d=t[n][1],j=Math.abs(y-b),O=Math.abs(b-d);if(j<P&&O<P)throw new Error("Eek! Coincident points!");return o=j<P?(a=-(m-g)/(d-b))*((i=(g+v)/2)-(f=(g+m)/2))+(h=(b+d)/2):O<P?(u=-(g-v)/(b-y))*((i=(m+g)/2)-(s=(v+g)/2))+(c=(y+b)/2):(i=((u=-(g-v)/(b-y))*(s=(v+g)/2)-(a=-(m-g)/(d-b))*(f=(g+m)/2)+(h=(b+d)/2)-(c=(y+b)/2))/(u-a),O<j?u*(i-s)+c:a*(i-f)+h),{i:e,j:r,k:n,x:i,y:o,r:(l=g-i)*l+(p=b-o)*p}}function g(t){var e,r,n,i,o,u;for(r=t.length;r;)for(i=t[--r],n=t[--r],e=r;e;)if(u=t[--e],n===(o=t[--e])&&i===u||n===u&&i===o){t.splice(r,2),t.splice(e,2);break}}P=1/1048576,e={triangulate:function(r,t){var e,n,i,o,u,a,s,f,c,h,l,p,v=r.length;if(v<3)return[];if(r=r.slice(0),t)for(e=v;e--;)r[e]=r[e][t];for(i=new Array(v),e=v;e--;)i[e]=e;for(i.sort(function(t,e){return r[e][0]-r[t][0]}),o=function(t){var e,r,n,i,o,u,a=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;for(e=t.length;e--;)t[e][0]<a&&(a=t[e][0]),t[e][0]>f&&(f=t[e][0]),t[e][1]<s&&(s=t[e][1]),t[e][1]>c&&(c=t[e][1]);return n=c-s,[[(o=a+.5*(r=f-a))-20*(i=Math.max(r,n)),(u=s+.5*n)-i],[o,u+20*i],[o+20*i,u-i]]}(r),r.push(o[0],o[1],o[2]),u=[y(r,v+0,v+1,v+2)],a=[],s=[],e=i.length;e--;s.length=0){for(p=i[e],n=u.length;n--;)0<(f=r[p][0]-u[n].x)&&f*f>u[n].r?(a.push(u[n]),u.splice(n,1)):f*f+(c=r[p][1]-u[n].y)*c-u[n].r>P||(s.push(u[n].i,u[n].j,u[n].j,u[n].k,u[n].k,u[n].i),u.splice(n,1));for(g(s),n=s.length;n;)l=s[--n],h=s[--n],u.push(y(r,h,l,p))}for(e=u.length;e--;)a.push(u[e]);for(u.length=0,e=a.length;e--;)a[e].i<v&&a[e].j<v&&a[e].k<v&&u.push(a[e].i,a[e].j,a[e].k);return u},contains:function(t,e){if(e[0]<t[0][0]&&e[0]<t[1][0]&&e[0]<t[2][0]||e[0]>t[0][0]&&e[0]>t[1][0]&&e[0]>t[2][0]||e[1]<t[0][1]&&e[1]<t[1][1]&&e[1]<t[2][1]||e[1]>t[0][1]&&e[1]>t[1][1]&&e[1]>t[2][1])return null;var r=t[1][0]-t[0][0],n=t[2][0]-t[0][0],i=t[1][1]-t[0][1],o=t[2][1]-t[0][1],u=r*o-n*i;if(0==u)return null;var a=(o*(e[0]-t[0][0])-n*(e[1]-t[0][1]))/u,s=(r*(e[1]-t[0][1])-i*(e[0]-t[0][0]))/u;return a<0||s<0||1<a+s?null:[a,s]}},t.exports=e}(a={exports:{}}),a.exports),d=Phaser.Geom.Triangle,O=Phaser.Utils.Objects.GetValue,P=Phaser.Math.Clamp,y=2*Math.PI,w=function(t,e,r,n,i,o,u,a,s,f,c){for(var h=0;h<i;h++){var l=h/i*y,p=e+Math.cos(l)*n*g(o,u),v=r+Math.sin(l)*n*g(o,u);p=P(p,a,s),v=P(v,f,c),t.push([p,v])}return t},g=function(t,e){return t===e?t:t+(e-t)*Math.random()},h=Phaser.GameObjects.Mesh,l=Phaser.Utils.Objects.IsPlainObject,p=Phaser.Utils.Objects.GetValue,v=Phaser.Geom.Mesh.Vertex,I=Phaser.Geom.Mesh.Face,f=function(){e(f,h);var s=i(f);function f(t,e,r,n,i,o){var u;c(this,f),l(e)&&(e=p(o=e,"x",0),r=p(o,"y",0),n=p(o,"key",null),i=p(o,"frame",null)),(u=s.call(this,t,e,r,n,i)).type="rexShatterImage",u.setOrtho(),u.hideCCW=!1;var a=p(o,"center",void 0);return u.shatter(a),u}return t(f,[{key:"shatter",value:function(t){this.vertices.length=0,this.faces.length=0,this.dirtyCache[9]=-1;var e=this.width,r=this.height;if(0===e||0===r)return this;void 0===t&&(t={x:e/2,y:r/2});for(var n=j({width:e,height:r,center:t,triangleOutput:!1}),i=this.frame.source.isRenderTexture,o=this.frame.u0,u=this.frame.u1,a=i?this.frame.v1:this.frame.v0,s=i?this.frame.v0:this.frame.v1,f=n.vertices,c=n.indices,h=0,l=c.length;h<l;h+=3){var p=f[c[h+0]],v=f[c[h+1]],y=f[c[h+2]],g=x(p[0],p[1],e,r,o,u,a,s),b=x(v[0],v[1],e,r,o,u,a,s),m=x(y[0],y[1],e,r,o,u,a,s),d=new I(g,b,m);this.vertices.push(g,b,m),this.faces.push(d)}return this}}]),f}(),b=Phaser.Math.Linear,x=function(t,e,r,n,i,o,u,a){t/=n,r/=n;var s=(e/=n)/(n=1),f=b(i,o,t/r),c=b(u,a,s);return new v(t-=r/2,-(e-=n/2),0,f,c)};function M(t,e,r,n,i){var o=new f(this.scene,t,e,r,n,i);return this.scene.add.existing(o),o}var N=Phaser.Utils.Objects.GetAdvancedValue,T=Phaser.GameObjects.BuildGameObject;function G(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var r=N(t,"key",null),n=N(t,"frame",null),i=new f(this.scene,0,0,r,n,t);return T(this.scene,i,t),i}function k(t){return null==t||""===t||0===t.length}var S=function(){e(n,Phaser.Plugins.BasePlugin);var r=i(n);function n(t){var e;return c(this,n),e=r.call(this,t),t.registerGameObject("rexShatterImage",M,G),e}return t(n,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}}]),n}();return function(t,e,r){if("object"===s(t)){if(k(e)){if(null==r)return;"object"===s(r)&&(t=r)}else{"string"==typeof e&&(e=e.split("."));var n=e.pop();(function(t,e,r){var n=t;if(!k(e)){var i;"string"==typeof e&&(e=e.split("."));for(var o=0,u=e.length;o<u;o++){var a;if(null==n[i=e[o]]||"object"!==s(n[i]))a=o!==u-1||void 0===r?{}:r,n[i]=a;n=n[i]}}return n})(t,e)[n]=r}}}(window,"RexPlugins.GameObjects.ShatterImage",f),S});
