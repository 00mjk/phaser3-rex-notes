!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexshatterimageplugin=e()}(this,function(){"use strict";function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function t(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function r(t,e){return(r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function i(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=s(n);if(i){var r=s(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return o(this,t)}}function _(t){var e,r,n,i,s,o,u=t.rectangle;o=u?(e=u.x,n=u.y,s=u.width,u.height):(n=e=0,s=t.width,t.height),r=e+s,i=n+o;var a,h,f=t.center;h=void 0===f?(a=(e+r)/2,(n+i)/2):(a=w(f.x,e,r),w(f.y,n,i));var c=[];c.push([a,h]);for(var l=x(t,"samples",12),p=x(t,"variation",.25),v=Math.min(s,o),y=1-p,g=1+p,m=0;m<3;m++)P(c,a,h,v*Math.pow(3,m)/27,l,y,g,e,r,n,i);return v=2*Math.min(s,o),P(c,a,h,v,l,y,g,e,r,n,i),function(t,e){void 0===e&&(e=!0);var r=d.triangulate(t);if(e){for(var n=[],i=0,s=r.length;i<s;i+=3){var o=t[r[i+0]],u=t[r[i+1]],a=t[r[i+2]],h=new b(o[0],o[1],u[0],u[1],a[0],a[1]);n.push(h)}return n}return{vertices:t,indices:r}}(c,x(t,"triangleOutput",!0))}var u,d=(function(t){var e,P;function y(t,e,r,n){var i,s,o,u,a,h,f,c,l,p,v=t[e][0],y=t[e][1],g=t[r][0],m=t[r][1],d=t[n][0],b=t[n][1],x=Math.abs(y-m),w=Math.abs(m-b);if(x<P&&w<P)throw new Error("Eek! Coincident points!");return s=x<P?(u=-(d-g)/(b-m))*((i=(g+v)/2)-(h=(g+d)/2))+(c=(m+b)/2):w<P?(o=-(g-v)/(m-y))*((i=(d+g)/2)-(a=(v+g)/2))+(f=(y+m)/2):(i=((o=-(g-v)/(m-y))*(a=(v+g)/2)-(u=-(d-g)/(b-m))*(h=(g+d)/2)+(c=(m+b)/2)-(f=(y+m)/2))/(o-u),w<x?o*(i-a)+f:u*(i-h)+c),{i:e,j:r,k:n,x:i,y:s,r:(l=g-i)*l+(p=m-s)*p}}function g(t){var e,r,n,i,s,o;for(r=t.length;r;)for(i=t[--r],n=t[--r],e=r;e;)if(o=t[--e],n===(s=t[--e])&&i===o||n===o&&i===s){t.splice(r,2),t.splice(e,2);break}}P=1/1048576,e={triangulate:function(r,t){var e,n,i,s,o,u,a,h,f,c,l,p,v=r.length;if(v<3)return[];if(r=r.slice(0),t)for(e=v;e--;)r[e]=r[e][t];for(i=new Array(v),e=v;e--;)i[e]=e;for(i.sort(function(t,e){return r[e][0]-r[t][0]}),s=function(t){var e,r,n,i,s,o,u=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,f=Number.NEGATIVE_INFINITY;for(e=t.length;e--;)t[e][0]<u&&(u=t[e][0]),t[e][0]>h&&(h=t[e][0]),t[e][1]<a&&(a=t[e][1]),t[e][1]>f&&(f=t[e][1]);return n=f-a,[[(s=u+.5*(r=h-u))-20*(i=Math.max(r,n)),(o=a+.5*n)-i],[s,o+20*i],[s+20*i,o-i]]}(r),r.push(s[0],s[1],s[2]),o=[y(r,v+0,v+1,v+2)],u=[],a=[],e=i.length;e--;a.length=0){for(p=i[e],n=o.length;n--;)0<(h=r[p][0]-o[n].x)&&h*h>o[n].r?(u.push(o[n]),o.splice(n,1)):h*h+(f=r[p][1]-o[n].y)*f-o[n].r>P||(a.push(o[n].i,o[n].j,o[n].j,o[n].k,o[n].k,o[n].i),o.splice(n,1));for(g(a),n=a.length;n;)l=a[--n],c=a[--n],o.push(y(r,c,l,p))}for(e=o.length;e--;)u.push(o[e]);for(o.length=0,e=u.length;e--;)u[e].i<v&&u[e].j<v&&u[e].k<v&&o.push(u[e].i,u[e].j,u[e].k);return o},contains:function(t,e){if(e[0]<t[0][0]&&e[0]<t[1][0]&&e[0]<t[2][0]||e[0]>t[0][0]&&e[0]>t[1][0]&&e[0]>t[2][0]||e[1]<t[0][1]&&e[1]<t[1][1]&&e[1]<t[2][1]||e[1]>t[0][1]&&e[1]>t[1][1]&&e[1]>t[2][1])return null;var r=t[1][0]-t[0][0],n=t[2][0]-t[0][0],i=t[1][1]-t[0][1],s=t[2][1]-t[0][1],o=r*s-n*i;if(0==o)return null;var u=(s*(e[0]-t[0][0])-n*(e[1]-t[0][1]))/o,a=(r*(e[1]-t[0][1])-i*(e[0]-t[0][0]))/o;return u<0||a<0||1<u+a?null:[u,a]}},t.exports=e}(u={exports:{}}),u.exports),b=Phaser.Geom.Triangle,x=Phaser.Utils.Objects.GetValue,w=Phaser.Math.Clamp,y=2*Math.PI,P=function(t,e,r,n,i,s,o,u,a,h,f){for(var c=0;c<i;c++){var l=c/i*y,p=e+Math.cos(l)*n*g(s,o),v=r+Math.sin(l)*n*g(s,o);p=w(p,u,a),v=w(v,h,f),t.push([p,v])}return t},g=function(t,e){return t===e?t:t+(e-t)*Math.random()},f=Phaser.GameObjects.Mesh,c=Phaser.Utils.Objects.IsPlainObject,l=Phaser.Utils.Objects.GetValue,p=Phaser.Geom.Mesh.GenerateGridVerts,E=Phaser.Geom.Mesh.Vertex,R=Phaser.Geom.Mesh.Face,V=Phaser.Math.Distance.Squared,v=Phaser.Math.DegToRad,m=1+1/Math.sin(v(45)),j=function(){e(a,f);var u=i(a);function a(t,e,r,n,i,s){var o;return h(this,a),c(e)&&(e=l(s=e,"x",0),r=l(s,"y",0),n=l(s,"key",null),i=l(s,"frame",null)),(o=u.call(this,t,e,r,n,i)).type="rexShatterImage",o.setSizeToFrame(),o.setPerspective(o.width,o.height,45),o.panZ(m),o.resetImage(),o.shatterCenter={x:null,y:null},o}return t(a,[{key:"resetImage",value:function(){return p({mesh:this,texture:this.texture.key,frame:this.frame.name,width:this.frame.cutWidth/this.height,height:this.frame.cutHeight/this.height,flipY:this.frame.source.isRenderTexture}),this}},{key:"shatter",value:function(t,e){if(void 0===t&&(t=this.width/2,e=this.height/2),this.shatterCenter.x=t,this.shatterCenter.y=e,this.vertices.length=0,this.faces.length=0,this.dirtyCache[9]=-1,0===this.width||0===this.height)return this;for(var r=_({width:this.width,height:this.height,center:this.shatterCenter,triangleOutput:!1}),n=r.vertices,i=r.indices,s=[],o=this.width,u=this.height,a=this.frame.cutWidth/u/2,h=this.frame.cutHeight/u/2,f=this.frame.source.isRenderTexture,c=this.frame.u0,l=this.frame.u1,p=f?this.frame.v1:this.frame.v0,v=l-c,y=(f?this.frame.v0:this.frame.v1)-p,g=0,m=n.length;g<m;g++){var d=n[g],b=d[0],x=d[1],w=b/u-a,P=x/u-h,j=c+b/o*v,I=p+x/u*y;s.push({x:b,y:x,vx:w,vy:-P,u:j,v:I})}for(g=0,m=i.length;g<m;g+=3){var O=s[i[g+0]],M=s[i[g+1]],T=s[i[g+2]],G=new E(O.vx,O.vy,0,O.u,O.v),k=new E(M.vx,M.vy,0,M.u,M.v),N=new E(T.vx,T.vy,0,T.u,T.v),S=new R(G,k,N);this.vertices.push(G,k,N),this.faces.push(S),S.g=Math.min(V(t,e,O.x,O.y),V(t,e,M.x,M.y),V(t,e,T.x,T.y))}return this.faces.sort(function(t,e){return t.g-e.g}),this}}]),a}();function I(t,e,r,n,i){var s=new j(this.scene,t,e,r,n,i);return this.scene.add.existing(s),s}var O=Phaser.Utils.Objects.GetAdvancedValue,M=Phaser.GameObjects.BuildGameObject;function T(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var r=O(t,"key",null),n=O(t,"frame",null),i=new j(this.scene,0,0,r,n,t);return M(this.scene,i,t),i}function G(t){return null==t||""===t||0===t.length}var k=function(){e(n,Phaser.Plugins.BasePlugin);var r=i(n);function n(t){var e;return h(this,n),e=r.call(this,t),t.registerGameObject("rexShatterImage",I,T),e}return t(n,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}}]),n}();return function(t,e,r){if("object"===a(t)){if(G(e)){if(null==r)return;"object"===a(r)&&(t=r)}else{"string"==typeof e&&(e=e.split("."));var n=e.pop();(function(t,e,r){var n=t;if(!G(e)){var i;"string"==typeof e&&(e=e.split("."));for(var s=0,o=e.length;s<o;s++){var u;if(null==n[i=e[s]]||"object"!==a(n[i]))u=s!==o-1||void 0===r?{}:r,n[i]=u;n=n[i]}}return n})(t,e)[n]=r}}}(window,"RexPlugins.GameObjects.ShatterImage",j),k});
