!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexninepatch=e()}(this,function(){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function n(t){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function h(i){var o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=n(i);if(o){var r=n(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return c(this,t)}}function u(t,e,r){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=n(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function P(t){var e,r,i;if("object"!==o(t)||null===t)return t;for(i in e=Array.isArray(t)?[]:{},t)r=t[i],e[i]=P(r);return e}function S(t,e,r){return void 0===r&&(r="image"),t[e]||(t[e]=t.scene.make[r]({add:!1,origin:{x:0,y:0}}),t.once("destroy",function(){t[e]&&(t[e].destroy(),t[e]=void 0)})),t[e]}function a(t,e,r){return"__BASE"===r?"".concat(t,",").concat(e):"".concat(r,"_").concat(t,",").concat(e)}var e=Phaser.Utils.Objects.IsPlainObject,r=Phaser.Utils.Objects.GetValue,l=function(t){return"string"==typeof t&&(t=f[t]),t},f={scale:0,repeat:1},t={setTexture:function(t,e,r,i){Array.isArray(e)&&(i=r,r=e,e=void 0),void 0===e&&(e="__BASE"),r=P(r),i=P(i),this.textureKey=t,this.baseFrameName=e,this.columns.data=r,this.columns.count=r?r.length:0,this.columns.stretch=0,this.columns.minWidth=0,this.columns.scale=1,this.rows.data=i,this.rows.count=i?i.length:0,this.rows.stretch=0,this.rows.minHeight=0,this.rows.scale=1;var o=this.scene.textures.get(t);if(!o)return this.clear(),this;if(!r||!i)return this.clear(),this;for(var n=o.frames[e],s=n.width,c=0,h=0,u=r.length;h<u;h++)void 0===r[h]?c++:"number"==typeof r[h]?s-=r[h]:s-=r[h].width;var a=s/c,l=n.height,f=0;for(h=0,u=i.length;h<u;h++)void 0===i[h]?f++:"number"==typeof i[h]?l-=i[h]:l-=i[h].width;for(var d,m,y,v,p,g=l/f,b=0,w=0,x=0,O=i.length;x<O;x++){void 0===i[x]&&(i[x]=g),"number"==typeof i[x]&&(i[x]={height:i[x],stretch:x%2}),y=(d=i[x]).height,this.rows.stretch+=0|d.stretch,this.rows.minHeight+=0<d.stretch?0:y;h=b=0;for(var j=r.length;h<j;h++)void 0===r[h]&&(r[h]=a),"number"==typeof r[h]&&(r[h]={width:r[h],stretch:h%2}),v=(m=r[h]).width,0===x&&(this.columns.stretch+=0|m.stretch,this.columns.minWidth+=0<m.stretch?0:v),1<=v&&1<=y&&(p=this.getFrameNameCallback(h,x,e))&&o.add(p,0,b+n.cutX,w+n.cutY,v,y),b+=v;w+=y}return this.updateTexture(),this},updateTexture:function(){if(this.clear(),void 0===this.textureKey)return this;var t=this.scene.textures.get(this.textureKey);if(!t)return this;var e,r,i,o,n,s,c,h=this.columns.minWidth,u=this.rows.minHeight,a=this.width-h,l=this.height-u,f=0<=a?1:this.width/h,d=0<=l?1:this.height/u;if(this.preserveRatio){var m=Math.min(f,d);if(m<f){var y=(f-m)*h;0<=a?a+=y:a=y,f=m}if(m<d){var v=(d-m)*u;0<=l?l+=v:l=v,d=m}}this.columns.scale=f,this.rows.scale=d,e=0<a&&0<this.columns.stretch?a/this.columns.stretch:0,r=0<l&&0<this.rows.stretch?l/this.rows.stretch:0;for(var p,g=0,b=0,w=0,x=this.rows.count;w<x;w++){c=0===(n=this.rows.data[w]).stretch?n.height*d:r*n.stretch;for(var O=g=0,j=this.columns.count;O<j;O++)s=0===(o=this.columns.data[O]).stretch?o.width*f:e*o.stretch,(i=this.getFrameNameCallback(O,w,this.baseFrameName))&&0<s&&0<c&&t.has(i)&&(0===(0===n.stretch&&0===o.stretch||0===this.getStretchMode(O,w)?0:1)?(p=S(this,"_image","image")).setTexture(this.textureKey,i).setDisplaySize(s,c):(p=S(this,"_tileSprite","tileSprite")).setTexture(this.textureKey,i).setSize(s,c)),p&&(this.draw(p,g,b),p=void 0),g+=s;b+=c}},setStretchMode:function(t){return e(t)?(this.stretchMode.edge=l(r(t,"edge",0)),this.stretchMode.internal=l(r(t,"internal",0))):(t=l(t),this.stretchMode.edge=t,this.stretchMode.internal=t),this},getStretchMode:function(t,e){return function(t,e){return 0===t||t===this.columns.count-1||0===e||e===this.rows.count-1}.call(this,t,e)?this.stretchMode.edge:this.stretchMode.internal},setPreserveRatio:function(t){return null==t&&(t=!0),this.preserveRatio=t,this}},d=Phaser.GameObjects.RenderTexture,m=Phaser.Utils.Objects.IsPlainObject,y=Phaser.Utils.Objects.GetValue,v=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(f,d);var t,e,r,l=h(f);function f(t,e,r,i,o,n,s,c,h,u){var a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,f),m(e)?(e=y(u=e,"x",0),r=y(u,"y",0),i=y(u,"width",1),o=y(u,"height",1),n=y(u,"key",void 0),s=y(u,"baseFrame",void 0),c=y(u,"columns",void 0),h=y(u,"rows",void 0)):m(i)?(i=y(u=i,"width",1),o=y(u,"height",1),n=y(u,"key",void 0),s=y(u,"baseFrame",void 0),c=y(u,"columns",void 0),h=y(u,"rows",void 0)):m(n)?(n=y(u=n,"key",void 0),s=y(u,"baseFrame",void 0),c=y(u,"columns",void 0),h=y(u,"rows",void 0)):m(s)?(s=y(u=s,"baseFrame",void 0),c=y(u,"columns",void 0),h=y(u,"rows",void 0)):Array.isArray(s)?(u=h,h=c,c=s,s=y(u,"baseFrame",void 0)):m(c)&&(c=y(u=c,"columns",void 0),h=y(u,"rows",void 0)),(a=l.call(this,t,e,r,i,o)).columns={},a.rows={},a.stretchMode={},a._tileSprite=void 0,a._image=void 0,a.setOrigin(.5,.5),a.setGetFrameNameCallback(y(u,"getFrameNameCallback",void 0)),a.setStretchMode(y(u,"stretchMode",0)),a.setPreserveRatio(y(u,"preserveRatio",!0)),a.setTexture(n,s,c,h),a}return t=f,(e=[{key:"setGetFrameNameCallback",value:function(t){return void 0===t&&(t=a),this.getFrameNameCallback=t,this}},{key:"minWidth",get:function(){return this.columns.minWidth}},{key:"minHeight",get:function(){return this.rows.minHeight}},{key:"fixedPartScaleX",get:function(){return this.columns.scale}},{key:"fixedPartScaleY",get:function(){return this.rows.scale}},{key:"resize",value:function(t,e){return this.width===t&&this.height===e||(u(n(f.prototype),"resize",this).call(this,t,e),this.updateTexture()),this}}])&&i(t.prototype,e),r&&i(t,r),f}();return Object.assign(v.prototype,t),v});
