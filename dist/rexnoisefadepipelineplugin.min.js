!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).rexnoisefadepipelineplugin=t()}(this,function(){"use strict";function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function i(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function l(o){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=a(o);if(r){var n=a(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return c(this,e)}}function u(e){return null==e||""===e||0===e.length}var g="#ifdef GL_FRAGMENT_PRECISION_HIGH\n#define highmedp highp\n#else\n#define highmedp mediump\n#endif\nprecision highmedp float;\n// Scene buffer\nuniform sampler2D uMainSampler; \nvarying vec2 outTexCoord;\n\n// Progress\nuniform float progress;\n// Noise\nuniform float noiseX;\nuniform float noiseY;\nuniform float noiseZ;\n// Alpha\nuniform float alpha0;\nuniform float alpha1;\n\n".concat("vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec4 permute(vec4 x) { return mod289(((x*34.0)+1.0)*x); }\nvec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }\nvec3 fade(vec3 t) { return t*t*t*(t*(t*6.0-15.0)+10.0); }\nfloat Perlin(vec3 P) {\n    vec3 i0 = mod289(floor(P)), i1 = mod289(i0 + vec3(1.0));\n    vec3 f0 = fract(P), f1 = f0 - vec3(1.0), f = fade(f0);\n    vec4 ix = vec4(i0.x, i1.x, i0.x, i1.x), iy = vec4(i0.yy, i1.yy);\n    vec4 iz0 = i0.zzzz, iz1 = i1.zzzz;\n    vec4 ixy = permute(permute(ix) + iy), ixy0 = permute(ixy + iz0), ixy1 = permute(ixy + iz1);\n    vec4 gx0 = ixy0 * (1.0 / 7.0), gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n    vec4 gx1 = ixy1 * (1.0 / 7.0), gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n    gx0 = fract(gx0); gx1 = fract(gx1);\n    vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0), sz0 = step(gz0, vec4(0.0));\n    vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1), sz1 = step(gz1, vec4(0.0));\n    gx0 -= sz0 * (step(0.0, gx0) - 0.5); gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n    gx1 -= sz1 * (step(0.0, gx1) - 0.5); gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n    vec3 g0 = vec3(gx0.x,gy0.x,gz0.x), g1 = vec3(gx0.y,gy0.y,gz0.y),\n        g2 = vec3(gx0.z,gy0.z,gz0.z), g3 = vec3(gx0.w,gy0.w,gz0.w),\n        g4 = vec3(gx1.x,gy1.x,gz1.x), g5 = vec3(gx1.y,gy1.y,gz1.y),\n        g6 = vec3(gx1.z,gy1.z,gz1.z), g7 = vec3(gx1.w,gy1.w,gz1.w);\n    vec4 norm0 = taylorInvSqrt(vec4(dot(g0,g0), dot(g2,g2), dot(g1,g1), dot(g3,g3)));\n    vec4 norm1 = taylorInvSqrt(vec4(dot(g4,g4), dot(g6,g6), dot(g5,g5), dot(g7,g7)));\n    g0 *= norm0.x; g2 *= norm0.y; g1 *= norm0.z; g3 *= norm0.w;\n    g4 *= norm1.x; g6 *= norm1.y; g5 *= norm1.z; g7 *= norm1.w;\n    vec4 nz = mix(vec4(dot(g0, vec3(f0.x, f0.y, f0.z)), dot(g1, vec3(f1.x, f0.y, f0.z)),\n        dot(g2, vec3(f0.x, f1.y, f0.z)), dot(g3, vec3(f1.x, f1.y, f0.z))),\n        vec4(dot(g4, vec3(f0.x, f0.y, f1.z)), dot(g5, vec3(f1.x, f0.y, f1.z)),\n            dot(g6, vec3(f0.x, f1.y, f1.z)), dot(g7, vec3(f1.x, f1.y, f1.z))), f.z);\n    return 2.2 * mix(mix(nz.x,nz.z,f.y), mix(nz.y,nz.w,f.y), f.x);\n}\nfloat Perlin(vec2 P) { return Perlin(vec3(P, 0.0)); }\n","\n\nvoid main (void) {\n  float t = (Perlin(vec3(outTexCoord.x * noiseX, outTexCoord.y * noiseY, noiseZ)) + 1.0) / 2.0;\n  t -= progress;  // progress: 0->1, t: 1->0\n  t = min(max(t, 0.0), 1.0);\n  float alpha = mix(alpha0, alpha1, (1.0 - t));\n  vec4 front = texture2D(uMainSampler, outTexCoord);\n  gl_FragColor = vec4(front.rgb * alpha, front.a * alpha);\n}\n"),e=Phaser.Renderer.WebGL.Pipelines.PostFXPipeline,t=Phaser.Utils.Objects.GetValue,p=Phaser.Math.Clamp,v=function(){s(o,e);var n=l(o);function o(e){var t;return r(this,o),(t=n.call(this,{name:"rexNoiseDelayFadePostFx",game:e,renderTarget:!0,fragShader:g}))._progress=0,t.noiseX=0,t.noiseY=0,t.noiseZ=0,t.alpha0=1,t.alpha1=0,t}return i(o,[{key:"resetFromJSON",value:function(e){return this.setProgress(t(e,"progress",0)),this.setNoise(t(e,"noiseX",void 0),t(e,"noiseY",void 0),t(e,"noiseZ",void 0)),this.setFadeMode(t(e,"mode",0)),this}},{key:"onPreRender",value:function(){this.set1f("progress",this.progress),this.set1f("activeRate",this.activeRate),this.set1f("noiseX",this.noiseX),this.set1f("noiseY",this.noiseY),this.set1f("noiseZ",this.noiseZ),this.set1f("alpha0",this.alpha0),this.set1f("alpha1",this.alpha1)}},{key:"progress",get:function(){return this._progress},set:function(e){this._progress=p(e,0,1)}},{key:"setProgress",value:function(e){return this.progress=e,this}},{key:"setNoise",value:function(e,t,n){return void 0===e&&(e=4+30*Math.random()),void 0===t&&(t=4+30*Math.random()),void 0===n&&(n=10*Math.random()),this.noiseX=e,this.noiseY=t,this.noiseZ=n,this}},{key:"setFadeMode",value:function(e){return"string"==typeof e&&(e=y[e]),0===e?(this.alpha0=1,this.alpha1=0):(this.alpha0=0,this.alpha1=1),this}}]),o}(),y={fadeOut:0,fadeIn:1},h=Phaser.Utils.Array.SpliceOne,d=function(){s(t,Phaser.Plugins.BasePlugin);var e=l(t);function t(){return r(this,t),e.apply(this,arguments)}return i(t,[{key:"setPostPipelineClass",value:function(e,t){return this.PostFxPipelineClass=e,this.postFxPipelineName=t,this}},{key:"start",value:function(){this.game.events.once("destroy",this.destroy,this),this.game.renderer.pipelines.addPostPipeline(this.postFxPipelineName,this.PostFxPipelineClass)}},{key:"add",value:function(e,t){void 0===t&&(t={}),e.setPostPipeline(this.PostFxPipelineClass);var n=e.postPipelines[e.postPipelines.length-1];return n.resetFromJSON(t),t.name&&(n.name=t.name),n}},{key:"remove",value:function(e,t){var n=this.PostFxPipelineClass;if(void 0===t)for(var o=(r=e.postPipelines).length-1;0<=o;o--){(s=r[o])instanceof n&&(s.destroy(),h(r,o))}else{o=0;for(var r,i=(r=e.postPipelines).length;o<i;o++){var s;(s=r[o])instanceof n&&s.name===t&&(s.destroy(),h(r,o))}}return this}},{key:"get",value:function(e,t){var n=this.PostFxPipelineClass;if(void 0===t){for(var o=[],r=0,i=(s=e.postPipelines).length;r<i;r++){(a=s[r])instanceof n&&o.push(a)}return o}var s;for(r=0,i=(s=e.postPipelines).length;r<i;r++){var a;if((a=s[r])instanceof n&&a.name===t)return a}}}]),t}(),x=function(){s(o,d);var n=l(o);function o(e){var t;return r(this,o),(t=n.call(this,e)).setPostPipelineClass(v,"rexNoiseFadePostFx"),t}return o}();return function(e,t,n){if("object"===f(e)){if(u(t)){if(null==n)return;"object"===f(n)&&(e=n)}else{"string"==typeof t&&(t=t.split("."));var o=t.pop();(function(e,t,n){var o=e;if(!u(t)){var r;"string"==typeof t&&(t=t.split("."));for(var i=0,s=t.length;i<s;i++){var a;if(null==o[r=t[i]]||"object"!==f(o[r]))a=i!==s-1||void 0===n?{}:n,o[r]=a;o=o[r]}}return o})(e,t)[o]=n}}}(window,"RexPlugins.Pipelines.NoiseFadePostFx",v),x});
