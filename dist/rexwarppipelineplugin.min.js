!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).rexwarppipelineplugin=t()}(void 0,function(){function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function l(n){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=c(n);if(s){var i=c(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return a(this,e)}}function p(){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(n){var s=Object.getOwnPropertyDescriptor(n,t);return s.get?s.get.call(arguments.length<3?e:i):s.value}}).apply(this,arguments)}function s(e){return e instanceof t}var e={setEventEmitter:function(e,t){return void 0===t&&(t=Phaser.Events.EventEmitter),this._privateEE=!0===e||void 0===e,this._eventEmitter=this._privateEE?new t:e,this},destroyEventEmitter:function(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter:function(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(e){return this._eventEmitter&&e&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]},eventNames:function(){return this._eventEmitter?this._eventEmitter.eventNames.apply(this._eventEmitter,arguments):[]}},t=Phaser.Scene,f=Phaser.Utils.Objects.GetValue,v=function(){function n(e,t){var i;r(this,n),this.parent=e,this.scene=null==(i=e)||"object"!==h(i)?null:s(i)?i:i.scene&&s(i.scene)?i.scene:i.parent&&i.parent.scene&&s(i.parent.scene)?i.parent.scene:void 0,this.isShutdown=!1,this.setEventEmitter(f(t,"eventEmitter",!0)),this.parent&&this.parent===this.scene?this.scene.sys.events.once("shutdown",this.onSceneDestroy,this):this.parent&&this.parent.once&&this.parent.once("destroy",this.onParentDestroy,this)}return o(n,[{key:"shutdown",value:function(){this.isShutdown||(this.parent&&this.parent===this.scene?this.scene.sys.events.off("shutdown",this.onSceneDestroy,this):this.parent&&this.parent.once&&this.parent.off("destroy",this.onParentDestroy,this),this.destroyEventEmitter(),this.parent=void 0,this.scene=void 0,this.isShutdown=!0)}},{key:"destroy",value:function(e){this.shutdown(e)}},{key:"onSceneDestroy",value:function(){this.destroy(!0)}},{key:"onParentDestroy",value:function(e,t){this.destroy(t)}}]),n}();Object.assign(v.prototype,e);function d(e){return e instanceof _}function y(e){return d(e)?e:d(e.game)?e.game:s(e.scene)?e.scene.game:void 0}function m(e){return null==e||""===e||0===e.length}var g=Phaser.Utils.Objects.GetValue,k=function(){u(s,v);var n=l(s);function s(e,t){var i;return r(this,s),(i=n.call(this,e,t))._isRunning=!1,i.isPaused=!1,i.tickingState=!1,i.setTickingMode(g(t,"tickingMode",1)),i}return o(s,[{key:"boot",value:function(){2!==this.tickingMode||this.tickingState||this.startTicking()}},{key:"shutdown",value:function(e){this.isShutdown||(this.stop(),this.tickingState&&this.stopTicking(),p(c(s.prototype),"shutdown",this).call(this,e))}},{key:"setTickingMode",value:function(e){"string"==typeof e&&(e=P[e]),this.tickingMode=e}},{key:"startTicking",value:function(){this.tickingState=!0}},{key:"stopTicking",value:function(){this.tickingState=!1}},{key:"isRunning",get:function(){return this._isRunning},set:function(e){this._isRunning!==e&&(this._isRunning=e,1===this.tickingMode&&e!=this.tickingState&&(e?this.startTicking():this.stopTicking()))}},{key:"start",value:function(){return this.isPaused=!1,this.isRunning=!0,this}},{key:"pause",value:function(){return this.isRunning&&(this.isPaused=!0,this.isRunning=!1),this}},{key:"resume",value:function(){return this.isPaused&&(this.isRunning=!0),this}},{key:"stop",value:function(){return this.isPaused=!1,this.isRunning=!1,this}},{key:"complete",value:function(){this.isPaused=!1,this.isRunning=!1,this.emit("complete",this.parent,this)}}]),s}(),P={no:0,lazy:1,always:2},E=Phaser.Utils.Objects.GetValue,b=function(){u(s,k);var n=l(s);function s(e,t){var i;return r(this,s),(i=n.call(this,e,t)).resetFromJSON(t),i.boot(),i}return o(s,[{key:"resetFromJSON",value:function(e){return this.isRunning=E(e,"isRunning",!1),this.timeScale=E(e,"timeScale",1),this.now=E(e,"now",0),this}},{key:"toJSON",value:function(){return{isRunning:this.isRunning,timeScale:this.timeScale,now:this.now,tickingMode:this.tickingMode}}},{key:"start",value:function(e){return void 0===e&&(e=0),this.delta=0,this.now=e,p(c(s.prototype),"start",this).call(this),this}},{key:"seek",value:function(e){return this.now=e,this}},{key:"setTimeScale",value:function(e){return this.timeScale=e,this}},{key:"tick",value:function(e){return e*=this.timeScale,this.now+=e,this.delta=e,this.emit("update",this.now,this.delta),this}}]),s}(),_=Phaser.Game,S=function(){u(t,b);var e=l(t);function t(){return r(this,t),e.apply(this,arguments)}return o(t,[{key:"startTicking",value:function(){p(c(t.prototype),"startTicking",this).call(this),y(this.parent).events.on("step",this.update,this)}},{key:"stopTicking",value:function(){p(c(t.prototype),"stopTicking",this).call(this),y(this.parent).events.off("step",this.update,this)}},{key:"update",value:function(e,t){return this.isRunning&&0!==this.timeScale&&this.tick(t),this}}]),t}(),w=Phaser.Renderer.WebGL.Pipelines.PostFXPipeline,O=Phaser.Math.Vector2,x=Phaser.Utils.Objects.GetValue,R=2*Math.PI,X=function(){u(n,w);var i=l(n);function n(e){var t;return r(this,n),(t=i.call(this,{name:"rexWarpPostFx",game:e,renderTarget:!0,fragShader:"#ifdef GL_FRAGMENT_PRECISION_HIGH\n#define highmedp highp\n#else\n#define highmedp mediump\n#endif\nprecision highmedp float;\n\n// Scene buffer\nuniform sampler2D uMainSampler; \nvarying vec2 outTexCoord;\n\n// Effect parameters\nuniform vec2 texSize;\nuniform vec2 amplitude;\nuniform vec2 frequency;\nuniform vec2 progress;\nuniform vec2 speed;\nuniform float time;\n\n\nvoid main (void) {\n  vec2 dxy = frequency/texSize;\n  vec2 r = amplitude/texSize;\n  vec2 spd = speed/texSize;\n  vec2 angle = (outTexCoord / dxy) + progress + (spd*time);\n  vec2 tc = (vec2(cos(angle.x),sin(angle.y)) * r) + outTexCoord;\n  gl_FragColor = texture2D(uMainSampler, tc);\n}\n"})).frequencyX=10,t.frequencyY=10,t.amplitudeX=10,t.amplitudeY=10,t.progressX=0,t.progressY=0,t.speed=new O(0,0),t}return o(n,[{key:"resetFromJSON",value:function(e){var t=x(e,"frequency",10);this.setFrequency(x(e,"frequencyX",t),x(e,"frequencyY",t));var i=x(e,"amplitude",10);this.setAmplitude(x(e,"amplitudeX",i),x(e,"amplitudeY",i));var n=x(e,"progress",0);this.setProgress(x(e,"progressX",n),x(e,"progressY",n));var s=x(e,"speed",0);return this.setSpeed(x(e,"speedX",s),x(e,"speedY",s)),this.setSpeedEnable(x(e,"speedEnable",0!==this.speedX||0!==this.speedY)),this}},{key:"onPreRender",value:function(){this.set2f("frequency",this.frequencyX,this.frequencyY),this.set2f("amplitude",this.amplitudeX,this.amplitudeY),this.set2f("progress",this.progressX*R,this.progressY*R),this.set2f("speed",this.speed.x,this.speed.y),this.set1f("time",this.clock?this.clock.now:0),this.set2f("texSize",this.renderer.width,this.renderer.height)}},{key:"destroy",value:function(){return this.clock&&(this.clock.destroy(),this.clock=void 0),p(c(n.prototype),"destroy",this).call(this),this}},{key:"setFrequencyX",value:function(e){return this.frequencyX=e,this}},{key:"setFrequencyY",value:function(e){return this.frequencyY=e,this}},{key:"setFrequency",value:function(e,t){return void 0===t&&(t=e),this.frequencyX=e,this.frequencyY=t,this}},{key:"frequency",get:function(){return(this.frequencyX+this.frequencyY)/2},set:function(e){this.frequencyX=e,this.frequencyY=e}},{key:"setAmplitudeX",value:function(e){return this.amplitudeX=e,this}},{key:"setAmplitudeY",value:function(e){return this.amplitudeY=e,this}},{key:"setAmplitude",value:function(e,t){return void 0===t&&(t=e),this.amplitudeX=e,this.amplitudeY=t,this}},{key:"amplitude",get:function(){return(this.amplitudeX+this.amplitudeY)/2},set:function(e){this.amplitudeX=e,this.amplitudeY=e}},{key:"setProgressX",value:function(e){return this.progressX=e,this}},{key:"setProgressY",value:function(e){return this.progressY=e,this}},{key:"setProgress",value:function(e,t){return void 0===t&&(t=e),this.progressX=e,this.progressY=t,this}},{key:"progress",get:function(){return(this.progressX+this.progressY)/2},set:function(e){this.progressX=e,this.progressY=e}},{key:"setSpeedX",value:function(e){return this.speedX=e,this}},{key:"setSpeedY",value:function(e){return this.speed.y=e,this}},{key:"speedX",get:function(){return this.speed.x},set:function(e){this.speed.x=e}},{key:"speedY",get:function(){return this.speed.y},set:function(e){this.speed.y=e}},{key:"setSpeed",value:function(e,t){return void 0===t&&(t=e),this.speedX=e,this.speedY=t,this}},{key:"speedEnable",get:function(){return this._speedEnable},set:function(e){this._speedEnable!==e&&((this._speedEnable=e)?this.clock?this.clock.resume():(this.clock=new S(this,{eventEmitter:!1}),this.clock.start()):this.clock&&this.clock.pause())}},{key:"setSpeedEnable",value:function(e){return void 0===e&&(e=!0),this.speedEnable=e,this}}]),n}(),Y=Phaser.Renderer.WebGL.Pipelines.PostFXPipeline,j=Phaser.Utils.Objects.GetValue,F=Phaser.Utils.Array.Remove,q=function(){function n(e,t){var i;r(this,n),this.gameObject=e,this.scene=e.scene,T(t)?(i=t,t=void 0):i=j(t,"PipelineClass"),i&&(this.createPipeline=function(e){return new i(e)}),j(t,"enable",!!t)&&this.getPipeline(t)}return o(n,[{key:"getPipeline",value:function(e){if(!this.pipeline){var t=this.createPipeline(this.scene.game),i=this.gameObject,n=i.postPipelines;t.gameObject=i,n.push(t),i.hasPostPipeline=0<n.length,this.pipeline=t}return e&&this.pipeline.resetFromJSON&&this.pipeline.resetFromJSON(e),this.pipeline}},{key:"freePipeline",value:function(){if(!this.pipeline)return this;var e=this.gameObject,t=e.postPipelines;return F(t,this.pipeline),e.hasPostPipeline=0<t.length,this.pipeline.destroy(),this.pipeline=void 0,this}},{key:"createPipeline",value:function(){}}]),n}(),T=function(e){return e&&e.prototype&&e.prototype instanceof Y},C=function(){u(t,q);var e=l(t);function t(){return r(this,t),e.apply(this,arguments)}return o(t,[{key:"createPipeline",value:function(e){return new X(e)}}]),t}(),M=Phaser.Utils.Array.SpliceOne,N=function(){u(t,Phaser.Plugins.BasePlugin);var e=l(t);function t(){return r(this,t),e.apply(this,arguments)}return o(t,[{key:"setPostPipelineClass",value:function(e,t){return this.PostFxPipelineClass=e,this.postFxPipelineName=t,this}},{key:"start",value:function(){var e,t,i;this.game.events.once("destroy",this.destroy,this),e=this.game,t=this.postFxPipelineName,i=this.PostFxPipelineClass,y(e).renderer.pipelines.addPostPipeline(t,i)}},{key:"add",value:function(e,t){return function(e,t,i){void 0===i&&(i={}),e.setPostPipeline(t);var n=e.postPipelines[e.postPipelines.length-1];return n.resetFromJSON(i),i.name&&(n.name=i.name),n}(e,this.PostFxPipelineClass,t)}},{key:"remove",value:function(e,t){return function(e,t,i){if(void 0===i)for(var n=(s=e.postPipelines).length-1;0<=n;n--){(o=s[n])instanceof t&&(o.destroy(),M(s,n))}else{n=0;for(var s,r=(s=e.postPipelines).length;n<r;n++){var o;(o=s[n])instanceof t&&o.name===i&&(o.destroy(),M(s,n))}}}(e,this.PostFxPipelineClass,t),this}},{key:"get",value:function(e,t){return function(e,t,i){if(void 0===i){for(var n=[],s=0,r=(o=e.postPipelines).length;s<r;s++){(u=o[s])instanceof t&&n.push(u)}return n}var o;for(s=0,r=(o=e.postPipelines).length;s<r;s++){var u;if((u=o[s])instanceof t&&u.name===i)return u}}(e,this.PostFxPipelineClass,t)}}]),t}(),G=function(){u(n,N);var i=l(n);function n(e){var t;return r(this,n),(t=i.call(this,e)).setPostPipelineClass(X,"rexWarpPostFx"),t}return o(n,[{key:"addBehavior",value:function(e,t){return new C(e,t)}}]),n}();return function(e,t,i,n){if(void 0===n&&(n="."),"object"===h(e)){if(m(t)){if(null==i)return;"object"===h(i)&&(e=i)}else{"string"==typeof t&&(t=t.split(n));var s=t.pop();(function(e,t,i){var n=e;if(!m(t)){var s;"string"==typeof t&&(t=t.split("."));for(var r=0,o=t.length;r<o;r++){var u;if(null==n[s=t[r]]||"object"!==h(n[s]))u=r!==o-1||void 0===i?{}:i,n[s]=u;n=n[s]}}return n})(e,t)[s]=i}}}(window,"RexPlugins.Pipelines.WarpPostFx",X),G});
