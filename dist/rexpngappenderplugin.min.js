!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).rexpngappenderplugin=t()}(void 0,function(){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function s(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function a(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=o(n);if(i){var r=o(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return s(this,e)}}var r=function(){function t(e){n(this,t),this.buf=e,this.lastPointer=this.buf.length,this.pointer=0}return e(t,[{key:"seek",value:function(e){return this.pointer=e,this}},{key:"seekBack",value:function(e){return this.pointer-=e,this}},{key:"seekForward",value:function(e){return this.pointer+=e,this}},{key:"readUint8",value:function(){var e=this.buf[this.pointer];return this.pointer++,e}},{key:"readUint32",value:function(e){return void 0===e&&(e=!1),t=this.readUint8(),r=this.readUint8(),n=this.readUint8(),i=this.readUint8(),void 0===(o=e)&&(o=!1),o?t<<24|r<<16|n<<8|i:t|r<<8|n<<16|i<<24;var t,r,n,i,o}},{key:"readString",value:function(e){for(var t="",r=0;r<e;r++)t+=String.fromCharCode(this.readUint8());return t}},{key:"readUint8Array",value:function(e){var t=this.buf.slice(this.pointer,this.pointer+e);return this.pointer+=t.length,t}},{key:"outOfArray",get:function(){return this.pointer>=this.lastPointer}}]),t}(),f=function(){function t(e){n(this,t),this.reader=new r(e)}return e(t,[{key:"pointer",get:function(){return this.reader.pointer}},{key:"seekToChunk",value:function(e,t){for(void 0===t&&(t=0),this.reader.seek(8);!this.reader.outOfArray;){var r=this.reader.readUint32(!0);if(e===this.reader.readString(4)){switch(t){case 0:return this.reader.seekBack(8),!0;case 1:return this.reader.seekForward(r+4),!0;case 2:return!0}break}this.reader.seekForward(r+4)}return!1}},{key:"seekToChunkStart",value:function(e){return this.seekToChunk(e,0)}},{key:"seekToChunkEnd",value:function(e){return this.seekToChunk(e,1)}},{key:"getData",value:function(e){if(!this.seekToChunkStart(e))return null;var t=this.reader.readUint32(!0),r=this.reader.pointer+4,n=r+t;return this.reader.seek(n),this.reader.buf.slice(r,n)}}]),t}(),c="PHSR",h=function(){function t(e){n(this,t),this.buf=new Uint8Array(e),this.pointer=0}return e(t,[{key:"seek",value:function(e){return this.pointer=e,this}},{key:"writeUint8",value:function(e){return this.buf[this.pointer]=e,this.pointer++,this}},{key:"writeUint8Array",value:function(e){return this.buf.set(e,this.pointer),this.pointer+=e.length,this}},{key:"writeUint32",value:function(e,t){var r,n,i,o=(r=e,void 0===(n=t)&&(n=!1),void 0===i&&(i=[]),i.length=4,n?(i[0]=r>>24&255,i[1]=r>>16&255,i[2]=r>>8&255,i[3]=255&r):(i[0]=255&r,i[1]=r>>8&255,i[2]=r>>16&255,i[3]=r>>24&255),i);return this.writeUint8Array(o),this}},{key:"writeString",value:function(e){var t=(new TextEncoder).encode(e);return this.writeUint8Array(t),this}},{key:"outOfArray",get:function(){return this.pointer===this.buf.length}}]),t}(),t={append:function(e,t){var r=new f(e);r.seekToChunkEnd("IEND");var n,i=r.pointer,o=i+(8+(n=null!=t?(new TextEncoder).encode(JSON.stringify(t)):[]).length+4),u=new h(o);return u.writeUint8Array(e.slice(0,i)).writeUint32(n.length,!0).writeString(c).writeUint8Array(n).writeUint32(0),u.buf},extract:function(e){var t=new f(e).getData(c);return t&&0!==t.length?(t=(new TextDecoder).decode(t),t=JSON.parse(t)):null}},l=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(r,Phaser.Plugins.BasePlugin);var t=a(r);function r(e){return n(this,r),t.call(this,e)}return e(r,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}}]),r}();return Object.assign(l.prototype,t),l});
